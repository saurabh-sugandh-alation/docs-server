
<!DOCTYPE html>
<html lang="" >
<head>
  <meta charset="utf-8"/>
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="book-version"      content=""/>
  <meta name="book-release"      content=""/>
  <meta name="docsearch:name"    content="Alation User Guide" />
  <meta name="docsearch:version" content="" />
  <meta name="docsearch:package_type" content="" />
	<meta name="robots" content="noindex" />

  
  <title>Azure Databricks: Configure SSO through OAuth for Compose &mdash; Alation User Guide</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  

  
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/main.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx_collapse.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/rtd_sphinx_search.min.css" type="text/css" />
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="Alation User Guide" href="#"/>
        <link rel="up" title="Custom DB" href="index.html"/>
        <link rel="next" title="Denodo" href="Denodo.html"/>
        <link rel="prev" title="Databricks Azure" href="DatabricksAzure.html"/>

	

	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-67846571-1"></script>
	<script>
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());

	gtag('config', 'UA-67846571-1');
	</script>

	<!-- Global site tag (gtag.js) - Google Analytics -->
	<!-- Second Google Analytics tag to assist mapping with mattermost.com visits --> 
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-120238482-1"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  gtag('config', 'UA-120238482-1');
	</script>


</head>

<body class="wy-body-for-nav" role="document">

  <header>
    <div class="header__container wy-max-content-width">
        <a href="/" class="header__logo">
            <img width="176" src="../../_static/img/logo-alation.svg" alt="Alation" />
        </a>
        <ul class="header__links">
            <li><a href="https://help.alation.com/s/">Alation Help Center</a></li>
        </ul>
    </div>
</header>

  <div class="wy-grid-for-nav wy-max-content-width">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-scroll__content">
          <div class="wy-side-nav-search">
            

            <ul class="sidebartop">
              <li class="nolink search"><div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search this project" aria-label="Search this project" id="searchinput" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
</li>

            </ul>

            
          </div>

          <div class="wy-menu wy-sidebar wy-sidebar--hidden" data-spy="affix" role="navigation" aria-label="main navigation">
            
              
              
              
                  <p class="caption" role="heading"><span class="caption-text">Welcome to Alation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/About/index.html">About Alation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/CloudAndOnPrem/index.html">Alation Cloud and On-Premise</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/UserProfileandPreferences/index.html">User Profile and Preferences</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/CatalogBasics/index.html">Catalog Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/CatalogPages/index.html">Catalog Pages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/Conversations/index.html">Conversations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/Domains/index.html">Domains</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/BestPractices/index.html">Best Practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/Glossary/index.html">Alation Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alation Cloud Service</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../cloud/StatusPage/index.html">Status Page</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cloud/CloudOverview/index.html">Cloud Service Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cloud/CloudConfiguration/index.html">Configuration for Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cloud/AlationAgent/index.html">Alation Agent</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alation Integration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../integration/AlationAnywhere/index.html">Alation Anywhere</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../integration/AlationConnectedSheets/index.html">Alation Connected Sheets</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Installation &amp; Configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/ServerInstallation/index.html">Install Alation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/HighAvailability/index.html">High Availability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/Update/index.html">Update Alation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/BackupandRestore/index.html">Back Up and Restore</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/LineageV2/index.html">Lineage V2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/LineageV3/index.html">Lineage V3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/AlationAnalyticsV2/index.html">Alation Analytics V2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/AlationContainerService/index.html">Alation Container Service</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Sources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../sources/CatalogSources/index.html">Catalog Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sources/VirtualDataSources/index.html">Virtual Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sources/Lineage/index.html">Lineage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sources/APIResources/index.html">API Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sources/WorkwithCatalogData/index.html">Working with Catalog Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sources/OpenConnectorFramework/index.html">Open Connector Framework</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Sources</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../DSConfiguration/index.html">Data Source Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AddDataSources/index.html">Adding Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ComposeSSOAWSDataSources/index.html">Compose SSO for Amazon Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ComposeSSOAzureDataSources/index.html">Compose SSO for Azure Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AuthenticationForExtraction/index.html">Authentication for Extraction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Custom DB</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="AddCustomDrivers.html">Add Custom Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="CDataDrivers.html">CData Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="DriverFixer.html">Driver Fixer</a></li>
<li class="toctree-l2"><a class="reference internal" href="AddCustomDBtoAlation.html">Add Custom DB to Alation</a></li>
<li class="toctree-l2"><a class="reference internal" href="MDEFromCustomDB.html">Metadata Extraction From Custom DB</a></li>
<li class="toctree-l2"><a class="reference internal" href="GuidelinesForMDEQueries.html">Guidelines for Creating Queries for MDE</a></li>
<li class="toctree-l2"><a class="reference internal" href="ProfilingForCustomDB.html">Sampling and Profiling</a></li>
<li class="toctree-l2"><a class="reference internal" href="QLIFromCustomDB.html">QLI From Custom DB</a></li>
<li class="toctree-l2"><a class="reference internal" href="FileBasedQLICustomDB.html">File-Based Query Log Ingestion</a></li>
<li class="toctree-l2"><a class="reference internal" href="ViewBasedQLICustomDB.html">View-Based QLI</a></li>
<li class="toctree-l2"><a class="reference internal" href="SQLQueryBasedQLICustomDB.html">SQL Query QLI</a></li>
<li class="toctree-l2"><a class="reference internal" href="AWSAthena.html">Amazon Athena</a></li>
<li class="toctree-l2"><a class="reference internal" href="UpdateSimbaJDBCDriverForAthenaToSupportSSO.html">Update Simba JDBC Driver for Amazon Athena to Support SSO</a></li>
<li class="toctree-l2"><a class="reference internal" href="AWSDynamoDB.html">Amazon DynamoDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="AzureCosmosDB.html">Azure Cosmos DB</a></li>
<li class="toctree-l2"><a class="reference internal" href="AzureDW.html">Azure Data Warehouse (Azure SQL DW)</a></li>
<li class="toctree-l2"><a class="reference internal" href="ConfluentKafka.html">Confluent Kafka</a></li>
<li class="toctree-l2"><a class="reference internal" href="DatabricksforCustomDB.html">Databricks for Custom DB</a></li>
<li class="toctree-l2"><a class="reference internal" href="DatabricksAzure.html">Databricks Azure</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Azure Databricks: Configure SSO through OAuth for Compose</a></li>
<li class="toctree-l2"><a class="reference internal" href="Denodo.html">Denodo</a></li>
<li class="toctree-l2"><a class="reference internal" href="Elasticsearch.html">Elasticsearch</a></li>
<li class="toctree-l2"><a class="reference internal" href="EMRSparkSQL.html">EMR SparkSQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="EMRPrestoWithAWSGlueAsMetastore.html">EMR Presto on Hive with AWS Glue as Metastore</a></li>
<li class="toctree-l2"><a class="reference internal" href="GCPDatabricks.html">GCP Databricks</a></li>
<li class="toctree-l2"><a class="reference internal" href="GitHub.html">GitHub</a></li>
<li class="toctree-l2"><a class="reference internal" href="MariaDB.html">MariaDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="MarkLogic.html">MarkLogic</a></li>
<li class="toctree-l2"><a class="reference internal" href="MongoDB.html">MongoDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="MongoDBAtlas.html">MongoDB Atlas</a></li>
<li class="toctree-l2"><a class="reference internal" href="NetSuite.html">NetSuite</a></li>
<li class="toctree-l2"><a class="reference internal" href="Parquet.html">Parquet (Amazon S3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="Salesforce.html">Salesforce</a></li>
<li class="toctree-l2"><a class="reference internal" href="Servicenow.html">ServiceNow</a></li>
<li class="toctree-l2"><a class="reference internal" href="Splunk.html">Splunk</a></li>
<li class="toctree-l2"><a class="reference internal" href="SSAS.html">SQL Server Analysis Service (SSAS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="StarburstEnterprisePresto.html">Starburst Enterprise (Presto)</a></li>
<li class="toctree-l2"><a class="reference internal" href="StarburstEnterpriseTrino.html">Starburst Enterprise (Trino)</a></li>
<li class="toctree-l2"><a class="reference internal" href="ReferenceForQueryBasedMDE.html">Example Queries for Query-Based MDE</a></li>
<li class="toctree-l2"><a class="reference internal" href="ReferenceFileBasedQLI.html">Example JSONs for File-Based QLI</a></li>
<li class="toctree-l2"><a class="reference internal" href="ToubleshootingForCDataDataSources.html">Troubleshooting for CData Data Sources</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../GBQ/index.html">Google BigQuery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Hive/index.html">Hive</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">BI Sources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../bisources/AddBISources/index.html">Add BI Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bisources/AddTableauServer/index.html">Add Tableau Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bisources/WorkwithBISources/index.html">Working with BI Sources</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">File System Sources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/FileSystems/index.html">Add File Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/VirtualFileSystems/index.html">Virtual File Systems</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alation for Analysts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../analyst/UserAuthenticationForDataSources/index.html">User Authentication for Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analyst/ShareAndAccessQueries/index.html">Share and Access Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analyst/WriteQueries/index.html">Write Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analyst/DevelopQueries/index.html">Develop Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analyst/WorkwithQueryResults/index.html">Work with Query Results</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alation for Data Stewards</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../steward/GovernanceApp/index.html">Governance App</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/PolicyCenter/index.html">Policy Center</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/Workflow/index.html">Workflow Center</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/GovernanceDashboard/index.html">Governance Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/StewardshipWorkbench/index.html">Stewardship Workbench</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/AnalyticsStewardship/index.html">Analytics Stewardship</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/Glossary/index.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/ArticlesAndTags/index.html">Articles and Tags</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/ArticleGroups/index.html">Article Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/DataCatalogCustomization/index.html">Customize Your Data Catalog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/DataDocumentation/index.html">Data Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/AutoTitlingandLexicon/index.html">Auto-titling and Lexicon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/SnowflakeTags/index.html">Snowflake Tags</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alation for Server Administrators</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../admins/CustomizableHomePage/index.html">Customizable Homepage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/AdminSettings/index.html">Administrator Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/AdditionalConfiguration/index.html">Additional Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/RunbookForAdministrators/index.html">Runbook for Administrators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/AlationAPIs/index.html">Alation APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/How-tos/index.html">How-tos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/Troubleshooting/index.html">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Release Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../releases/releasenotes/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/supportmatrices/index.html">Support Matrices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/endofsupport/index.html">End Of Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/snowflakeclladdon/index.html">Snowflake Parser Add-On</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/fieldnotices/index.html">Important Notices and Security Alerts</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Archived Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../archive/About/index.html">About the Documentation Archive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../archive/AdminConfig/index.html">Administration and Update Archive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../archive/ReleaseNotes/index.html">Release Notes Archive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../archive/Usage/index.html">Usage and Customization Archive</a></li>
</ul>

              
            
          </div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="wy-nav-top-icon"></i>
        <a href="../../index.html">Alation User Guide</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">

          <div role="navigation" aria-label="breadcrumbs" class="breadcrumbs">
    <a href="../../index.html">Docs</a>
    <span class="separator">&gt;</span>
    <a href="index.html">Custom DB</a>
    <span class="separator">&gt;</span>
    <span>Azure Databricks: Configure SSO through OAuth for Compose</span>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody" class="toBeIndexed">
            
  <section id="azure-databricks-configure-sso-through-oauth-for-compose">
<h1>Azure Databricks: Configure SSO through OAuth for Compose<a class="headerlink" href="#azure-databricks-configure-sso-through-oauth-for-compose" title="Permalink to this headline">¶</a></h1>
<p><em>Applies from version 2020.4</em></p>
<p>Alation supports the OAuth 2.0 protocol for user connections from Compose and the catalog for Azure Databricks and Azure Databricks Unity Catalog data sources via Azure Active Directory (Azure AD) as the OAuth provider.</p>
<p>A <em>user connection</em> is established by an individual user who wants to access a data source from Alation, as opposed to the connection established via the service account to extract metadata, query history, or data samples.</p>
<p>Users may need to open an individual connection to perform these actions:</p>
<ul>
<li><p><strong>Compose</strong></p>
<blockquote>
<div><ul class="simple">
<li><p>Execute queries</p></li>
<li><p>Execute queries on a schedule</p></li>
<li><p>Run query forms</p></li>
<li><p>Create Excel Live Reports</p></li>
</ul>
</div></blockquote>
</li>
<li><p><strong>Catalog</strong></p>
<blockquote>
<div><ul class="simple">
<li><p>Upload data into the data source</p></li>
<li><p>Perform dynamic sampling of a table or column</p></li>
<li><p>Run a query form</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<p>With OAuth enabled and configured, users connecting to Azure Databricks or Azure Databricks Unity Catalog will be redirected to the Azure AD login screen in a new browser tab. Upon authentication, the login screen will close, and Alation will establish a connection to the data source.</p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>The OAuth 2.0 protocol provides a secure authorization mechanism for applications and users to access a resource. Authorization is managed with access tokens issued by an authorization server. The token holder is allowed to access the resource until the token expires. When an access token has expired, a refresh token can be requested by the application to retrieve a new access token.</p>
</div>
</div></blockquote>
<section id="workflow">
<h2>Workflow<a class="headerlink" href="#workflow" title="Permalink to this headline">¶</a></h2>
<p>To configure OAuth with Compose for your Azure Databricks or Azure Databricks Unity Catalog OCF data sources, follow this workflow:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference internal" href="#create-service-principal-in-azure-active-directory">Create Service Principal in Azure Active Directory</a></p></li>
<li><p><a class="reference internal" href="#create-databricks-users">Create Databricks Users</a></p></li>
<li><p><a class="reference internal" href="#configure-oauth-for-compose">Configure OAuth for Compose</a></p></li>
<li><p><a class="reference internal" href="#connect-in-compose">Connect in Compose</a></p></li>
</ul>
</div></blockquote>
</section>
<section id="create-service-principal-in-azure-active-directory">
<h2>Create Service Principal in Azure Active Directory<a class="headerlink" href="#create-service-principal-in-azure-active-directory" title="Permalink to this headline">¶</a></h2>
<p>Enabling OAuth for a Databricks data source requires <a class="reference external" href="https://learn.microsoft.com/en-us/azure/databricks/dev-tools/service-prin-aad-token#--provision-a-service-principal-in-azure-portal">provisioning a service principal</a> in Azure Active Directory. You will need to collect the following information from the service principal:</p>
<blockquote>
<div><ul class="simple">
<li><p>Client ID</p></li>
<li><p>Client secret value</p></li>
<li><p>Authorization endpoint</p></li>
<li><p>Token endpoint</p></li>
</ul>
</div></blockquote>
<p>We recommend creating a list with all the required information and storing it securely.</p>
<p>To provision a service principal in Azure Active Directory:</p>
<ol class="arabic">
<li><p>Sign in to <a class="reference external" href="https://portal.azure.com/">Azure Portal</a> using your Azure account.</p></li>
<li><p>Select <strong>Azure Active Directory</strong>.</p></li>
<li><p>Go to <strong>App registrations</strong> and click <strong>New registration</strong>.</p></li>
<li><p>In the <strong>Name</strong> field, specify a name for the application.</p></li>
<li><p>Under <strong>Supported account types</strong>, select <strong>Single tenant</strong>.</p></li>
<li><p>Under <strong>Redirect URI (optional)</strong>, select <strong>Web</strong> as the app type and provide the Redirect URI in the format <code class="docutils literal notranslate"><span class="pre">https://&lt;your_Alation_URL&gt;/api/datasource_auth/oauth/callback</span></code>. For example, <code class="docutils literal notranslate"><span class="pre">https://datacatalog.alation-test.com/api/datasource_auth/oauth/callback</span></code>. Make sure there is no forward slash <code class="docutils literal notranslate"><span class="pre">/</span></code> at the end of the URI.</p>
<blockquote>
<div><a class="with-border reference internal image-reference" href="../../_images/OCF_AzureDB_RegisterApp.png"><img alt="../../_images/OCF_AzureDB_RegisterApp.png" class="with-border" src="../../_images/OCF_AzureDB_RegisterApp.png" style="width: 600px;" /></a>
</div></blockquote>
</li>
<li><p>Click <strong>Register</strong> to complete the app registration. The <strong>Overview</strong> page is displayed.</p></li>
<li><p>Copy and save the <strong>Application (client) ID</strong> from the <strong>Essentials</strong> section on the Overview. You’ll need it during the configuration in Alation.</p></li>
<li><p>Go to the <strong>Endpoints</strong> tab. Copy the values of <strong>OAuth 2.0 authorization endpoint (v1)</strong> and <strong>OAuth 2.0 token endpoint (v1)</strong>, and save them. Make sure that you copy version 1 (<strong>v1</strong>) of the authorization and the token endpoints.</p>
<blockquote>
<div><img alt="../../_images/OCF_AzureDB_Endpoints.png" class="with-border" src="../../_images/OCF_AzureDB_Endpoints.png" />
</div></blockquote>
</li>
<li><p>From the main menu on the left, select <strong>API permissions</strong>.</p></li>
<li><p>Click <strong>Add a permission</strong> and select <strong>APIs my organization uses</strong>.</p></li>
<li><p>Search with the keyword <code class="docutils literal notranslate"><span class="pre">AzureDatabricks</span></code> and click the <strong>AzureDatabricks API</strong>. Make sure there is no space in the search keyword.</p></li>
<li><p>Select the <strong>User Impersonation</strong> permission and click <strong>Add permissions</strong>.</p>
<blockquote>
<div><img alt="../../_images/OCF_AzureDB_APIPermissions.png" class="with-border" src="../../_images/OCF_AzureDB_APIPermissions.png" />
</div></blockquote>
</li>
<li><p>On the <strong>API permissions</strong> page, select <strong>Grant admin consent for &lt;Account&gt;</strong> and in the pop-up dialog that opens, click <strong>Yes</strong>.</p></li>
<li><p>In the menu on the left, select <strong>Certificates &amp; secrets</strong>.</p></li>
<li><p>Click <strong>New client secret</strong> to add a new client secret. Specify a description, select an expiration period, and click <strong>Add</strong>.</p></li>
<li><p>Copy the client secret value and save it in a safe location. You only have one chance to copy the client secret value as it won’t be displayed again after you close this page.</p>
<blockquote>
<div><img alt="../../_images/OCF_AzureDB_Secret.png" class="with-border" src="../../_images/OCF_AzureDB_Secret.png" />
</div></blockquote>
</li>
</ol>
</section>
<section id="create-databricks-users">
<h2>Create Databricks Users<a class="headerlink" href="#create-databricks-users" title="Permalink to this headline">¶</a></h2>
<p>To connect to Azure Databricks or Unity Catalog in Compose, users must exist in Azure Databricks. Perform the following steps to add the users:</p>
<ol class="arabic">
<li><p>In Azure Databricks, go to Admin Settings.</p></li>
<li><p>Click <strong>Add User</strong> to add a new user and provide the user email in the dialog box.</p></li>
<li><p>Select the <strong>Admin</strong> checkbox for the new user to enable the user to run queries in Compose.</p>
<blockquote>
<div><a class="with-border reference internal image-reference" href="../../_images/OCF_AzureDB_AddUser.png"><img alt="../../_images/OCF_AzureDB_AddUser.png" class="with-border" src="../../_images/OCF_AzureDB_AddUser.png" style="width: 800px;" /></a>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the Admin permission cannot be granted, the <a class="reference external" href="https://docs.databricks.com/security/auth-authz/access-control/cluster-acl.html">Can Attach To permission</a> should also allow making connections with OAuth.</p>
</div>
</div></blockquote>
</li>
</ol>
</section>
<section id="configure-oauth-for-compose">
<h2>Configure OAuth for Compose<a class="headerlink" href="#configure-oauth-for-compose" title="Permalink to this headline">¶</a></h2>
<p>To enable OAuth in Compose for an Azure Databricks data source:</p>
<ol class="arabic">
<li><p>In Alation, open the Settings page of your Azure Databricks data source.</p></li>
<li><p>Go to the <strong>Compose</strong> tab.</p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>If it’s a Custom DB data source, go to the <strong>General Settings</strong> tab.</p>
</div>
</div></blockquote>
</li>
<li><p>Under <strong>Compose Connections</strong>, modify the default connection or create a new one. To enable OAuth, add parameters <code class="docutils literal notranslate"><span class="pre">Authmech=11;Auth_flow=0</span></code>.</p>
<blockquote>
<div><div class="admonition important">
<p class="admonition-title">Important</p>
<ul class="simple">
<li><p>The Azure Databricks OCF connector supports two JDBC URI formats with Compose OAuth—<code class="docutils literal notranslate"><span class="pre">spark://</span></code> (from connector version <strong>1.x</strong>) and <code class="docutils literal notranslate"><span class="pre">databricks://</span></code> (from connector version <strong>2.x</strong>).</p></li>
<li><p>The Databricks Unity Catalog OCF Connector only supports the <code class="docutils literal notranslate"><span class="pre">databricks://</span></code> JDBC URI format with Compose OAuth (from connector version <strong>2.1.x</strong>).</p></li>
</ul>
</div>
<p><strong>Example</strong>:</p>
<p><code class="docutils literal notranslate"><span class="pre">databricks://dbc-32am8401-ac16.cloud.databricks.com:443/default;transportMode=http;ssl=1;AuthMech=3;httpPath=/sql/1.0/warehouses/9f5d50hhsaeb0k23;UseNativeQuery=0;Authmech=11;Auth_flow=0;</span></code></p>
</div></blockquote>
</li>
<li><p>Under the <strong>OAuth Connection</strong> section, select the checkbox <strong>Enable OAuth 2.0 in Compose</strong>. This reveals several parameters for the OAuth setup.</p>
<blockquote>
<div><a class="with-border reference internal image-reference" href="../../_images/OCF_AzureDB_NewOAuthSettings.png"><img alt="../../_images/OCF_AzureDB_NewOAuthSettings.png" class="with-border" src="../../_images/OCF_AzureDB_NewOAuthSettings.png" style="width: 600px;" /></a>
</div></blockquote>
</li>
<li><p>Enter the values into the fields and click <strong>Save</strong>.</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 32%" />
<col style="width: 68%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Field</strong></p></th>
<th class="head"><p><strong>Value</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Client ID</p></td>
<td><p>Provide the client ID.</p></td>
</tr>
<tr class="row-odd"><td><p>Client Secret</p></td>
<td><p>Provide the client secret value.</p></td>
</tr>
<tr class="row-even"><td><p>Request Refresh Token</p></td>
<td><p>Select the <strong>Request Refresh Token</strong> to enable requests
for refresh tokens.</p></td>
</tr>
<tr class="row-odd"><td><p>Enable PKCE</p></td>
<td><p>Leave as is (unselected). This setting does not apply
to this data source type.</p></td>
</tr>
<tr class="row-even"><td><p>Authorization Endpoint</p></td>
<td><p>Provide the authorization endpoint.</p></td>
</tr>
<tr class="row-odd"><td><p>Token Endpoints</p></td>
<td><p>Provide the token endpoint.</p></td>
</tr>
<tr class="row-even"><td><p>Default Scope</p></td>
<td><p>Leave this field blank.</p></td>
</tr>
<tr class="row-odd"><td><p>Refresh Scope</p></td>
<td><p>Leave this field blank.</p></td>
</tr>
<tr class="row-even"><td><p>Username Field/Claim</p></td>
<td><p>Use the value <code class="docutils literal notranslate"><span class="pre">unique_name</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p>JWT</p></td>
<td><p>Select this checkbox (required).</p></td>
</tr>
<tr class="row-even"><td><p>Access Token Parameter
name</p></td>
<td><p>Use the value <code class="docutils literal notranslate"><span class="pre">Auth_AccessToken</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p>OAuth Enablers</p></td>
<td><p>Provide the value <code class="docutils literal notranslate"><span class="pre">Authmech=11&amp;Auth_flow=0</span></code>. Make sure
there is an ampersand symbol between the parameters.</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
</ol>
<p>The screenshot below shows an example of a Compose tab configuration:</p>
<blockquote>
<div><a class="with-border reference internal image-reference" href="../../_images/OCF_AzureDB_ComposeTab.png"><img alt="../../_images/OCF_AzureDB_ComposeTab.png" class="with-border" src="../../_images/OCF_AzureDB_ComposeTab.png" style="width: 600px;" /></a>
</div></blockquote>
</section>
<section id="connect-in-compose">
<h2>Connect in Compose<a class="headerlink" href="#connect-in-compose" title="Permalink to this headline">¶</a></h2>
<p>After you have completed the configuration, Compose users should be able to connect to Databricks via OAuth-enabled connections and run queries.</p>
<p>To connect to the database in Compose:</p>
<ol class="arabic">
<li><p>Click <strong>Connection Settings</strong> to open the connection settings dialog.</p>
<blockquote>
<div><img alt="../../_images/OCF_AzureDB_ConnectionSettings.png" class="with-border" src="../../_images/OCF_AzureDB_ConnectionSettings.png" />
</div></blockquote>
</li>
<li><p>In the <strong>Connection Settings</strong> dialog that opens, select the OAuth-enabled connection.</p>
<blockquote>
<div><a class="with-border reference internal image-reference" href="../../_images/OCF_AzureDB_SelectConnection.png"><img alt="../../_images/OCF_AzureDB_SelectConnection.png" class="with-border" src="../../_images/OCF_AzureDB_SelectConnection.png" style="width: 350px;" /></a>
</div></blockquote>
</li>
<li><p>From the <strong>Connect as (Select User)</strong> list, select your user or click <strong>Add New (SSO login)</strong>.</p>
<blockquote>
<div><a class="with-border reference internal image-reference" href="../../_images/OCF_AzureDB_SelectUser.png"><img alt="../../_images/OCF_AzureDB_SelectUser.png" class="with-border" src="../../_images/OCF_AzureDB_SelectUser.png" style="width: 350px;" /></a>
</div></blockquote>
</li>
<li><p>The Microsoft login page should open in a new tab. Authenticate with your Azure Databricks credentials.</p>
<blockquote>
<div><a class="with-border reference internal image-reference" href="../../_images/OCF_AzureDatabricks_SSO_Login.png"><img alt="../../_images/OCF_AzureDatabricks_SSO_Login.png" class="with-border" src="../../_images/OCF_AzureDatabricks_SSO_Login.png" style="width: 800px;" /></a>
</div></blockquote>
</li>
</ol>
<p>More information about the Connection Setting dialog can be found in <a class="reference internal" href="../../analyst/UserAuthenticationForDataSources/WorkingWithDataSourceConnections.html"><span class="doc">Working with Data Source Connections</span></a>.</p>
</section>
<section id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h2>
<p>If your OAuth configuration requires fine-tuning, you will get authorization errors in Alation. The error usually contains details about possible causes and may include troubleshooting tips.</p>
<p>Refer to the table below for message examples.</p>
<table class="longtable colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Error</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Authorization terminated
unexpectedly</p></td>
<td><p>This message is shown:</p>
<blockquote>
<div><ul class="simple">
<li><p>If the redirect browser window or tab is manually closed
before authorization completes.</p></li>
<li><p>If the Client ID specified in the OAuth configuration is
incorrect.</p></li>
<li><p>If the authorization endpoint is incorrect. The error
page will redirect to the URL provided if it exists or
throw the 404 error if no Redirect URL is provided.</p></li>
</ul>
</div></blockquote>
</td>
</tr>
<tr class="row-odd"><td><p>The authorization server
reported a failed authorization
attempt: &lt;message&gt;</p></td>
<td><p>If authorization fails, the authorization server may
respond with error details in the error message.
Examples:</p>
<blockquote>
<div><ul class="simple">
<li><p>Invalid scope defined as Default Scope in the data source
OAuth configuration.</p></li>
<li><p>Invalid scope defined as Refresh Scope in the data source
OAuth configuration.</p></li>
<li><p>The authorization step is canceled by some UI control on
an authorization, authentication, or consent screen.</p></li>
<li><p>The authorization step is canceled due to an
authentication failure.</p></li>
</ul>
</div></blockquote>
</td>
</tr>
<tr class="row-even"><td><p>Token request failed following
successful authorization</p></td>
<td><p>In some cases after successful authorization, the request
for tokens can fail. This message will be followed by further
details.</p></td>
</tr>
<tr class="row-odd"><td><p>There was a problem extracting
username information following
successful authorization and
token retrieval. Please check
the OAuth settings for the data
source</p></td>
<td><p>The causes of this error may be:</p>
<blockquote>
<div><ul>
<li><p>The OAuth configuration specifies that the username
should be extracted as a JWT claim but:</p>
<blockquote>
<div><ul class="simple">
<li><p>The access token can not be decoded as a JWT.</p></li>
<li><p>No JWT claim is specified in the OAuth configuration.</p></li>
<li><p>The specified claim does not exist in the token’s
claim set.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>The OAuth configuration specifies that the username
should not be extracted as a JWT claim but:</p>
<blockquote>
<div><ul class="simple">
<li><p>No username field is specified in the OAuth config.</p></li>
<li><p>The specified field does not exist in the response
returned from the authorization server upon token
request.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</td>
</tr>
<tr class="row-even"><td><p>Connection timeout</p></td>
<td><p>When the cluster is not running, the connection will time out
and return a connection error:</p>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>Ensure that the cluster is running.</p></li>
<li><p>Consider increasing the connection timeout seconds
in <strong>alation_conf</strong> (<code class="docutils literal notranslate"><span class="pre">alation.rpc.timeout.db_connect</span></code>)
to a value higher than your compute
cluster’s boot time. The default timeout is <code class="docutils literal notranslate"><span class="pre">17</span></code>.</p></li>
</ol>
</div></blockquote>
</td>
</tr>
<tr class="row-odd"><td><p>HTTP Response code: 400</p>
<p>Error Message: Authorization
related error response returned,
but no token expired message
received</p>
</td>
<td><p>Ensure that the signed-in user has permissions
to use the compute cluster in the connection URI.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="log-location">
<h2>Log Location<a class="headerlink" href="#log-location" title="Permalink to this headline">¶</a></h2>
<p>The log entries for OAuth authorization can be found in the file <code class="docutils literal notranslate"><span class="pre">/opt/alation/site/logs/uwsgi.log</span></code> (path inside the Alation shell).</p>
</section>
</section>


           </div>
          </div>
          <footer>

  
<div class="navigation-bar">

    <div class="navigation navigation--prev">
        
        <a class="navigation__link" href="DatabricksAzure.html">
            <button class="navigation__button">
                <i class="icon icon-left"></i>
            </button>
            <div class="navigation__title">
                <span class="heading">Previous</span> <br />Databricks Azure
            </div>
        </a>
        
    </div>

    <div class="navigation navigation--next">
        
        <a class="navigation__link" title="Accesskey Alt(+Shift)+p" accesskey="p" href="Denodo.html">
            <div class="navigation__title">
                <span class="heading">Next</span> <br />Denodo
            </div>
            <button class="navigation__button" title="Accesskey Alt(+Shift)+n" accesskey="n">
                <i class="icon icon-right"></i>
            </button>
        </a>
        
    </div>

</div>


</footer>

        </div>
      </div>

    </section>

    <div class="wy-nav-side wy-nav-secondary">
      <div class="wy-side-scroll">
        <div class="wy-side-scroll__content">
          <div class="wy-menu-secondary">
              <div class="comments">
    <a href="mailto:no-reply-docs-feedback@alation.com?subject=Documentation Feedback on datasources/CustomDB/DatabricksAzureOAuthForCompose&body=Alation%20welcomes%20your%20comments%20on%20typos,%20content%20accuracy%20and%20completeness,%20and%20whether%20you%20found%20this%20page%20helpful.%20You%20will%20not%20receive%20a%20reply%20to%20this%20email.">
        <i class="icon icon-envelope" aria-hidden="true"></i>Request docs changes
    </a>
    <a href="#open-modal-pdf">
        <i class="icon icon-pdf" aria-hidden="true"></i>Download PDF
    </a>
</div>
              
                <p class="wy-menu-secondary-header">On this page</p>
                <ul>
<li><a class="reference internal" href="#">Azure Databricks: Configure SSO through OAuth for Compose</a><ul>
<li><a class="reference internal" href="#workflow">Workflow</a></li>
<li><a class="reference internal" href="#create-service-principal-in-azure-active-directory">Create Service Principal in Azure Active Directory</a></li>
<li><a class="reference internal" href="#create-databricks-users">Create Databricks Users</a></li>
<li><a class="reference internal" href="#configure-oauth-for-compose">Configure OAuth for Compose</a></li>
<li><a class="reference internal" href="#connect-in-compose">Connect in Compose</a></li>
<li><a class="reference internal" href="#troubleshooting">Troubleshooting</a></li>
<li><a class="reference internal" href="#log-location">Log Location</a></li>
</ul>
</li>
</ul>

              
            </div>
          </div>
      </div>
    </div>

  </div>

  
  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->

  
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/clipboard.min.js"></script>
      <script type="text/javascript" src="../../_static/copybutton.js"></script>
      <script type="text/javascript" src="../../_static/js/rtd_sphinx_search.min.js"></script>
  
  <script type="text/javascript" src="../../_static/searchtools.js"></script> <script type="text/javascript" id="idPiwikScriptPlaceholder"></script><script type="text/javascript" src="../../_static/js/main.bundle.js"></script>
  <script type="text/javascript" src="../../_static/js/runtime.bundle.js"></script>

  
  

  
    <div id="open-modal-pdf" class="modal-window">
<div>
  <a href="#" title="Close" class="modal-close">Close</a>
  <h4>Alation Documentation PDF</h4>
  <p>This PDF contains all our documentation and is more than <b>120 MB</b> in size. We recommend using an ethernet or Wi-Fi connection for downloading.</p>
  <br>
  <div class="modal-buttons">
    <a href="https://pdf-docs.alation.com/AlationUserDocs.pdf" class="btn-cta btn-cta--primary" target="_blank">
      Download PDF
    </a>
    <a href="#" title="Close" class="btn-cta">Cancel</a>
  </div>
</div>
  

</body>
</html>
<!--3.6.17-->