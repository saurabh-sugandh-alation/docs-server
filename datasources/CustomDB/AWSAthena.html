
<!DOCTYPE html>
<html lang="" >
<head>
  <meta charset="utf-8"/>
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="book-version"      content=""/>
  <meta name="book-release"      content=""/>
  <meta name="docsearch:name"    content="Alation User Guide" />
  <meta name="docsearch:version" content="" />
  <meta name="docsearch:package_type" content="" />
	<meta name="robots" content="noindex" />

  
  <title>Amazon Athena &mdash; Alation User Guide</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  

  
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/main.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx_collapse.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/rtd_sphinx_search.min.css" type="text/css" />
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="Alation User Guide" href="#"/>
        <link rel="up" title="Custom DB" href="index.html"/>
        <link rel="next" title="Update Simba JDBC Driver for Amazon Athena to Support SSO" href="UpdateSimbaJDBCDriverForAthenaToSupportSSO.html"/>
        <link rel="prev" title="SQL Query QLI" href="SQLQueryBasedQLICustomDB.html"/>

	

	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-67846571-1"></script>
	<script>
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());

	gtag('config', 'UA-67846571-1');
	</script>

	<!-- Global site tag (gtag.js) - Google Analytics -->
	<!-- Second Google Analytics tag to assist mapping with mattermost.com visits --> 
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-120238482-1"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  gtag('config', 'UA-120238482-1');
	</script>


</head>

<body class="wy-body-for-nav" role="document">

  <header>
    <div class="header__container wy-max-content-width">
        <a href="/" class="header__logo">
            <img width="176" src="../../_static/img/logo-alation.svg" alt="Alation" />
        </a>
        <ul class="header__links">
            <li><a href="https://help.alation.com/s/">Alation Help Center</a></li>
        </ul>
    </div>
</header>

  <div class="wy-grid-for-nav wy-max-content-width">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-scroll__content">
          <div class="wy-side-nav-search">
            

            <ul class="sidebartop">
              <li class="nolink search"><div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search this project" aria-label="Search this project" id="searchinput" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
</li>

            </ul>

            
          </div>

          <div class="wy-menu wy-sidebar wy-sidebar--hidden" data-spy="affix" role="navigation" aria-label="main navigation">
            
              
              
              
                  <p class="caption" role="heading"><span class="caption-text">Welcome to Alation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/About/index.html">About Alation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/CloudAndOnPrem/index.html">Alation Cloud and On-Premise</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/QuickStart/index.html">Quick Start Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/UserProfileandPreferences/index.html">User Profile and Preferences</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/CatalogBasics/index.html">Catalog Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/Conversations/index.html">Conversations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/Domains/index.html">Domains</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/BestPractices/index.html">Best Practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/Glossary/index.html">Alation Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alation Cloud Service</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../cloud/StatusPage/index.html">Status Page</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cloud/CloudOverview/index.html">Cloud Service Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cloud/CloudConfiguration/index.html">Configuration for Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cloud/AlationAgent/index.html">Alation Agent</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alation Integration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../integration/AlationAnywhere/index.html">Alation Anywhere</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../integration/AlationConnectedSheets/index.html">Alation Connected Sheets</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Installation &amp; Configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/ServerInstallation/index.html">Install Alation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/HighAvailability/index.html">High Availability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/Runbook/index.html">Runbook for Administrators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/Update/index.html">Update Alation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/BackupandRestore/index.html">Back Up and Restore</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/LineageV2/index.html">Lineage V2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/LineageV3/index.html">Lineage V3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/AlationAnalyticsV2/index.html">Alation Analytics V2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/AlationContainerService/index.html">Alation Container Service</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Sources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../sources/CatalogSources/index.html">Catalog Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sources/VirtualDataSources/index.html">Virtual Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sources/Lineage/index.html">Lineage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sources/APIResources/index.html">API Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sources/WorkwithCatalogData/index.html">Working with Catalog Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sources/OpenConnectorFramework/index.html">Open Connector Framework</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Sources</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../DSConfiguration/index.html">Data Source Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AddDataSources/index.html">Adding Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ComposeSSOAWSDataSources/index.html">Compose SSO for Amazon Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ComposeSSOAzureDataSources/index.html">Compose SSO for Azure Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AuthenticationForExtraction/index.html">Authentication for Extraction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Custom DB</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="AddCustomDrivers.html">Add Custom Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="CDataDrivers.html">CData Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="DriverFixer.html">Driver Fixer</a></li>
<li class="toctree-l2"><a class="reference internal" href="AddCustomDBtoAlation.html">Add Custom DB to Alation</a></li>
<li class="toctree-l2"><a class="reference internal" href="MDEFromCustomDB.html">Metadata Extraction From Custom DB</a></li>
<li class="toctree-l2"><a class="reference internal" href="GuidelinesForMDEQueries.html">Guidelines for Creating Queries for MDE</a></li>
<li class="toctree-l2"><a class="reference internal" href="ProfilingForCustomDB.html">Sampling and Profiling</a></li>
<li class="toctree-l2"><a class="reference internal" href="QLIFromCustomDB.html">QLI From Custom DB</a></li>
<li class="toctree-l2"><a class="reference internal" href="FileBasedQLICustomDB.html">File-Based Query Log Ingestion</a></li>
<li class="toctree-l2"><a class="reference internal" href="ViewBasedQLICustomDB.html">View-Based QLI</a></li>
<li class="toctree-l2"><a class="reference internal" href="SQLQueryBasedQLICustomDB.html">SQL Query QLI</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Amazon Athena</a></li>
<li class="toctree-l2"><a class="reference internal" href="UpdateSimbaJDBCDriverForAthenaToSupportSSO.html">Update Simba JDBC Driver for Amazon Athena to Support SSO</a></li>
<li class="toctree-l2"><a class="reference internal" href="AWSDynamoDB.html">Amazon DynamoDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="AzureCosmosDB.html">Azure Cosmos DB</a></li>
<li class="toctree-l2"><a class="reference internal" href="AzureDW.html">Azure Data Warehouse (Azure SQL DW)</a></li>
<li class="toctree-l2"><a class="reference internal" href="ConfluentKafka.html">Confluent Kafka</a></li>
<li class="toctree-l2"><a class="reference internal" href="DatabricksforCustomDB.html">Databricks for Custom DB</a></li>
<li class="toctree-l2"><a class="reference internal" href="DatabricksAzure.html">Databricks Azure</a></li>
<li class="toctree-l2"><a class="reference internal" href="DatabricksAzureOAuthForCompose.html">Azure Databricks: Configure SSO through OAuth for Compose</a></li>
<li class="toctree-l2"><a class="reference internal" href="Denodo.html">Denodo</a></li>
<li class="toctree-l2"><a class="reference internal" href="Elasticsearch.html">Elasticsearch</a></li>
<li class="toctree-l2"><a class="reference internal" href="EMRSparkSQL.html">EMR SparkSQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="EMRPrestoWithAWSGlueAsMetastore.html">EMR Presto on Hive with AWS Glue as Metastore</a></li>
<li class="toctree-l2"><a class="reference internal" href="GCPDatabricks.html">GCP Databricks</a></li>
<li class="toctree-l2"><a class="reference internal" href="GitHub.html">GitHub</a></li>
<li class="toctree-l2"><a class="reference internal" href="MariaDB.html">MariaDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="MarkLogic.html">MarkLogic</a></li>
<li class="toctree-l2"><a class="reference internal" href="MongoDB.html">MongoDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="MongoDBAtlas.html">MongoDB Atlas</a></li>
<li class="toctree-l2"><a class="reference internal" href="NetSuite.html">NetSuite</a></li>
<li class="toctree-l2"><a class="reference internal" href="Parquet.html">Parquet (Amazon S3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="Salesforce.html">Salesforce</a></li>
<li class="toctree-l2"><a class="reference internal" href="Servicenow.html">ServiceNow</a></li>
<li class="toctree-l2"><a class="reference internal" href="Splunk.html">Splunk</a></li>
<li class="toctree-l2"><a class="reference internal" href="SSAS.html">SQL Server Analysis Service (SSAS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="StarburstEnterprisePresto.html">Starburst Enterprise (Presto)</a></li>
<li class="toctree-l2"><a class="reference internal" href="StarburstEnterpriseTrino.html">Starburst Enterprise (Trino)</a></li>
<li class="toctree-l2"><a class="reference internal" href="ReferenceForQueryBasedMDE.html">Example Queries for Query-Based MDE</a></li>
<li class="toctree-l2"><a class="reference internal" href="ReferenceFileBasedQLI.html">Example JSONs for File-Based QLI</a></li>
<li class="toctree-l2"><a class="reference internal" href="ToubleshootingForCDataDataSources.html">Troubleshooting for CData Data Sources</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../GBQ/index.html">Google BigQuery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Hive/index.html">Hive</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">BI Sources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../bisources/AddBISources/index.html">Add BI Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bisources/AddTableauServer/index.html">Add Tableau Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bisources/WorkwithBISources/index.html">Working with BI Sources</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">File System Sources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/FileSystems/index.html">Add File Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/VirtualFileSystems/index.html">Virtual File Systems</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alation for Analysts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../analyst/UserAuthenticationForDataSources/index.html">User Authentication for Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analyst/ShareAndAccessQueries/index.html">Share and Access Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analyst/WriteQueries/index.html">Write Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analyst/DevelopQueries/index.html">Develop Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analyst/WorkwithQueryResults/index.html">Work with Query Results</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alation for Data Stewards</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../steward/GovernanceApp/index.html">Governance App</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/PolicyCenter/index.html">Policy Center</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/Workflow/index.html">Workflow Center</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/GovernanceDashboard/index.html">Governance Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/StewardshipWorkbench/index.html">Stewardship Workbench</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/AnalyticsStewardship/index.html">Analytics Stewardship</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/Glossary/index.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/ArticlesAndTags/index.html">Articles and Tags</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/ArticleGroups/index.html">Article Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/DataCatalogCustomization/index.html">Customize Your Data Catalog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/DataDocumentation/index.html">Data Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/AutoTitlingandLexicon/index.html">Auto-titling and Lexicon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/SnowflakeTags/index.html">Snowflake Tags</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alation for Server Administrators</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../admins/CustomizableHomePage/index.html">Customizable Homepage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/AdminSettings/index.html">Administrator Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/AdditionalConfiguration/index.html">Additional Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/RunbookForAdministrators/index.html">Runbook for Administrators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/AlationAPIs/index.html">Alation APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/How-tos/index.html">How-tos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/Troubleshooting/index.html">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Release Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../releases/releasenotes/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/supportmatrices/index.html">Support Matrices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/endofsupport/index.html">End Of Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/snowflakeclladdon/index.html">Snowflake Parser Add-On</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/fieldnotices/index.html">Important Notices and Security Alerts</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Archived Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../archive/About/index.html">About the Documentation Archive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../archive/AdminConfig/index.html">Administration and Update Archive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../archive/ReleaseNotes/index.html">Release Notes Archive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../archive/Usage/index.html">Usage and Customization Archive</a></li>
</ul>

              
            
          </div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="wy-nav-top-icon"></i>
        <a href="../../index.html">Alation User Guide</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">

          <div role="navigation" aria-label="breadcrumbs" class="breadcrumbs">
    <a href="../../index.html">Docs</a>
    <span class="separator">&gt;</span>
    <a href="index.html">Custom DB</a>
    <span class="separator">&gt;</span>
    <span>Amazon Athena</span>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody" class="toBeIndexed">
            
  <section id="amazon-athena">
<h1>Amazon Athena<a class="headerlink" href="#amazon-athena" title="Permalink to this headline">¶</a></h1>
<p><strong>Supported as Custom DB from version 2020.3</strong></p>
<p>Amazon Athena is supported with the Custom DB functionality and Simba Athena JDBC driver version 2.0.9.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>It is strongly recommended to enable the Presto grammar parser instead of the default general SQL parser for Amazon Athena data sources. The use of the Presto grammar parser guarantees better results for Athena QLI. Please create a ticket for the Alation Support to have the Presto parser enabled for your Athena data source.</p>
</div>
<section id="scope-of-support">
<h2>Scope of Support<a class="headerlink" href="#scope-of-support" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p>Authentication with the Access Key and Secret Key</p></li>
<li><p>Full and selective Metadata Extraction (MDE), for tables and views.</p>
<blockquote>
<div><ul class="simple">
<li><p>Automatic MDE</p></li>
<li><p>From <em>version 2021.3</em> Alation supports authentication with AWS IAM for MDE and QLI</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Table and Column Profiling</p>
<blockquote>
<div><ul class="simple">
<li><p>Automatic Profiling</p></li>
<li><p>Query-based Profiling</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Compose</p>
<blockquote>
<div><ul class="simple">
<li><p><em>From version 2021.1</em>, Alation supports SSO connection to Athena for end-users: <a class="reference internal" href="../ComposeSSOAWSDataSources/index.html"><span class="doc">Compose SSO for Amazon Data Sources</span></a></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Compose SSO authentication does not apply to the service account used for MDE, automatic profiling, and QLI.</p>
</div>
</div></blockquote>
</li>
<li><p><em>From version 2020.4</em>, Alation supports QLI from Amazon Athena using AWS CloudTrail events.</p></li>
</ul>
<section id="limitations">
<h3>Limitations<a class="headerlink" href="#limitations" title="Permalink to this headline">¶</a></h3>
<p>Support has not been certified for:</p>
<ul class="simple">
<li><p>Custom query-based MDE</p></li>
<li><p>Federated queries in Compose</p></li>
<li><p>Concurrent queries in Compose</p></li>
</ul>
</section>
</section>
<section id="aws-billing">
<h2>AWS Billing<a class="headerlink" href="#aws-billing" title="Permalink to this headline">¶</a></h2>
<p>Billable by Amazon on your AWS account:</p>
<ul class="simple">
<li><p>The queries Alation runs on the connected Amazon Athena database instance during MDE and profiling</p></li>
<li><p>The queries users run in Alation Compose</p></li>
</ul>
</section>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>You have the required driver for Amazon Athena</p></li>
<li><p>You have SSH access to the Alation instance or access via a terminal (for example, Putty or iTerm2)</p></li>
<li><p>You will need to add the driver Alation and then fix it with the Driver Fixer tool</p></li>
</ul>
<section id="ports">
<h3>Ports<a class="headerlink" href="#ports" title="Permalink to this headline">¶</a></h3>
<p>Port <strong>443</strong> must be open and port <strong>444</strong> may need to be open too (see <a class="reference internal" href="#mde-works-but-profiling-and-compose-time-out">MDE Works but Profiling and Compose Time Out</a> below).</p>
<p>Any load balancers/proxy servers must be configured to forward traffic over these ports to the Alation instance.</p>
</section>
<section id="required-information">
<h3>Required Information<a class="headerlink" href="#required-information" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Your AWS region</p></li>
<li><p>The output path of the Amazon S3 location where Amazon Athena stores query results</p></li>
<li><p>A service account for Alation:</p>
<blockquote>
<div><ul class="simple">
<li><p>Access key</p></li>
<li><p>Secret key</p></li>
<li><p>The appropriate managed policies must be granted to the Alation service account to run MDE and profiling on databases in Athena</p></li>
</ul>
</div></blockquote>
</li>
<li><p>QLI uses AWS CloudTrail and requires additional configuration.</p></li>
</ul>
</section>
<section id="service-account">
<h3>Service Account<a class="headerlink" href="#service-account" title="Permalink to this headline">¶</a></h3>
<p>Use the information in this section if you choose to authenticate to Amazon Athena using a service account.</p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>From version 2021.3, you can authenticate with AWS IAM without using a service account. For details, see <a class="reference internal" href="../AuthenticationForExtraction/ConfigureMDEwithAWS_IAM_Auth.html"><span class="doc">Configure Extraction with AWS IAM Authentication</span></a>.</p>
</div>
</div></blockquote>
<section id="use-an-existing-iam-user-account">
<h4>Use an Existing IAM User Account<a class="headerlink" href="#use-an-existing-iam-user-account" title="Permalink to this headline">¶</a></h4>
<p>You can use an existing Amazon Athena account as the Service Account for Alation:</p>
<ul class="simple">
<li><p>Note that the billing for queries run by Alation during MDE and profiling and the billing for queries run by this account in Athena and in Compose will be combined;</p></li>
<li><p>The existing account must be assigned the managed policies recommended by Alation (AmazonAthenaFullAccess, access to the default S3 results bucket, access to the S3 buckets in AWS Glue).</p></li>
</ul>
</section>
<section id="create-new-iam-user-account">
<h4>Create New IAM User Account<a class="headerlink" href="#create-new-iam-user-account" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p>Create a new IAM user account for Alation</p>
<blockquote>
<div><div class="admonition important">
<p class="admonition-title">Important</p>
<p>Be sure to save the access and secret keys. If you lose the secret key you will have to create another account.</p>
</div>
</div></blockquote>
</li>
<li><p>If permitted, attach the following AWS managed policy:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">AmazonAthenaFullAccess</span></code></p></li>
</ul>
</div></blockquote>
<p>This policy:</p>
<blockquote>
<div><ul>
<li><p>Creates a default <code class="docutils literal notranslate"><span class="pre">athena-examples</span></code> bucket</p></li>
<li><p>Grants the user access to:</p>
<blockquote>
<div><ul class="simple">
<li><p>All Athena actions</p></li>
<li><p>Most AWS Glue actions (such as CREATE DATABASE)</p></li>
<li><p>Access to the default S3 results bucket (for query results) <code class="docutils literal notranslate"><span class="pre">&quot;arn:aws:s3:::aws-athena-query-results-*&quot;</span></code></p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
<p>You may need to edit the inline policies as prescribed by your company’s access rules.</p>
<p>For additional information on setting up an IAM account for Amazon Athena, refer to <a class="reference external" href="https://docs.aws.amazon.com/athena/latest/ug/setting-up.html">Amazon Athena documentation</a>.</p>
</section>
</section>
<section id="qli-setup">
<h3>QLI Setup<a class="headerlink" href="#qli-setup" title="Permalink to this headline">¶</a></h3>
<p>Alation QLI uses AWS CloudTrail events and requires the <a class="reference external" href="https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-user-guide.html">AWS CloudTrail</a> to be enabled on the AWS account.</p>
<ol class="arabic">
<li><p>Verify that the CloudTrail Trail for your AWS account logs Amazon Athena queries. The event type <a class="reference external" href="https://docs.aws.amazon.com/athena/latest/APIReference/API_StartQueryExecution.html">StartQueryExecution</a> should be logged.</p></li>
<li><p>In Athena, create an external table using the SQL template below. The external table can be created in any available database, including the Default database. When using the template below, make sure to specify the correct values instead of the placeholder values (such as the table name and the CloudTrail S3 bucket name):</p>
<blockquote>
<div><div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">EXTERNAL</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">default</span><span class="p">.</span><span class="n">athena_qli</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">eventversion</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<span class="w">    </span><span class="n">userIdentity</span><span class="w"> </span><span class="n">STRUCT</span><span class="o">&lt;</span><span class="w"> </span><span class="k">type</span><span class="p">:</span><span class="n">STRING</span><span class="p">,</span>
<span class="w">    </span><span class="n">principalid</span><span class="p">:</span><span class="n">STRING</span><span class="p">,</span>
<span class="w">    </span><span class="n">arn</span><span class="p">:</span><span class="n">STRING</span><span class="p">,</span>
<span class="w">    </span><span class="n">accountid</span><span class="p">:</span><span class="n">STRING</span><span class="p">,</span>
<span class="w">    </span><span class="n">invokedby</span><span class="p">:</span><span class="n">STRING</span><span class="p">,</span>
<span class="w">    </span><span class="n">accesskeyid</span><span class="p">:</span><span class="n">STRING</span><span class="p">,</span>
<span class="w">    </span><span class="n">userName</span><span class="p">:</span><span class="n">STRING</span><span class="p">,</span>
<span class="w">    </span><span class="n">sessioncontext</span><span class="p">:</span><span class="n">STRUCT</span><span class="o">&lt;</span><span class="w"> </span><span class="n">attributes</span><span class="p">:</span><span class="n">STRUCT</span><span class="o">&lt;</span><span class="w"> </span><span class="n">mfaauthenticated</span><span class="p">:</span><span class="n">STRING</span><span class="p">,</span>
<span class="w">    </span><span class="n">creationdate</span><span class="p">:</span><span class="n">STRING</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="n">sessionIssuer</span><span class="p">:</span><span class="n">STRUCT</span><span class="o">&lt;</span><span class="w"> </span><span class="k">type</span><span class="p">:</span><span class="n">STRING</span><span class="p">,</span>
<span class="w">    </span><span class="n">principalId</span><span class="p">:</span><span class="n">STRING</span><span class="p">,</span>
<span class="w">    </span><span class="n">arn</span><span class="p">:</span><span class="n">STRING</span><span class="p">,</span>
<span class="w">    </span><span class="n">accountId</span><span class="p">:</span><span class="n">STRING</span><span class="p">,</span>
<span class="w">    </span><span class="n">userName</span><span class="p">:</span><span class="n">STRING</span><span class="o">&gt;&gt;&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="n">eventTime</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<span class="w">    </span><span class="n">eventSource</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<span class="w">    </span><span class="n">eventName</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<span class="w">    </span><span class="n">awsRegion</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<span class="w">    </span><span class="n">sourceIpAddress</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<span class="w">    </span><span class="n">userAgent</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<span class="w">    </span><span class="n">errorCode</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<span class="w">    </span><span class="n">errorMessage</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<span class="w">    </span><span class="n">requestParameters</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<span class="w">    </span><span class="n">responseElements</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<span class="w">    </span><span class="n">additionalEventData</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<span class="w">    </span><span class="n">requestId</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<span class="w">    </span><span class="n">eventId</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<span class="w">    </span><span class="n">resources</span><span class="w"> </span><span class="nb">ARRAY</span><span class="o">&lt;</span><span class="n">STRUCT</span><span class="o">&lt;</span><span class="w"> </span><span class="n">ARN</span><span class="p">:</span><span class="n">STRING</span><span class="p">,</span>
<span class="w">    </span><span class="n">accountId</span><span class="p">:</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="n">STRING</span><span class="o">&gt;&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="n">eventType</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<span class="w">    </span><span class="n">apiVersion</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<span class="w">    </span><span class="n">readOnly</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<span class="w">    </span><span class="n">recipientAccountId</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<span class="w">    </span><span class="n">serviceEventDetails</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<span class="w">    </span><span class="n">sharedEventID</span><span class="w"> </span><span class="n">STRING</span><span class="p">,</span>
<span class="w">    </span><span class="n">vpcEndpointId</span><span class="w"> </span><span class="n">STRING</span>
<span class="p">)</span><span class="w"> </span><span class="n">PARTITIONED</span><span class="w"> </span><span class="k">BY</span><span class="p">(</span>
<span class="w">    </span><span class="n">region</span><span class="w"> </span><span class="n">string</span><span class="p">,</span>
<span class="w">    </span><span class="k">year</span><span class="w"> </span><span class="n">string</span><span class="p">,</span>
<span class="w">    </span><span class="k">month</span><span class="w"> </span><span class="n">string</span><span class="p">,</span>
<span class="w">    </span><span class="k">day</span><span class="w"> </span><span class="n">string</span>
<span class="p">)</span>
<span class="k">ROW</span><span class="w"> </span><span class="n">FORMAT</span><span class="w"> </span><span class="n">SERDE</span><span class="w"> </span><span class="s1">&#39;com.amazon.emr.hive.serde.CloudTrailSerde&#39;</span>
<span class="n">STORED</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">INPUTFORMAT</span><span class="w"> </span><span class="s1">&#39;com.amazon.emr.cloudtrail.CloudTrailInputFormat&#39;</span>
<span class="n">OUTPUTFORMAT</span><span class="w"> </span><span class="s1">&#39;org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat&#39;</span>
<span class="k">LOCATION</span><span class="w"> </span><span class="s1">&#39;s3://bucket/AWSLogs/&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Alation recommends to partition the external table. You can create empty partitions for the future that span a desired logging period. Be careful not to overrun any quotas on the DDL statements on concurrent query limits. Note that there are tools that can help avoid issuing too many queries at a time, such as <a class="reference external" href="https://github.com/guardian/athena-cli">athena-cli</a>. When using the template below, make sure to specify the correct values instead of the example values.</p>
<blockquote>
<div><div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- add the partitions</span>
<span class="c1">-- be careful not to run too fast so that you don&#39;t overrun any quotas or limits on the DDL statements on concurrent query limits</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">default</span><span class="p">.</span><span class="n">athena_qli</span><span class="w"> </span><span class="k">ADD</span>
<span class="n">PARTITION</span><span class="w"> </span><span class="p">(</span><span class="n">region</span><span class="o">=</span><span class="s1">&#39;us-east-1&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">year</span><span class="o">=</span><span class="s1">&#39;2020&#39;</span><span class="p">,</span><span class="k">month</span><span class="o">=</span><span class="s1">&#39;06&#39;</span><span class="p">,</span><span class="k">day</span><span class="o">=</span><span class="s1">&#39;15&#39;</span><span class="p">)</span>
<span class="k">LOCATION</span><span class="w"> </span><span class="s1">&#39;s3://bucket/AWSLogs/313374953141/CloudTrail/us-east-1/2020/06/15/&#39;</span><span class="p">;</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">default</span><span class="p">.</span><span class="n">athena_qli</span><span class="w"> </span><span class="k">ADD</span>
<span class="n">PARTITION</span><span class="w"> </span><span class="p">(</span><span class="n">region</span><span class="o">=</span><span class="s1">&#39;us-east-1&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">year</span><span class="o">=</span><span class="s1">&#39;2020&#39;</span><span class="p">,</span><span class="k">month</span><span class="o">=</span><span class="s1">&#39;06&#39;</span><span class="p">,</span><span class="k">day</span><span class="o">=</span><span class="s1">&#39;16&#39;</span><span class="p">)</span>
<span class="k">LOCATION</span><span class="w"> </span><span class="s1">&#39;s3://bucket/AWSLogs/313374953141/CloudTrail/us-east-1/2020/06/16/&#39;</span><span class="p">;</span>
<span class="c1">-- Add more partitions as necessary</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Alation recommends creating a QLI View for the external table and then use the <em>View-based QLI</em> configuration on the Alation side. Alternatively, you can use <em>custom query-based QLI</em> configuration, which does not require this view. If you intend to use query-based QLI, still note down the query template in the example below. The query template given below includes comments on choices you can make when writing the SQL for your Athena data source. Make sure to substitute placeholder values with real values.</p>
<blockquote>
<div><div class="admonition important">
<p class="admonition-title">Important</p>
<p>If you are using the OEM Athena Simba driver, schemas are cataloged as <code class="docutils literal notranslate"><span class="pre">AWSDataCatalog.&lt;schema_name&gt;</span></code>.  If a query has only two parts, for example <code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">*</span> <span class="pre">from</span> <span class="pre">schema.table</span></code> it will not be parsed in Alation  even if you pass in <code class="docutils literal notranslate"><span class="pre">defaultdatabases</span> <span class="pre">=</span> <span class="pre">awsdatacatalog</span></code>.  To fix this, include the following Replace script to replace every schema name in the query SQL with the two-part identifier.  Example:</p>
<blockquote>
<div><div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">REPLACE</span>
<span class="w">  </span><span class="p">(</span><span class="k">REPLACE</span>
<span class="w">    </span><span class="p">(</span><span class="k">REPLACE</span>
<span class="w">      </span><span class="p">(</span><span class="k">REPLACE</span>
<span class="w">        </span><span class="p">(</span><span class="n">json_extract_scalar</span>
<span class="w">        </span><span class="p">(</span><span class="n">requestParameters</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.queryString&#39;</span><span class="p">),</span>
<span class="w">        </span><span class="s1">&#39;schema1&#39;</span><span class="p">,</span><span class="s1">&#39;awsdatacatalog.schema1&#39;</span><span class="p">),</span>
<span class="w">        </span><span class="s1">&#39;schema2&#39;</span><span class="p">,</span><span class="s1">&#39;awsdatacatalog.schema2&#39;</span><span class="p">),</span>
<span class="w">        </span><span class="s1">&#39;schema3&#39;</span><span class="p">,</span><span class="s1">&#39;awsdatacatalog.schema3&#39;</span><span class="p">),</span>
<span class="w">        </span><span class="s1">&#39;schema4&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;awsdatacatalog.schema4&#39;</span><span class="p">)</span>
<span class="w">      </span><span class="k">AS</span><span class="w"> </span><span class="n">queryString</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div></blockquote>
</li>
</ol>
<p><strong>QLI View SQL template</strong></p>
<blockquote>
<div><div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">awsdatacatalog</span><span class="p">.</span><span class="k">default</span><span class="p">.</span><span class="n">athena_qli_view</span><span class="w"> </span><span class="k">AS</span>
<span class="k">SELECT</span>
<span class="w">  </span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">useridentity</span><span class="p">.</span><span class="k">type</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">)</span>
<span class="w">    </span><span class="k">WHEN</span><span class="w"> </span><span class="s1">&#39;AssumedRole&#39;</span>
<span class="w">    </span><span class="k">THEN</span><span class="w"> </span><span class="n">SUBSTR</span><span class="p">(</span><span class="n">useridentity</span><span class="p">.</span><span class="n">principalid</span><span class="p">,</span><span class="w"> </span><span class="k">position</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">useridentity</span><span class="p">.</span><span class="n">principalid</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="k">WHEN</span><span class="w"> </span><span class="s1">&#39;IAMUser&#39;</span>
<span class="w">    </span><span class="k">THEN</span><span class="w"> </span><span class="n">useridentity</span><span class="p">.</span><span class="n">username</span>
<span class="w">    </span><span class="k">ELSE</span><span class="w"> </span><span class="n">useridentity</span><span class="p">.</span><span class="n">username</span>
<span class="w">    </span><span class="k">END</span><span class="p">)</span>
<span class="k">AS</span><span class="w"> </span><span class="n">userName</span>
<span class="p">,</span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">defaultDatabases</span>
<span class="c1">-- database is not dependable. User may pick a default database but write the query &lt;schema&gt;.&lt;table&gt; where &lt;schema&gt; is different from the default database.  Unfortunately defaultDatabase overrides this so you don&#39;t get the query.</span>
<span class="p">,</span><span class="n">json_extract_scalar</span><span class="p">(</span><span class="n">responseElements</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.queryExecutionId&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">sessionId</span>
<span class="p">,</span><span class="n">eventtime</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">sessionStartTime</span>
<span class="p">,</span><span class="n">eventtime</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">startTime</span>
<span class="c1">-- if using SIMBA driver you will need to append the catalog name (usually awsdatacatalog) to each schema name. Example:</span>
<span class="c1">-- REPLACE(REPLACE(REPLACE(REPLACE(json_extract_scalar(requestParameters, &#39;$.queryString&#39;),&#39;schema1&#39;,&#39;awsdatacatalog.schema1&#39;), &#39;schema2&#39;,&#39;awsdatacatalog.schema2&#39;), &#39;schema3&#39;, &#39;awsdatacatalog.schema3&#39;), &#39;schema4&#39;, &#39;awsdatacatalog.schema4&#39;) AS queryString</span>
<span class="p">,</span><span class="n">json_extract_scalar</span><span class="p">(</span><span class="n">requestParameters</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.queryString&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">queryString</span>
<span class="p">,</span><span class="k">NULL</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">milliseconds</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">awsdatacatalog</span><span class="p">.</span><span class="k">default</span><span class="p">.</span><span class="n">athena_qli</span>
<span class="k">WHERE</span><span class="w"> </span><span class="mi">1</span><span class="o">=</span><span class="mi">1</span>
<span class="c1">-- set for the appropriate region</span>
<span class="k">AND</span><span class="w"> </span><span class="n">region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;us-east-1&#39;</span>
<span class="c1">-- use next three lines for testing using a single partition; otherwise comment out</span>
<span class="c1">-- AND year = &#39;2020&#39;</span>
<span class="c1">-- AND month = &#39;07&#39;</span>
<span class="c1">-- AND day = &#39;01&#39;</span>
<span class="c1">-- next three lines will always pull queries from the previous partition (previous 24 hours)</span>
<span class="c1">-- use for automated qli</span>
<span class="c1">-- AND year = date_format(date_add(&#39;day&#39;,-1,current_date),&#39;%Y&#39;)</span>
<span class="c1">-- AND month = date_format(date_add(&#39;day&#39;,-1,current_date),&#39;%m&#39;)</span>
<span class="c1">-- AND day = date_format(date_add(&#39;day&#39;,-1,current_date),&#39;%d&#39;)</span>
<span class="c1">-- various filters to keep &quot;junk&quot; queries out of Alation, feel free to add/delete as needed</span>
<span class="k">AND</span><span class="w"> </span><span class="n">json_extract_scalar</span><span class="p">(</span><span class="n">requestParameters</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.queryString&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s1">&#39;SHOW SCHEMAS&#39;</span>
<span class="k">AND</span><span class="w"> </span><span class="n">json_extract_scalar</span><span class="p">(</span><span class="n">requestParameters</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.queryString&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;SHOW TABLES IN%&#39;</span>
<span class="k">AND</span><span class="w"> </span><span class="n">json_extract_scalar</span><span class="p">(</span><span class="n">requestParameters</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.queryString&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s1">&#39;SELECT 1&#39;</span>
<span class="c1">-- next line pulls only queries without an error code (i.e. completed queries)</span>
<span class="k">AND</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">ErrorCode</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">)</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span>
<span class="c1">-- pulls only the Athena query events; do not comment out</span>
<span class="k">AND</span><span class="w"> </span><span class="n">eventname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;StartQueryExecution&#39;</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>A finished query example</strong></p>
<blockquote>
<div><div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">awsdatacatalog</span><span class="p">.</span><span class="k">default</span><span class="p">.</span><span class="n">test_QLI_view</span><span class="w"> </span><span class="k">AS</span>
<span class="k">SELECT</span>
<span class="w">  </span><span class="k">CASE</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">useridentity</span><span class="p">.</span><span class="k">type</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">)</span>
<span class="w">  </span><span class="k">WHEN</span><span class="w"> </span><span class="s1">&#39;AssumedRole&#39;</span>
<span class="w">  </span><span class="k">THEN</span><span class="w"> </span><span class="n">SUBSTR</span><span class="p">(</span><span class="n">useridentity</span><span class="p">.</span><span class="n">principalid</span><span class="p">,</span><span class="w"> </span><span class="k">position</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="n">useridentity</span><span class="p">.</span><span class="n">principalid</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="w">  </span><span class="k">WHEN</span><span class="w"> </span><span class="s1">&#39;IAMUser&#39;</span>
<span class="w">  </span><span class="k">THEN</span><span class="w"> </span><span class="n">useridentity</span><span class="p">.</span><span class="n">username</span>
<span class="w">  </span><span class="k">ELSE</span><span class="w"> </span><span class="n">useridentity</span><span class="p">.</span><span class="n">username</span>
<span class="w">  </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">userName</span>
<span class="w">  </span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">defaultDatabases</span>
<span class="w">  </span><span class="p">,</span><span class="n">json_extract_scalar</span><span class="p">(</span><span class="n">responseElements</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.queryExecutionId&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">sessionId</span>
<span class="w">  </span><span class="p">,</span><span class="n">eventtime</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">sessionStartTime</span>
<span class="w">  </span><span class="p">,</span><span class="n">eventtime</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">startTime</span>
<span class="w">  </span><span class="p">,</span><span class="n">json_extract_scalar</span><span class="p">(</span><span class="n">requestParameters</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.queryString&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">queryString</span>
<span class="w">  </span><span class="p">,</span><span class="s1">&#39;null&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">milliseconds</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">awsdatacatalog</span><span class="p">.</span><span class="k">default</span><span class="p">.</span><span class="n">athena_qli_test</span>
<span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="mi">1</span><span class="o">=</span><span class="mi">1</span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;us-east-1&#39;</span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">json_extract_scalar</span><span class="p">(</span><span class="n">requestParameters</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.queryString&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s1">&#39;SHOW SCHEMAS&#39;</span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">json_extract_scalar</span><span class="p">(</span><span class="n">requestParameters</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.queryString&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;SHOW TABLES IN%&#39;</span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">json_extract_scalar</span><span class="p">(</span><span class="n">requestParameters</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.queryString&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s1">&#39;SELECT 1&#39;</span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">ErrorCode</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">)</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span>
<span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">eventname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;StartQueryExecution&#39;</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="5">
<li><p>Note down the fully qualified name of the QLI View. You will need to specify it in Alation when configuring QLI.</p></li>
</ol>
</section>
</section>
<section id="step-1-add-the-amazon-athena-simba-driver-to-alation">
<h2>Step 1: Add the Amazon Athena Simba Driver to Alation<a class="headerlink" href="#step-1-add-the-amazon-athena-simba-driver-to-alation" title="Permalink to this headline">¶</a></h2>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The use of the Simba JDBC driver for Amazon Athena follows 2 scenarios:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>If you are going to configure SSO through an IdP for your Athena data source or MDE with authentication through AWS IAM, you will need to modify the Simba JDBC driver by adding the <em>CustomSessionCredentialsProvider</em> java class. See <a class="reference internal" href="UpdateSimbaJDBCDriverForAthenaToSupportSSO.html"><span class="doc">Update the Simba JDBC Driver for Amazon Athena to Support SSO</span></a>.</p></li>
<li><p>If you are not planning on using SSO for your Athena data source or MDE with authentication through AWS IAM, you do not need to repackage the driver before using it in Alation. Follow instructions in <a class="reference internal" href="AddCustomDrivers.html"><span class="doc">Add Custom Drivers</span></a> to add the driver to Alation and use the Driver Fixer tool to fix the driver.</p></li>
</ol>
</div></blockquote>
</div>
</section>
<section id="step-2-add-data-source">
<h2>Step 2: Add Data Source<a class="headerlink" href="#step-2-add-data-source" title="Permalink to this headline">¶</a></h2>
<p>After you have collected the required information and moved the custom driver to the Alation server, you can add your Amazon Athena data source to the catalog:</p>
<ol class="arabic">
<li><p>Sign into Alation and create a new data source. Select <strong>Custom DB</strong> as <strong>Database Type</strong>.</p></li>
<li><p>Construct the JDBC URI. At the beginning of the URI, do not type the <code class="docutils literal notranslate"><span class="pre">JDBC</span></code> prefix.</p>
<blockquote>
<div><ul>
<li><p><strong>Format</strong>:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">awsathena://&lt;your_AWS_URL&gt;:443;S3OutputLocation=s3://&lt;your</span> <span class="pre">S3</span> <span class="pre">location&gt;</span></code></p>
</div></blockquote>
</li>
<li><p><strong>Examples</strong>:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">awsathena://athena.us-west-1.amazonaws.com:443;S3OutputLocation=s3://aws-athena-query-results-313374953141-us-east-1</span></code></p>
<ul class="simple">
<li><p>If the S3 output location is defined in the default workgroup: <code class="docutils literal notranslate"><span class="pre">awsathena://&lt;your_AWS_URL&gt;:443</span></code></p></li>
<li><p>If the S3 output location is defined in a workgroup other than default: <code class="docutils literal notranslate"><span class="pre">awsathena://&lt;your_AWS_URL&gt;:443;workgroup=&lt;your</span> <span class="pre">workgroup&gt;</span></code></p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p>From the <strong>Select Driver</strong> dropdown list, select the Amazon Athena Simba driver you have added to the Alation server:</p>
<blockquote>
<div><a class="reference internal image-reference" href="../../_images/DS_Athena01.png"><img alt="../../_images/DS_Athena01.png" src="../../_images/DS_Athena01.png" style="width: 350px;" /></a>
</div></blockquote>
</li>
<li><p>Click <strong>Save and Continue</strong>. The next wizard screen - <strong>Set Up a Service Account</strong> - will open.</p></li>
<li><p>Select <strong>Yes</strong> and enter:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>Username</strong>—the access key</p></li>
<li><p><strong>Password</strong>—the secret key.</p></li>
</ul>
<a class="reference internal image-reference" href="../../_images/DS_Athena01.png"><img alt="../../_images/DS_Athena01.png" src="../../_images/DS_Athena01.png" style="width: 350px;" /></a>
</div></blockquote>
</li>
<li><p>Click <strong>Save and Continue</strong>. The next wizard screen, <strong>Configure Your Data Source</strong>, will open. Click <strong>Skip This Step</strong>.</p></li>
</ol>
<p>You will be navigated to the <strong>Access</strong> tab of the data source Settings page.</p>
</section>
<section id="step-3-configure-settings">
<h2>Step 3: Configure Settings<a class="headerlink" href="#step-3-configure-settings" title="Permalink to this headline">¶</a></h2>
<p>Complete the configuration of the data source on each tab of the Settings:</p>
<blockquote>
<div><ul>
<li><p><strong>Access</strong>: verify the Privacy settings</p></li>
<li><p><strong>General Settings</strong>: verify connectivity and other settings that apply</p></li>
<li><p><strong>Custom Settings</strong>: set <a class="reference internal" href="MDEFromCustomDB.html#metadata-extraction-from-custom-db-set-the-catalog-object-definition"><span class="std std-ref">Catalog Object Definition</span></a> and/or <a class="reference internal" href="ProfilingForCustomDB.html#sampling-profiling-limit-query-template"><span class="std std-ref">Limit Query Template</span></a>.</p>
<blockquote>
<div><ul class="simple">
<li><p>Set <strong>Catalog Object Definition</strong> to be <strong>Catalog.Schema.Table</strong></p></li>
<li><p>As <strong>Limit Query Template</strong>, use <code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">COLUMNS</span> <span class="pre">FROM</span> <span class="pre">TABLE_NAME</span> <span class="pre">FILTER_CLAUSES</span> <span class="pre">LIMIT</span> <span class="pre">ROW_SIZE</span></code>.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><strong>Metadata Extraction</strong>: set up and run metadata extraction</p></li>
<li><p><strong>Per-Object Parameters</strong>: object visibility, object settings for Profiling, and custom queries for Profiling</p></li>
<li><p><strong>Data Profiling</strong>: run Profiling</p></li>
</ul>
</div></blockquote>
</section>
<section id="metadata-extraction">
<h2>Metadata Extraction<a class="headerlink" href="#metadata-extraction" title="Permalink to this headline">¶</a></h2>
<p>Configure and perform metadata extraction and verify the results:</p>
<ul class="simple">
<li><p>Automatic full and selective MDE is supported.</p></li>
<li><p>In <strong>Settings</strong> &gt; <strong>Custom Settings</strong>, check that you have set <strong>Catalog Object Definition</strong> to <strong>Catalog.Schema.Table</strong> to remove any driver-imposed prefixes from the metadata object names.</p></li>
</ul>
</section>
<section id="sampling-and-profiling">
<h2>Sampling and Profiling<a class="headerlink" href="#sampling-and-profiling" title="Permalink to this headline">¶</a></h2>
<p>Configure and perform <a class="reference internal" href="ProfilingForCustomDB.html"><span class="doc">Sampling and Profiling</span></a>:</p>
<blockquote>
<div><ul class="simple">
<li><p>Users can run a sample for an individual table on the <strong>Samples</strong> tab of the Table Catalog page or profile an individual column on the <strong>Overview</strong> tab of the Column page.</p></li>
<li><p>Automatic full and selective Profiling is supported.</p></li>
<li><p>Use the <strong>Per-Object Parameters</strong> in Settings tab to specify which objects to profile.</p></li>
<li><p>Custom query-based Sampling is supported. <a class="reference internal" href="ProfilingForCustomDB.html#sampling-profiling-custom-query-based-sampling-for-tables"><span class="std std-ref">Custom Query-Based Sampling</span></a> allows you to provide a custom query for profiling each specific table.</p></li>
<li><p>Deep Column Profiling (<a class="reference internal" href="ProfilingForCustomDB.html#profilingv2-label"><span class="std std-ref">Profiling V2</span></a> ) is supported.</p></li>
</ul>
</div></blockquote>
</section>
<section id="query-log-ingestion">
<h2>Query Log Ingestion<a class="headerlink" href="#query-log-ingestion" title="Permalink to this headline">¶</a></h2>
<p>You can configure query log ingestion (QLI) using a view or using a custom query.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>QLI requires pre-configuration on in AWS. See <a class="reference internal" href="#qli-setup">QLI Setup</a>.</p>
</div>
<section id="view-based-qli">
<h3>View-Based QLI<a class="headerlink" href="#view-based-qli" title="Permalink to this headline">¶</a></h3>
<p>You will need the fully qualified name of the QLI view that you have created in Amazon Athena.</p>
<ol class="arabic">
<li><p>On the <strong>General Settings</strong> tab of the Settings page, locate the section <strong>Query Log Privileges</strong>:</p>
<blockquote>
<div><img alt="../../_images/DS_Athena03.png" src="../../_images/DS_Athena03.png" />
</div></blockquote>
</li>
<li><p>Specify the fully qualified name of the QLI view you created for Alation.</p></li>
<li><p>Click <strong>Save</strong>.</p></li>
<li><p>Go to the <strong>Query Log Ingestion</strong> tab.</p></li>
<li><p>Select a date range and click <strong>Preview</strong> to validate that queries are fetched.</p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>When selecting the date range, make sure it is aligned with the partitions used in the QLI view. Alation will only return queries from the days included into the partitions. If the selected date range does not match the partitions of the QLI view, no queries will be returned.
You can use Compose to change the SQL of the QLI view directly from Alation and test QLI.</p>
</div>
</div></blockquote>
</li>
<li><p>Perform QLI.</p></li>
</ol>
</section>
<section id="query-based-qli">
<h3>Query-Based QLI<a class="headerlink" href="#query-based-qli" title="Permalink to this headline">¶</a></h3>
<p>You will need the SQL statement for the custom query for QLI.</p>
<ol class="arabic">
<li><p>On the <strong>Query Log Ingestion</strong> tab, select the checkbox <strong>Enable table based query log ingestion</strong>.</p></li>
<li><p>In the custom query field that appears, paste the QLI query.</p></li>
<li><p>Click <strong>Save</strong> to save the query:</p>
<blockquote>
<div><img alt="../../_images/DS_Athena04.png" src="../../_images/DS_Athena04.png" />
</div></blockquote>
</li>
<li><p>Select a date range and click <strong>Preview</strong> to validate that the queries are fetched.</p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>When selecting the date range, make sure it is aligned with the partitions used in the QLI query. Alation will only return queries from the days included into the partitions. If the selected date range does not match the partitions of the QLI query, no queries will be returned.
You can use Compose to change the SQL of the QLI query directly from Alation and test the QLI.</p>
</div>
</div></blockquote>
</li>
<li><p>Perform QLI.</p></li>
</ol>
</section>
</section>
<section id="compose">
<h2>Compose<a class="headerlink" href="#compose" title="Permalink to this headline">¶</a></h2>
<p>Log into Compose:</p>
<ul>
<li><p>If SSO for Compose users has been configured, users will authenticate with their IdP credentials.</p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is not recommended to schedule queries and use Excel Live Reports with the connection established using SSO authentication as these features require user credentials to be valid at the time the data is refreshed. AWS STS API does not currently offer the capability to automatically renew temporary credentials. Users can still schedule queries or use Excel Live reports over connections that use an AWS IAM key ID and Secret if they are available to users establishing the connection.</p>
</div>
</div></blockquote>
</li>
<li><p>If basic authentication is used, Compose users will use the access and secret keys to authenticate and query Amazon Athena.</p></li>
<li><p>Use the <strong>Catalog.Schema.Table</strong> format for writing queries.</p></li>
</ul>
</section>
<section id="troubleshooting-amazon-athena-setup">
<h2>Troubleshooting Amazon Athena Setup<a class="headerlink" href="#troubleshooting-amazon-athena-setup" title="Permalink to this headline">¶</a></h2>
<p>If you get errors during MDE or profiling, check the <strong>taskserver.log</strong> log file for detailed information.</p>
<section id="s3-output-bucket-read-write-errors">
<h3>S3 Output Bucket Read/Write Errors<a class="headerlink" href="#s3-output-bucket-read-write-errors" title="Permalink to this headline">¶</a></h3>
<p>If you see the following errors in <strong>taskserver.log</strong>:</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>Caused<span class="w"> </span>by:<span class="w"> </span>com.simba.athena.support.exceptions.GeneralException:<span class="w"> </span><span class="o">[</span>Simba<span class="o">][</span>AthenaJDBC<span class="o">](</span><span class="m">100071</span><span class="o">)</span><span class="w"> </span>An<span class="w"> </span>error<span class="w"> </span>has<span class="w"> </span>been<span class="w"> </span>thrown<span class="w"> </span>from<span class="w"> </span>the<span class="w"> </span>AWS<span class="w"> </span>Athena<span class="w"> </span>client.<span class="w"> </span>Unable<span class="w"> </span>to<span class="w"> </span>verify/create<span class="w"> </span>output<span class="w"> </span>bucket<span class="w"> </span>sample-bucket<span class="w"> </span><span class="o">[</span>Execution<span class="w"> </span>ID<span class="w"> </span>not<span class="w"> </span>available<span class="o">]</span>
Caused<span class="w"> </span>by:<span class="w"> </span>com.simba.athena.amazonaws.services.athena.model.InvalidRequestException:<span class="w"> </span>Unable<span class="w"> </span>to<span class="w"> </span>verify/create<span class="w"> </span>output<span class="w"> </span>bucket<span class="w"> </span>sample-bucket<span class="w"> </span><span class="o">(</span>Service:<span class="w"> </span>AmazonAthena<span class="p">;</span><span class="w"> </span>Status<span class="w"> </span>Code:<span class="w"> </span><span class="m">400</span><span class="p">;</span><span class="w"> </span>Error<span class="w"> </span>Code:<span class="w"> </span>InvalidRequestException<span class="p">;</span><span class="w"> </span>Request<span class="w"> </span>ID:<span class="w"> </span>b2e40c48-acbe-4a5c-b888-2c08c6b5e995<span class="o">)</span>
</pre></div>
</div>
<p>Or:</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span><span class="m">2020</span>-04-08<span class="w"> </span><span class="m">17</span>:06:27,280<span class="w"> </span>INFO<span class="w"> </span>qtp1097324923-15<span class="w"> </span>alation.base.connection.GenericDbConnectionImpl<span class="w"> </span>-<span class="w"> </span>Connection<span class="w"> </span>failed!
java.sql.SQLException:<span class="w"> </span><span class="o">[</span>Simba<span class="o">][</span>AthenaJDBC<span class="o">](</span><span class="m">100071</span><span class="o">)</span><span class="w"> </span>An<span class="w"> </span>error<span class="w"> </span>has<span class="w"> </span>been<span class="w"> </span>thrown<span class="w"> </span>from<span class="w"> </span>the<span class="w"> </span>Amazon<span class="w"> </span>Athena<span class="w"> </span>client.<span class="w"> </span>You<span class="w"> </span><span class="k">do</span><span class="w"> </span>not<span class="w"> </span>seem<span class="w"> </span>to<span class="w"> </span>have<span class="w"> </span>access<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>Amazon<span class="w"> </span>S3<span class="w"> </span>location<span class="w"> </span>of<span class="w"> </span>your<span class="w"> </span>query<span class="w"> </span>results.<span class="w"> </span>Please<span class="w"> </span>confirm<span class="w"> </span>your<span class="w"> </span>account<span class="w"> </span>has<span class="w"> </span>access<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>S3<span class="w"> </span>location<span class="w"> </span>where<span class="w"> </span>your<span class="w"> </span>query<span class="w"> </span>results<span class="w"> </span>are<span class="w"> </span>saved<span class="w"> </span>and<span class="w"> </span>try<span class="w"> </span>again.<span class="w"> </span>If<span class="w"> </span>you<span class="w"> </span>are<span class="w"> </span>using<span class="w"> </span>KMS<span class="w"> </span>to<span class="w"> </span>encrypt<span class="w"> </span>query<span class="w"> </span>results,<span class="w"> </span>please<span class="w"> </span>ensure<span class="w"> </span>you<span class="w"> </span>have<span class="w"> </span>permission<span class="w"> </span>to<span class="w"> </span>access<span class="w"> </span>your<span class="w"> </span>KMS<span class="w"> </span>key.<span class="w"> </span>If<span class="w"> </span>you<span class="w"> </span><span class="k">continue</span><span class="w"> </span>to<span class="w"> </span>see<span class="w"> </span>this<span class="w"> </span>issue,<span class="w"> </span>please<span class="w"> </span>contact<span class="w"> </span>customer<span class="w"> </span>support.<span class="w"> </span><span class="o">[</span>Execution<span class="w"> </span>ID:<span class="w"> </span>5c93e8f5-d2bf-42a2-874b-e3ad6dcbd0e9<span class="o">]</span>
</pre></div>
</div>
<p>Verify that the Alation service account has READ/WRITE access to the S3 output bucket. Also verify that the account has read access to S3 buckets in AWS Glue.</p>
</section>
<section id="certification-errors">
<h3>Certification Errors<a class="headerlink" href="#certification-errors" title="Permalink to this headline">¶</a></h3>
<p>You may get the following error in <strong>taskserver.log</strong>:</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span><span class="m">2018</span>-12-20<span class="w"> </span><span class="m">15</span>:53:16,763<span class="w"> </span>INFO<span class="w"> </span>qtp324169305-53<span class="w"> </span>alation.api.taskserver.Task<span class="w"> </span>-<span class="w"> </span>verifyDbAccount<span class="w"> </span>API<span class="w"> </span>Result:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;error&quot;</span>:<span class="s2">&quot;unable to find valid certification path to requested target&quot;</span><span class="o">}</span>
</pre></div>
</div>
<p>This error is caused by the Alation instance not being whitelisted at the company’s firewall. In some environments it is not enough to open port <strong>443</strong>. The instance has to be whitelisted. This error may also be misleading because the connectivity test will pass, but the user interface will state a username/password failure when the username/password are correct.</p>
</section>
<section id="mde-works-but-profiling-and-compose-time-out">
<span id="troubleshoot-athena"></span><h3>MDE Works but Profiling and Compose Time Out<a class="headerlink" href="#mde-works-but-profiling-and-compose-time-out" title="Permalink to this headline">¶</a></h3>
<p>Generally you will not see any errors in the <strong>taskserver.log</strong>; however you may get the following:</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>Simba<span class="o">][</span>AthenaJDBC<span class="o">](</span><span class="m">100123</span><span class="o">)</span><span class="w"> </span>An<span class="w"> </span>error<span class="w"> </span>has<span class="w"> </span>occurred.<span class="w"> </span>Exception<span class="w"> </span>during<span class="w"> </span>column<span class="w"> </span>initialization.
</pre></div>
</div>
<p>You may also get “timeout” errors.</p>
<p>The issue is that the Simba driver uses port <strong>444</strong> to stream results back to the client. MDE works because the driver methods are utilized, whereas profiling and Compose require the results to be streamed back. Unblock port <strong>444</strong>. Refer to <a class="reference external" href="https://docs.aws.amazon.com/athena/latest/ug/connect-with-jdbc.html">AWS documentation</a> for more details.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  
<div class="navigation-bar">

    <div class="navigation navigation--prev">
        
        <a class="navigation__link" href="SQLQueryBasedQLICustomDB.html">
            <button class="navigation__button">
                <i class="icon icon-left"></i>
            </button>
            <div class="navigation__title">
                <span class="heading">Previous</span> <br />SQL Query QLI
            </div>
        </a>
        
    </div>

    <div class="navigation navigation--next">
        
        <a class="navigation__link" title="Accesskey Alt(+Shift)+p" accesskey="p" href="UpdateSimbaJDBCDriverForAthenaToSupportSSO.html">
            <div class="navigation__title">
                <span class="heading">Next</span> <br />Update Simba JDBC Driver for Amazon Athena to Support SSO
            </div>
            <button class="navigation__button" title="Accesskey Alt(+Shift)+n" accesskey="n">
                <i class="icon icon-right"></i>
            </button>
        </a>
        
    </div>

</div>


</footer>

        </div>
      </div>

    </section>

    <div class="wy-nav-side wy-nav-secondary">
      <div class="wy-side-scroll">
        <div class="wy-side-scroll__content">
          <div class="wy-menu-secondary">
              <div class="comments">
    <a href="mailto:no-reply-docs-feedback@alation.com?subject=Documentation Feedback on datasources/CustomDB/AWSAthena&body=Alation%20welcomes%20your%20comments%20on%20typos,%20content%20accuracy%20and%20completeness,%20and%20whether%20you%20found%20this%20page%20helpful.%20You%20will%20not%20receive%20a%20reply%20to%20this%20email.">
        <i class="icon icon-envelope" aria-hidden="true"></i>Request docs changes
    </a>
    <a href="#open-modal-pdf">
        <i class="icon icon-pdf" aria-hidden="true"></i>Download PDF
    </a>
</div>
              
                <p class="wy-menu-secondary-header">On this page</p>
                <ul>
<li><a class="reference internal" href="#">Amazon Athena</a><ul>
<li><a class="reference internal" href="#scope-of-support">Scope of Support</a><ul>
<li><a class="reference internal" href="#limitations">Limitations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#aws-billing">AWS Billing</a></li>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a><ul>
<li><a class="reference internal" href="#ports">Ports</a></li>
<li><a class="reference internal" href="#required-information">Required Information</a></li>
<li><a class="reference internal" href="#service-account">Service Account</a><ul>
<li><a class="reference internal" href="#use-an-existing-iam-user-account">Use an Existing IAM User Account</a></li>
<li><a class="reference internal" href="#create-new-iam-user-account">Create New IAM User Account</a></li>
</ul>
</li>
<li><a class="reference internal" href="#qli-setup">QLI Setup</a></li>
</ul>
</li>
<li><a class="reference internal" href="#step-1-add-the-amazon-athena-simba-driver-to-alation">Step 1: Add the Amazon Athena Simba Driver to Alation</a></li>
<li><a class="reference internal" href="#step-2-add-data-source">Step 2: Add Data Source</a></li>
<li><a class="reference internal" href="#step-3-configure-settings">Step 3: Configure Settings</a></li>
<li><a class="reference internal" href="#metadata-extraction">Metadata Extraction</a></li>
<li><a class="reference internal" href="#sampling-and-profiling">Sampling and Profiling</a></li>
<li><a class="reference internal" href="#query-log-ingestion">Query Log Ingestion</a><ul>
<li><a class="reference internal" href="#view-based-qli">View-Based QLI</a></li>
<li><a class="reference internal" href="#query-based-qli">Query-Based QLI</a></li>
</ul>
</li>
<li><a class="reference internal" href="#compose">Compose</a></li>
<li><a class="reference internal" href="#troubleshooting-amazon-athena-setup">Troubleshooting Amazon Athena Setup</a><ul>
<li><a class="reference internal" href="#s3-output-bucket-read-write-errors">S3 Output Bucket Read/Write Errors</a></li>
<li><a class="reference internal" href="#certification-errors">Certification Errors</a></li>
<li><a class="reference internal" href="#mde-works-but-profiling-and-compose-time-out">MDE Works but Profiling and Compose Time Out</a></li>
</ul>
</li>
</ul>
</li>
</ul>

              
            </div>
          </div>
      </div>
    </div>

  </div>

  
  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->

  
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/clipboard.min.js"></script>
      <script type="text/javascript" src="../../_static/copybutton.js"></script>
      <script type="text/javascript" src="../../_static/js/rtd_sphinx_search.min.js"></script>
  
  <script type="text/javascript" src="../../_static/searchtools.js"></script> <script type="text/javascript" id="idPiwikScriptPlaceholder"></script><script type="text/javascript" src="../../_static/js/main.bundle.js"></script>
  <script type="text/javascript" src="../../_static/js/runtime.bundle.js"></script>

  
  

  
    <div id="open-modal-pdf" class="modal-window">
<div>
  <a href="#" title="Close" class="modal-close">Close</a>
  <h4>Alation Documentation PDF</h4>
  <p>This PDF contains all our documentation and is more than <b>120 MB</b> in size. We recommend using an ethernet or Wi-Fi connection for downloading.</p>
  <br>
  <div class="modal-buttons">
    <a href="https://pdf-docs.alation.com/AlationUserDocs.pdf" class="btn-cta btn-cta--primary" target="_blank">
      Download PDF
    </a>
    <a href="#" title="Close" class="btn-cta">Cancel</a>
  </div>
</div>
  

</body>
</html>
<!--3.6.17-->