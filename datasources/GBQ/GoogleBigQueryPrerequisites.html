
<!DOCTYPE html>
<html lang="" >
<head>
  <meta charset="utf-8"/>
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="book-version"      content=""/>
  <meta name="book-release"      content=""/>
  <meta name="docsearch:name"    content="Alation User Guide" />
  <meta name="docsearch:version" content="" />
  <meta name="docsearch:package_type" content="" />
	<meta name="robots" content="noindex" />

  
  <title>Google BigQuery Prerequisites &mdash; Alation User Guide</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  

  
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/main.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx_collapse.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/rtd_sphinx_search.min.css" type="text/css" />
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="Alation User Guide" href="#"/>
        <link rel="up" title="Google BigQuery" href="index.html"/>
        <link rel="next" title="Google BigQuery Setup in Alation" href="GoogleBigQuerySetup.html"/>
        <link rel="prev" title="Google BigQuery" href="index.html"/>

	

	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-67846571-1"></script>
	<script>
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());

	gtag('config', 'UA-67846571-1');
	</script>

	<!-- Global site tag (gtag.js) - Google Analytics -->
	<!-- Second Google Analytics tag to assist mapping with mattermost.com visits --> 
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-120238482-1"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  gtag('config', 'UA-120238482-1');
	</script>


</head>

<body class="wy-body-for-nav" role="document">

  <header>
    <div class="header__container wy-max-content-width">
        <a href="/" class="header__logo">
            <img width="176" src="../../_static/img/logo-alation.svg" alt="Alation" />
        </a>
        <ul class="header__links">
            <li><a href="https://help.alation.com/s/">Alation Help Center</a></li>
        </ul>
    </div>
</header>

  <div class="wy-grid-for-nav wy-max-content-width">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-scroll__content">
          <div class="wy-side-nav-search">
            

            <ul class="sidebartop">
              <li class="nolink search"><div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search this project" aria-label="Search this project" id="searchinput" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
</li>

            </ul>

            
          </div>

          <div class="wy-menu wy-sidebar wy-sidebar--hidden" data-spy="affix" role="navigation" aria-label="main navigation">
            
              
              
              
                  <p class="caption" role="heading"><span class="caption-text">Welcome to Alation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/About/index.html">About Alation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/CloudAndOnPrem/index.html">Alation Cloud and On-Premise</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/QuickStart/index.html">Quick Start Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/UserProfileandPreferences/index.html">User Profile and Preferences</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/CatalogBasics/index.html">Catalog Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/Conversations/index.html">Conversations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/Domains/index.html">Domains</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/BestPractices/index.html">Best Practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/Glossary/index.html">Alation Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alation Cloud Service</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../cloud/StatusPage/index.html">Status Page</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cloud/CloudOverview/index.html">Cloud Service Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cloud/CloudConfiguration/index.html">Configuration for Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cloud/AlationAgent/index.html">Alation Agent</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alation Integration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../integration/AlationAnywhere/index.html">Alation Anywhere</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../integration/AlationConnectedSheets/index.html">Alation Connected Sheets</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Installation &amp; Configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/ServerInstallation/index.html">Install Alation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/HighAvailability/index.html">High Availability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/Runbook/index.html">Runbook for Administrators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/Update/index.html">Update Alation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/BackupandRestore/index.html">Back Up and Restore</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/LineageV2/index.html">Lineage V2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/LineageV3/index.html">Lineage V3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/AlationAnalyticsV2/index.html">Alation Analytics V2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/AlationContainerService/index.html">Alation Container Service</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Sources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../sources/CatalogSources/index.html">Catalog Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sources/VirtualDataSources/index.html">Virtual Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sources/Lineage/index.html">Lineage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sources/APIResources/index.html">API Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sources/WorkwithCatalogData/index.html">Working with Catalog Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sources/OpenConnectorFramework/index.html">Open Connector Framework</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Sources</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../DSConfiguration/index.html">Data Source Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AddDataSources/index.html">Adding Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ComposeSSOAWSDataSources/index.html">Compose SSO for Amazon Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ComposeSSOAzureDataSources/index.html">Compose SSO for Azure Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AuthenticationForExtraction/index.html">Authentication for Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CustomDB/index.html">Custom DB</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Google BigQuery</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Google BigQuery Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="GoogleBigQuerySetup.html">Google BigQuery Setup in Alation</a></li>
<li class="toctree-l2"><a class="reference internal" href="GoogleBigQueryFAQ.html">Google BigQuery FAQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="GoogleBigQueryTroubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="GoogleBigQueryAdditionalInformation.html">Additional Information</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Hive/index.html">Hive</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">BI Sources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../bisources/AddBISources/index.html">Add BI Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bisources/AddTableauServer/index.html">Add Tableau Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bisources/WorkwithBISources/index.html">Working with BI Sources</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">File System Sources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/FileSystems/index.html">Add File Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/VirtualFileSystems/index.html">Virtual File Systems</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alation for Analysts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../analyst/UserAuthenticationForDataSources/index.html">User Authentication for Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analyst/ShareAndAccessQueries/index.html">Share and Access Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analyst/WriteQueries/index.html">Write Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analyst/DevelopQueries/index.html">Develop Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analyst/WorkwithQueryResults/index.html">Work with Query Results</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alation for Data Stewards</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../steward/GovernanceApp/index.html">Governance App</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/PolicyCenter/index.html">Policy Center</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/Workflow/index.html">Workflow Center</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/GovernanceDashboard/index.html">Governance Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/StewardshipWorkbench/index.html">Stewardship Workbench</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/AnalyticsStewardship/index.html">Analytics Stewardship</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/Glossary/index.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/ArticlesAndTags/index.html">Articles and Tags</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/ArticleGroups/index.html">Article Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/DataCatalogCustomization/index.html">Customize Your Data Catalog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/DataDocumentation/index.html">Data Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/AutoTitlingandLexicon/index.html">Auto-titling and Lexicon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/SnowflakeTags/index.html">Snowflake Tags</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alation for Server Administrators</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../admins/CustomizableHomePage/index.html">Customizable Homepage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/AdminSettings/index.html">Administrator Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/AdditionalConfiguration/index.html">Additional Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/RunbookForAdministrators/index.html">Runbook for Administrators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/AlationAPIs/index.html">Alation APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/How-tos/index.html">How-tos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/Troubleshooting/index.html">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Release Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../releases/releasenotes/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/supportmatrices/index.html">Support Matrices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/endofsupport/index.html">End Of Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/snowflakeclladdon/index.html">Snowflake Parser Add-On</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/fieldnotices/index.html">Important Notices and Security Alerts</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Archived Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../archive/About/index.html">About the Documentation Archive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../archive/AdminConfig/index.html">Administration and Update Archive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../archive/ReleaseNotes/index.html">Release Notes Archive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../archive/Usage/index.html">Usage and Customization Archive</a></li>
</ul>

              
            
          </div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="wy-nav-top-icon"></i>
        <a href="../../index.html">Alation User Guide</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">

          <div role="navigation" aria-label="breadcrumbs" class="breadcrumbs">
    <a href="../../index.html">Docs</a>
    <span class="separator">&gt;</span>
    <a href="index.html">Google BigQuery</a>
    <span class="separator">&gt;</span>
    <span>Google BigQuery Prerequisites</span>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody" class="toBeIndexed">
            
  <section id="google-bigquery-prerequisites">
<h1>Google BigQuery Prerequisites<a class="headerlink" href="#google-bigquery-prerequisites" title="Permalink to this headline">¶</a></h1>
<p>Starting from version <em>V R6 (5.10.x)</em>, Alation uses a Google-authorized driver developed by Simba Technologies to connect to Google BigQuery data sources:
<strong>com.simba.googlebigquery.jdbc42.Driver.com.alation.drivers.simba.bigquery.0.1</strong>.</p>
<p>If you are updating to V R6 or a later release from before V R6, note that the built-in driver will be automatically changed to the new Simba®️ driver. The old driver will no longer appear in the list of drivers on the <strong>General Settings</strong> page of the data source. Your existing data source will remain fully functional after the update but will use the new driver.</p>
<section id="required-information">
<h2>Required Information<a class="headerlink" href="#required-information" title="Permalink to this headline">¶</a></h2>
<p>To add a BigQuery data source in Alation, you need the following information:</p>
<ul class="simple">
<li><p><strong>Project ID</strong> The Project ID of a project in Google BigQuery that you want to add as a data source in Alation. It should be provided in the <strong>Database Name</strong> field when adding the source.</p></li>
</ul>
<blockquote>
<div><div class="admonition important">
<p class="admonition-title">Important</p>
<p>Make sure the Project is <strong>billing-enabled</strong>.
During MDE, QLI, and Profiling/Sampling Alation runs SELECT queries against Google BigQuery projects. These queries and all queries users run in Compose <strong>will be billed by Google Cloud Platform (GCP) on this Project ID</strong>.</p>
</div>
</div></blockquote>
<ul class="simple">
<li><p><strong>BigQuery API</strong> must be enabled for the Google Cloud Platform (GCP) Project.</p></li>
</ul>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>In GCP, go to <strong>APIs &amp; Services</strong> &gt; <strong>Dashboard</strong> for your Projects to check that the BigQuery API is enabled. If not, to enable it, click <strong>ENABLE APIS AND SERVICES</strong> and select <strong>BigQuery API</strong>.</p>
</div>
</div></blockquote>
<ul class="simple">
<li><p><strong>Google BigQuery account(s) for authentication</strong>:</p></li>
</ul>
<blockquote>
<div><p>Starting from <em>V R6 (5.10.x)</em>, you can authenticate with either a user account or a service account, or both. In releases before V R6, both user and service accounts are required to set up a GBQ data source. See <a class="reference internal" href="#authentication">Authentication</a>. These accounts must be assigned the required permissions</p>
</div></blockquote>
<ul class="simple">
<li><p><strong>Required roles with appropriate permissions</strong> user and service accounts you are going to use for authentication in Alation must be assigned the required permissions described in <a class="reference internal" href="#assign-required-permissions">Assign Required Permissions</a>.</p></li>
</ul>
</section>
<section id="authentication">
<h2>Authentication<a class="headerlink" href="#authentication" title="Permalink to this headline">¶</a></h2>
<p>Alation will authenticate against BigQuery every time any of the following is attempted: MDE, QLI, Profiling/Sampling, and use of Compose.</p>
<p>Two authentication mechanisms are supported: a <strong>user account</strong> or/and a <strong>service account</strong>.</p>
<p>Authentication with a <strong>user account</strong> allows you to use full
functionality available for Google BigQuery data sources:</p>
<blockquote>
<div><ul class="simple">
<li><p>Metadata Extraction (MDE)</p></li>
<li><p>Query Log Ingestion (QLI)</p></li>
<li><p>Profiling and Sampling</p></li>
<li><p>Compose and Dynamic Profiling</p></li>
</ul>
</div></blockquote>
<p>Note that when a user account is used for authentication in Alation, all Compose queries will be logged in the BigQuery query history as run by the user whose OAuth certificate is uploaded in the data source Settings even though Compose users establish connection to GBQ using their own Google credentials. A user account is associated with a specific user in Google, so all queries from Alation will be logged as run by this user in the GBQ query log. The Alation admin can analyze Compose usage by individual users in Alation, but not in the BigQuery query history.</p>
<p>Authentication with a <strong>service account</strong> will allow you to do MDE,
Profiling, and QLI in the Catalog but is not sufficient to query the
projects in Compose. Compose requires user account-based authentication to connect to the source. You can create a service account in a CGP Project then assign permissions to that service account in the BigQuery Project hosting the data.</p>
<p>Service accounts use JSON credential files (“keys”) which will be stored (encrypted) on the Alation server. Using a service account does not require any further authentication.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Alation will fetch the datasets from all GCP Projects that the user account or service account used for authentication has access to in GCP. You will be able to select which of the schemas (datasets) to extract into your data source on the <strong>Metadata Extraction</strong> tab of the data source <strong>Settings</strong> page in Alation.</p>
</div>
<p>For more details, see:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference internal" href="#user-account">User Account</a></p></li>
<li><p><a class="reference internal" href="#service-account">Service Account</a></p></li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>From <em>version 2020.3</em>, User Account Certificates and Service Account Keys uploaded to Alation are encrypted and stored in the internal Alation database (rosemeta).</p>
</div>
</section>
<section id="assign-required-permissions">
<h2>Assign Required Permissions<a class="headerlink" href="#assign-required-permissions" title="Permalink to this headline">¶</a></h2>
<p>Starting with <em>V R6 (5.10.x)</em>, Alation requires that you assign two roles to the accounts you use
for authentication with several required permissions. These roles are:</p>
<ul class="simple">
<li><p>The predefined role of <strong>BigQuery Job User</strong></p></li>
<li><p>A custom role <strong>AlationUser</strong> that needs to be created</p></li>
</ul>
<p>For information about releases before V R6, see <a class="reference internal" href="#v-r5-5-9-x-and-below">V R5 (5.9.x) and below</a>.</p>
<p>To create the custom role <strong>AlationUser</strong>, in GCP console, go to <strong>IAM &amp; Admin</strong> &gt;
<strong>Roles</strong>, create a new custom role naming it <strong>AlationUser</strong>.</p>
<p>To create the custom role <strong>AlationUser</strong>, in the GCP console, go to <strong>IAM &amp; Admin &gt; Roles</strong>, create a new custom role naming it <strong>AlationUser</strong> and assign it the required permissions:</p>
<section id="roles-and-permissions">
<h3>Roles and Permissions<a class="headerlink" href="#roles-and-permissions" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 23%" />
<col style="width: 35%" />
<col style="width: 28%" />
<col style="width: 14%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Role</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Permission</p></th>
<th class="head"><p>Resource Level</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="4"><p>BigQuery Job User</p></td>
</tr>
<tr class="row-odd"><td><p>roles/bigquery.jobUser</p></td>
<td><p>Provides permission to run jobs,
including queries, in the project.
The jobUser role can enumerate their
own jobs and cancel their own jobs.</p></td>
<td><p>bigquery.jobs.create</p>
<p>resourcemanager.projects.get</p>
<p>resourcemanager.projects.list</p>
</td>
<td><p>Project</p></td>
</tr>
<tr class="row-even"><td colspan="4"><p>AlationUser</p></td>
</tr>
<tr class="row-odd"><td><p>AlationUser (Custom Role)</p></td>
<td><p>Provides permission to run jobs,
including queries, in the project.
The user role can enumerate their own
jobs, cancel their own jobs.</p>
<p>When applied at the project or
organization level, the metadataViewer
provides permissions to:</p>
<ul class="simple">
<li><p>List all datasets and read metadata
of all datasets in a project;</p></li>
<li><p>List all tables and views and reads
metadata of all tables and views in
a project;</p></li>
<li><p>Read data from the tables of a
dataset.</p></li>
</ul>
<p>From 2021.4:</p>
<ul class="simple">
<li><p>Storage buckets must have the Storage
Object Viewer permission to extract
the external tables.</p></li>
<li><p>If a project has Google Storage API
enabled, you need to select
additional permissions.</p></li>
</ul>
</td>
<td><p>bigquery.datasets.get
bigquery.datasets.getIamPolicy
bigquery.jobs.create
bigquery.jobs.list
bigquery.jobs.listAll
bigquery.models.getData
bigquery.models.getMetadata
bigquery.models.list
bigquery.routines.get
bigquery.routines.list
bigquery.savedqueries.get
bigquery.savedqueries.list
bigquery.tables.get
bigquery.tables.getData
bigquery.tables.list
bigquery.transfers.get</p>
<p>From 2021.4, To extract
external tables:</p>
<p>bigquery.readsessions.create</p>
<p>For projects with Google
Storage API enabled:</p>
<p>bigquery.readsessions.create
bigquery.readsessions.getData
bigquery.readsessions.update</p>
</td>
<td><p>Project</p></td>
</tr>
</tbody>
</table>
<p>For the Project you want to extract and query, assign the roles <strong>BigQuery Job User</strong> and <strong>AlationUser</strong> to the accounts you are going to authenticate with in Alation.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the account you are authenticating with has the <strong>Owner</strong> role on any of the GCP
projects, Alation will be able to fetch the datasets from these
projects without the additional assignment of the roles BigQuery Job User and AlationUser.</p>
<p>The roles BigQuery Job User and AlationUser are required for accounts which  do not have the
Owner role.</p>
</div>
<section id="which-permissions-are-required-for-which-data-job">
<h4>Which Permissions Are Required for Which Data Job?<a class="headerlink" href="#which-permissions-are-required-for-which-data-job" title="Permalink to this headline">¶</a></h4>
<p>Data jobs in Alation use the following specific permissions:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 66%" />
<col style="width: 34%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Data Job</p></th>
<th class="head"><p>Permissions</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>MDE</strong>
Periodically fetches the metadata (schemas, tables,
columns, procedures, etc) to keep the catalog
representation</p></td>
<td><p>config.get
datasets.get
datasets.getIamPolicy
jobs.create
jobs.list
jobs.listAll
models.getData
models.getMetadata
models.list
routines.get
routines.list
jobs.create
models.getData
models.getMetadata
transfers.get</p>
<p>From 2021.4, To extract
external tables:</p>
<p>readsessions.create</p>
</td>
</tr>
<tr class="row-odd"><td><p><strong>QLI</strong>
Generates several valuable insights into the
catalog data (popularity, lineage, top users, etc.)
by examining the query history of the database objects</p></td>
<td><p>savedqueries.get
savedqueries.list
jobs.create
projects.get
projects.list
jobs.list
jobs.listAll
jobs.create</p></td>
</tr>
<tr class="row-even"><td><p><strong>Profiling/Sampling</strong></p></td>
<td><p>tables.get
tables.getData
tables.list
jobs.create</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v-r5-5-9-x-and-below">
<h4>V R5 (5.9.x) and below<a class="headerlink" href="#v-r5-5-9-x-and-below" title="Permalink to this headline">¶</a></h4>
<p>You must have the following IAM roles assigned to the service account at the Project Level or Organizational Level to perform metadata extraction and profiling:</p>
<ul class="simple">
<li><p>roles/bigquery.dataViewer</p></li>
<li><p>roles/bigquery.user</p></li>
</ul>
<p>To perform Query Log Ingestion (QLI), you must assign the IAM role of <em>bigquery.user</em> to the service account at the Project Level or Organizational Level. The following permissions are required for <em>bigquery.user</em> to perform QLI:</p>
<ul class="simple">
<li><p>bigquery.config.get</p></li>
<li><p>bigquery.datasets.create</p></li>
<li><p>bigquery.datasets.get</p></li>
<li><p>bigquery.datasets.getIamPolicy</p></li>
<li><p>bigquery.jobs.create</p></li>
<li><p>bigquery.jobs.list</p></li>
<li><p>bigquery.jobs.listAll</p></li>
<li><p>bigquery.readsessions.create</p></li>
<li><p>bigquery.savedqueries.get</p></li>
<li><p>bigquery.savedqueries.list</p></li>
<li><p>bigquery.tables.list</p></li>
<li><p>bigquery.transfers.get</p></li>
<li><p>resourcemanager.projects.get</p></li>
</ul>
</section>
</section>
</section>
<section id="user-account">
<h2>User Account<a class="headerlink" href="#user-account" title="Permalink to this headline">¶</a></h2>
<p>You can provide a user account that has access to your Google BigQuery Project(s) for authentication in Alation. To enable Alation to access this user account, the corresponding user account certificate has to be uploaded alongside the account information. See <a class="reference internal" href="#generate-user-account-certificate">Generate User Account Certificate</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A user account can be added to the Project by the following types of Google Cloud Platform (GCP) users:</p>
<blockquote>
<div><ul class="simple">
<li><p>Database Administrator</p></li>
<li><p>User who has Owner access on the BigQuery project</p></li>
</ul>
</div></blockquote>
</div>
<p>For MDE, QLI, and Profiling to work, make sure to
assign this user account the required permissions: <a class="reference internal" href="#assign-required-permissions">Assign Required Permissions</a>.</p>
<section id="generate-user-account-certificate">
<span id="google-bigquery-prerequisites-generate-user-account-certificate"></span><h3>Generate User Account Certificate<a class="headerlink" href="#generate-user-account-certificate" title="Permalink to this headline">¶</a></h3>
<p>To generate the user account certificate:</p>
<ol class="arabic">
<li><p>Log in to GCP with the user account you are generating the certificate for.</p></li>
<li><p>Open the Project for which you want to create a user account certificate. We recommend this is the Project ID of which you will use in Alation.</p></li>
<li><p>In the GCP console, open <strong>APIs &amp; Services</strong> &gt; <strong>OAuth consent screen</strong>:</p>
<blockquote>
<div><a class="reference internal image-reference" href="../../_images/Screen_Shot_2019-10-18_at_3.33.15_PM.png"><img alt="../../_images/Screen_Shot_2019-10-18_at_3.33.15_PM.png" class="align-center" src="../../_images/Screen_Shot_2019-10-18_at_3.33.15_PM.png" style="width: 300px;" /></a>
</div></blockquote>
</li>
</ol>
<ol class="arabic" start="4">
<li><p>On the <strong>OAuth consent screen</strong>, enter the information in the following fields:</p>
<blockquote>
<div><ul>
<li><p><strong>Application Type</strong> If you use a private domain account (for
example, <em>private&#64;company.com</em>) for the Project, set <strong>Application
Type</strong> to <code class="docutils literal notranslate"><span class="pre">Internal</span></code> or <code class="docutils literal notranslate"><span class="pre">Public</span></code> based on the requirements of the
company.</p></li>
<li><p><strong>Application Name</strong> set to <code class="docutils literal notranslate"><span class="pre">Alation</span></code>. This field
indicates the name of the authorized application which will access the
Project.</p></li>
<li><p>Do not alter the information for the following fields:</p>
<blockquote>
<div><ul class="simple">
<li><p>Scopes for following APIs</p></li>
<li><p>Authorized domains</p></li>
<li><p>Application Homepage link</p></li>
<li><p>Application Privacy Policy link</p></li>
<li><p>Application Terms of Service link.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p>Click <strong>Save</strong>.</p></li>
<li><p>Open <strong>APIs &amp; Services &gt;Credentials</strong>.</p>
<blockquote>
<div><a class="reference internal image-reference" href="../../_images/gbq-2.png"><img alt="../../_images/gbq-2.png" class="align-center" src="../../_images/gbq-2.png" style="width: 300px;" /></a>
</div></blockquote>
</li>
<li><p>In Credentials screen, Click <strong>CREATE CREDENTIALS &gt; OAuth client ID</strong>:</p>
<blockquote>
<div><a class="reference internal image-reference" href="../../_images/gbqnew_01.png"><img alt="../../_images/gbqnew_01.png" class="align-center" src="../../_images/gbqnew_01.png" style="width: 600px;" /></a>
</div></blockquote>
</li>
<li><p>Select <strong>Web application</strong>.</p>
<blockquote>
<div><a class="reference internal image-reference" href="../../_images/gbq-1.png"><img alt="../../_images/gbq-1.png" class="align-center" src="../../_images/gbq-1.png" style="width: 5.5in;" /></a>
</div></blockquote>
</li>
<li><p>Select the <strong>ADD URI</strong> button in the <strong>Authorized redirect URIs</strong> section.</p></li>
<li><p>Fill the field for the redirect URI. The value for the field must be using the schema of</p></li>
</ol>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>https://<span class="w"> </span>+<span class="w"> </span><span class="o">(</span>hostname<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>Alation<span class="w"> </span>instance<span class="o">)</span><span class="w"> </span>+<span class="w"> </span>/gbq/oauth2_callback
</pre></div>
</div>
<p>An example would be</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>https://busy-mite.alation-test.com/gbq/oauth2_callback
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Google will block authorization attempts with the credentials provided if the redirect URI field is set incorrectly.</p>
</div>
</section>
</section>
<section id="service-account">
<h2>Service Account<a class="headerlink" href="#service-account" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://cloud.google.com/iam/docs/understanding-service-accounts?hl%3Del&amp;">Google service accounts</a>
are special accounts that belong to your applications or virtual
machines instead of individual end-users. An application uses
the service account to call the Google API of a service, so that the
users are not directly involved.</p>
<p>You can authenticate with GBQ using a service account if you do not have a user
account or when authenticating with a service account works better for
your use case.</p>
<p>REMINDER: Authenticating with a service account will not allow you to run Compose queries against the Projects you add to Alation.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There can be several types of service accounts in GCP.</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>API</strong> After the creation of a new Cloud project using GCP console and if Compute Engine API is enabled for the project, a Compute Engine Service account is created by default and is identified by the following email: <strong>PROJECT_NUMBER-compute&#64;developer.gserviceaccount.com</strong></p></li>
<li><p><strong>AppEngine</strong> If the project has an App Engine application, the default App Engine service account is created in your project by default and is identified using:  <strong>PROJECT_ID&#64;appspot.gserviceaccount.com</strong></p></li>
<li><p><strong>System outside Google</strong> If a service account is created in the project, it is identified using: <strong>SERVICE_ACCOUNT_NAME&#64;PROJECT_ID.iam.gserviceaccount.com</strong></p></li>
</ul>
</div></blockquote>
</div>
<p>Alation can use service accounts of the following types:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>SERVICE_ACCOUNT_NAME&#64;PROJECT_ID.iam.gserviceaccount.com</strong></p></li>
<li><p><strong>PROJECT_NUMBER-compute&#64;developer.gserviceaccount.com</strong> (Compute Engine API service account)</p></li>
</ul>
</div></blockquote>
<p>You can cross-reference the Projects with one service account by adding
it as member on all the Projects you want to be extracted to Alation
and assigning it the required permissions on all these Projects. Alation
will fetch all schemas (datasets) from all Projects this service account
has access to. You will need to use the Project ID of the main project
(= the one on which this service account was created) as <strong>Database
Name</strong> in Alation.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If using both Service and User Accounts, we recommend you use the service
account key and user account certificate from the same Project in Google
BigQuery.</p>
</div>
<section id="create-a-service-account-and-generate-the-key">
<span id="google-bigquery-prerequisites-create-service-account-key"></span><h3>Create a Service Account and Generate the Key<a class="headerlink" href="#create-a-service-account-and-generate-the-key" title="Permalink to this headline">¶</a></h3>
<p>Each service account is associated with a key, which is managed by the Google Cloud Platform (GCP). It is used for service-to-service authentication in GCP.</p>
<p>To create a service account for Alation,</p>
<ol class="arabic simple">
<li><p>Go to <strong>GCP console &gt; Navigation Menu &gt; IAM &amp; admin &gt; Service Accounts</strong>.</p></li>
<li><p>Click <strong>+CREATE SERVICE ACCOUNT</strong>.</p></li>
<li><p>Enter the required information (name, ID, description) and click <strong>Create</strong>:</p></li>
</ol>
<blockquote>
<div><a class="reference internal image-reference" href="../../_images/gbq-3.png"><img alt="../../_images/gbq-3.png" class="align-center" src="../../_images/gbq-3.png" style="width: 600px;" /></a>
</div></blockquote>
<ol class="arabic simple" start="4">
<li><p>On the next screen, assign the service account roles <strong>BigQuery Job User</strong> and <strong>AlationUser</strong>. Click <strong>Continue</strong> and then click <strong>Done</strong>.</p></li>
</ol>
<blockquote>
<div><a class="reference internal image-reference" href="../../_images/gbq-4.png"><img alt="../../_images/gbq-4.png" class="align-center" src="../../_images/gbq-4.png" style="width: 400px;" /></a>
</div></blockquote>
<ol class="arabic simple" start="5">
<li><p>On the next screen, click <strong>Actions&gt;Manage Key</strong>.</p></li>
</ol>
<blockquote>
<div><a class="reference internal image-reference" href="../../_images/gbqnew_02.png"><img alt="../../_images/gbqnew_02.png" class="align-center" src="../../_images/gbqnew_02.png" style="width: 600px;" /></a>
</div></blockquote>
<ol class="arabic simple" start="6">
<li><p>Click <strong>Add Key &gt; Create New Key</strong>. Choose the key type <strong>JSON</strong> (recommended by Alation). Click <strong>Create</strong>:</p></li>
</ol>
<blockquote>
<div><a class="reference internal image-reference" href="../../_images/gbq-7.png"><img alt="../../_images/gbq-7.png" class="align-center" src="../../_images/gbq-7.png" style="width: 400px;" /></a>
</div></blockquote>
<ol class="arabic simple" start="7">
<li><p>Click <strong>Close</strong>. Your service account and key is created. Copy the name and location of the downloaded key file in your local machine.</p></li>
</ol>
</section>
<section id="generate-key-for-existing-service-account">
<h3>Generate Key for Existing Service Account<a class="headerlink" href="#generate-key-for-existing-service-account" title="Permalink to this headline">¶</a></h3>
<p>You can also use the default <strong>Compute Engine Service</strong> account for authentication in Alation (if it exists for your project) and generate the service account key for this account.</p>
<p>Or you can also generate the service account key for an already existing service account.</p>
<p>To create the service account key for an existing project:</p>
<ol class="arabic">
<li><p>In GCP console, open the project for which you want to create the key.</p></li>
<li><p>Go to <strong>IAM &amp; admin</strong> &gt; <strong>Service Accounts</strong>.</p></li>
<li><p>Under <strong>Actions</strong>, for an existing service account, click <strong>Manage Keys</strong>.</p>
<blockquote>
<div><a class="reference internal image-reference" href="../../_images/gbqnew_02.png"><img alt="../../_images/gbqnew_02.png" class="align-center" src="../../_images/gbqnew_02.png" style="width: 600px;" /></a>
</div></blockquote>
</li>
<li><p>Click <strong>Add Key &gt; Create New Key</strong>. The key is generated based on the choice of the format by the user. JSON is the recommended format.</p>
<blockquote>
<div><a class="reference internal image-reference" href="../../_images/gbqnew_03.png"><img alt="../../_images/gbqnew_03.png" class="align-center" src="../../_images/gbqnew_03.png" style="width: 600px;" /></a>
</div></blockquote>
</li>
<li><p>Click <strong>Create</strong>. The service account key is generated. Note down the name and location of the file.</p></li>
</ol>
</section>
</section>
<section id="setup-in-alation">
<h2>Setup in Alation<a class="headerlink" href="#setup-in-alation" title="Permalink to this headline">¶</a></h2>
<p>Continue to <a class="reference internal" href="GoogleBigQuerySetup.html"><span class="doc">Google BigQuery Setup in Alation</span></a>.</p>
</section>
</section>


           </div>
          </div>
          <footer>

  
<div class="navigation-bar">

    <div class="navigation navigation--prev">
        
        <a class="navigation__link" href="index.html">
            <button class="navigation__button">
                <i class="icon icon-left"></i>
            </button>
            <div class="navigation__title">
                <span class="heading">Previous</span> <br />Google BigQuery
            </div>
        </a>
        
    </div>

    <div class="navigation navigation--next">
        
        <a class="navigation__link" title="Accesskey Alt(+Shift)+p" accesskey="p" href="GoogleBigQuerySetup.html">
            <div class="navigation__title">
                <span class="heading">Next</span> <br />Google BigQuery Setup in Alation
            </div>
            <button class="navigation__button" title="Accesskey Alt(+Shift)+n" accesskey="n">
                <i class="icon icon-right"></i>
            </button>
        </a>
        
    </div>

</div>


</footer>

        </div>
      </div>

    </section>

    <div class="wy-nav-side wy-nav-secondary">
      <div class="wy-side-scroll">
        <div class="wy-side-scroll__content">
          <div class="wy-menu-secondary">
              <div class="comments">
    <a href="mailto:no-reply-docs-feedback@alation.com?subject=Documentation Feedback on datasources/GBQ/GoogleBigQueryPrerequisites&body=Alation%20welcomes%20your%20comments%20on%20typos,%20content%20accuracy%20and%20completeness,%20and%20whether%20you%20found%20this%20page%20helpful.%20You%20will%20not%20receive%20a%20reply%20to%20this%20email.">
        <i class="icon icon-envelope" aria-hidden="true"></i>Request docs changes
    </a>
    <a href="#open-modal-pdf">
        <i class="icon icon-pdf" aria-hidden="true"></i>Download PDF
    </a>
</div>
              
                <p class="wy-menu-secondary-header">On this page</p>
                <ul>
<li><a class="reference internal" href="#">Google BigQuery Prerequisites</a><ul>
<li><a class="reference internal" href="#required-information">Required Information</a></li>
<li><a class="reference internal" href="#authentication">Authentication</a></li>
<li><a class="reference internal" href="#assign-required-permissions">Assign Required Permissions</a><ul>
<li><a class="reference internal" href="#roles-and-permissions">Roles and Permissions</a><ul>
<li><a class="reference internal" href="#which-permissions-are-required-for-which-data-job">Which Permissions Are Required for Which Data Job?</a></li>
<li><a class="reference internal" href="#v-r5-5-9-x-and-below">V R5 (5.9.x) and below</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#user-account">User Account</a><ul>
<li><a class="reference internal" href="#generate-user-account-certificate">Generate User Account Certificate</a></li>
</ul>
</li>
<li><a class="reference internal" href="#service-account">Service Account</a><ul>
<li><a class="reference internal" href="#create-a-service-account-and-generate-the-key">Create a Service Account and Generate the Key</a></li>
<li><a class="reference internal" href="#generate-key-for-existing-service-account">Generate Key for Existing Service Account</a></li>
</ul>
</li>
<li><a class="reference internal" href="#setup-in-alation">Setup in Alation</a></li>
</ul>
</li>
</ul>

              
            </div>
          </div>
      </div>
    </div>

  </div>

  
  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->

  
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/clipboard.min.js"></script>
      <script type="text/javascript" src="../../_static/copybutton.js"></script>
      <script type="text/javascript" src="../../_static/js/rtd_sphinx_search.min.js"></script>
  
  <script type="text/javascript" src="../../_static/searchtools.js"></script> <script type="text/javascript" id="idPiwikScriptPlaceholder"></script><script type="text/javascript" src="../../_static/js/main.bundle.js"></script>
  <script type="text/javascript" src="../../_static/js/runtime.bundle.js"></script>

  
  

  
    <div id="open-modal-pdf" class="modal-window">
<div>
  <a href="#" title="Close" class="modal-close">Close</a>
  <h4>Alation Documentation PDF</h4>
  <p>This PDF contains all our documentation and is more than <b>120 MB</b> in size. We recommend using an ethernet or Wi-Fi connection for downloading.</p>
  <br>
  <div class="modal-buttons">
    <a href="https://pdf-docs.alation.com/AlationUserDocs.pdf" class="btn-cta btn-cta--primary" target="_blank">
      Download PDF
    </a>
    <a href="#" title="Close" class="btn-cta">Cancel</a>
  </div>
</div>
  

</body>
</html>
<!--3.6.17-->