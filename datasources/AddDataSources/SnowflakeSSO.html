
<!DOCTYPE html>
<html lang="" >
<head>
  <meta charset="utf-8"/>
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="book-version"      content=""/>
  <meta name="book-release"      content=""/>
  <meta name="docsearch:name"    content="Alation User Guide" />
  <meta name="docsearch:version" content="" />
  <meta name="docsearch:package_type" content="" />
	<meta name="robots" content="noindex" />

  
  <title>Snowflake OAuth For Compose &mdash; Alation User Guide</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  

  
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/main.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx_collapse.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/rtd_sphinx_search.min.css" type="text/css" />
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="Alation User Guide" href="#"/>
        <link rel="up" title="Adding Data Sources" href="index.html"/>
        <link rel="next" title="SQL Server" href="SQLServer.html"/>
        <link rel="prev" title="Snowflake" href="Snowflake.html"/>

	

	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-67846571-1"></script>
	<script>
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());

	gtag('config', 'UA-67846571-1');
	</script>

	<!-- Global site tag (gtag.js) - Google Analytics -->
	<!-- Second Google Analytics tag to assist mapping with mattermost.com visits --> 
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-120238482-1"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  gtag('config', 'UA-120238482-1');
	</script>


</head>

<body class="wy-body-for-nav" role="document">

  <header>
    <div class="header__container wy-max-content-width">
        <a href="/" class="header__logo">
            <img width="176" src="../../_static/img/logo-alation.svg" alt="Alation" />
        </a>
        <ul class="header__links">
            <li><a href="https://help.alation.com/s/">Alation Help Center</a></li>
        </ul>
    </div>
</header>

  <div class="wy-grid-for-nav wy-max-content-width">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-scroll__content">
          <div class="wy-side-nav-search">
            

            <ul class="sidebartop">
              <li class="nolink search"><div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search this project" aria-label="Search this project" id="searchinput" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
</li>

            </ul>

            
          </div>

          <div class="wy-menu wy-sidebar wy-sidebar--hidden" data-spy="affix" role="navigation" aria-label="main navigation">
            
              
              
              
                  <p class="caption" role="heading"><span class="caption-text">Welcome to Alation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/About/index.html">About Alation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/CloudAndOnPrem/index.html">Alation Cloud and On-Premise</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/QuickStart/index.html">Quick Start Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/UserProfileandPreferences/index.html">User Profile and Preferences</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/CatalogBasics/index.html">Catalog Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/Conversations/index.html">Conversations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/Domains/index.html">Domains</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/BestPractices/index.html">Best Practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/Glossary/index.html">Alation Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alation Cloud Service</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../cloud/StatusPage/index.html">Status Page</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cloud/CloudOverview/index.html">Cloud Service Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cloud/CloudConfiguration/index.html">Configuration for Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cloud/AlationAgent/index.html">Alation Agent</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alation Integration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../integration/AlationAnywhere/index.html">Alation Anywhere</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../integration/AlationConnectedSheets/index.html">Alation Connected Sheets</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Installation &amp; Configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/ServerInstallation/index.html">Install Alation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/HighAvailability/index.html">High Availability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/Runbook/index.html">Runbook for Administrators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/Update/index.html">Update Alation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/BackupandRestore/index.html">Back Up and Restore</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/LineageV2/index.html">Lineage V2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/LineageV3/index.html">Lineage V3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/AlationAnalyticsV2/index.html">Alation Analytics V2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/AlationContainerService/index.html">Alation Container Service</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Sources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../sources/CatalogSources/index.html">Catalog Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sources/VirtualDataSources/index.html">Virtual Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sources/Lineage/index.html">Lineage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sources/APIResources/index.html">API Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sources/WorkwithCatalogData/index.html">Working with Catalog Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sources/OpenConnectorFramework/index.html">Open Connector Framework</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Sources</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../DSConfiguration/index.html">Data Source Configuration</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Adding Data Sources</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="AWSGluewithoutHive.html">AWS Glue without Hive</a></li>
<li class="toctree-l2"><a class="reference internal" href="AzureDataWarehouse.html">Azure Data Warehouse</a></li>
<li class="toctree-l2"><a class="reference internal" href="Cassandra.html">Cassandra</a></li>
<li class="toctree-l2"><a class="reference internal" href="DatabricksAWS.html">Databricks on AWS</a></li>
<li class="toctree-l2"><a class="reference internal" href="DB2LUW.html">DB2 LUW</a></li>
<li class="toctree-l2"><a class="reference internal" href="Greenplum.html">Greenplum</a></li>
<li class="toctree-l2"><a class="reference internal" href="Impala.html">Impala</a></li>
<li class="toctree-l2"><a class="reference internal" href="MongoDB.html">MongoDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="MemSQL.html">MemSQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="MySQL.html">MySQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="Netezza.html">Netezza</a></li>
<li class="toctree-l2"><a class="reference internal" href="Oracle.html">Oracle</a></li>
<li class="toctree-l2"><a class="reference internal" href="PostgreSQL.html">PostgreSQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="PrestoOnHive.html">Presto on Hive</a></li>
<li class="toctree-l2"><a class="reference internal" href="Redshift.html">Amazon Redshift</a></li>
<li class="toctree-l2"><a class="reference internal" href="Salesforce.html">Salesforce</a></li>
<li class="toctree-l2"><a class="reference internal" href="SAPHANA.html">SAP Hana</a></li>
<li class="toctree-l2"><a class="reference internal" href="SAS.html">SAS</a></li>
<li class="toctree-l2"><a class="reference internal" href="Snowflake.html">Snowflake</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Snowflake OAuth For Compose</a></li>
<li class="toctree-l2"><a class="reference internal" href="SQLServer.html">SQL Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="SybaseIQ.html">Sybase IQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="SybaseASE.html">Sybase Adaptive Server Enterprise (ASE)</a></li>
<li class="toctree-l2"><a class="reference internal" href="Teradata.html">Teradata</a></li>
<li class="toctree-l2"><a class="reference internal" href="Vertica.html">Vertica</a></li>
<li class="toctree-l2"><a class="reference internal" href="KerberosConfiguration.html">Kerberos Configuration (General)</a></li>
<li class="toctree-l2"><a class="reference internal" href="ConfigureAlationDB.html">Configure Alation DB</a></li>
<li class="toctree-l2"><a class="reference internal" href="Appendix.html">Appendix</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ComposeSSOAWSDataSources/index.html">Compose SSO for Amazon Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ComposeSSOAzureDataSources/index.html">Compose SSO for Azure Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AuthenticationForExtraction/index.html">Authentication for Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CustomDB/index.html">Custom DB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GBQ/index.html">Google BigQuery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Hive/index.html">Hive</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">BI Sources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../bisources/AddBISources/index.html">Add BI Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bisources/AddTableauServer/index.html">Add Tableau Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bisources/WorkwithBISources/index.html">Working with BI Sources</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">File System Sources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/FileSystems/index.html">Add File Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/VirtualFileSystems/index.html">Virtual File Systems</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alation for Analysts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../analyst/UserAuthenticationForDataSources/index.html">User Authentication for Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analyst/ShareAndAccessQueries/index.html">Share and Access Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analyst/WriteQueries/index.html">Write Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analyst/DevelopQueries/index.html">Develop Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analyst/WorkwithQueryResults/index.html">Work with Query Results</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alation for Data Stewards</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../steward/GovernanceApp/index.html">Governance App</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/PolicyCenter/index.html">Policy Center</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/Workflow/index.html">Workflow Center</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/GovernanceDashboard/index.html">Governance Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/StewardshipWorkbench/index.html">Stewardship Workbench</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/AnalyticsStewardship/index.html">Analytics Stewardship</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/Glossary/index.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/ArticlesAndTags/index.html">Articles and Tags</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/ArticleGroups/index.html">Article Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/DataCatalogCustomization/index.html">Customize Your Data Catalog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/DataDocumentation/index.html">Data Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/AutoTitlingandLexicon/index.html">Auto-titling and Lexicon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/SnowflakeTags/index.html">Snowflake Tags</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alation for Server Administrators</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../admins/CustomizableHomePage/index.html">Customizable Homepage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/AdminSettings/index.html">Administrator Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/AdditionalConfiguration/index.html">Additional Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/RunbookForAdministrators/index.html">Runbook for Administrators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/AlationAPIs/index.html">Alation APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/How-tos/index.html">How-tos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/Troubleshooting/index.html">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Release Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../releases/releasenotes/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/supportmatrices/index.html">Support Matrices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/endofsupport/index.html">End Of Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/snowflakeclladdon/index.html">Snowflake Parser Add-On</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/fieldnotices/index.html">Important Notices and Security Alerts</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Archived Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../archive/About/index.html">About the Documentation Archive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../archive/AdminConfig/index.html">Administration and Update Archive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../archive/ReleaseNotes/index.html">Release Notes Archive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../archive/Usage/index.html">Usage and Customization Archive</a></li>
</ul>

              
            
          </div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="wy-nav-top-icon"></i>
        <a href="../../index.html">Alation User Guide</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">

          <div role="navigation" aria-label="breadcrumbs" class="breadcrumbs">
    <a href="../../index.html">Docs</a>
    <span class="separator">&gt;</span>
    <a href="index.html">Adding Data Sources</a>
    <span class="separator">&gt;</span>
    <span>Snowflake OAuth For Compose</span>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody" class="toBeIndexed">
            
  <section id="snowflake-oauth-for-compose">
<h1>Snowflake OAuth For Compose<a class="headerlink" href="#snowflake-oauth-for-compose" title="Permalink to this headline">¶</a></h1>
<p><em>Available from release 2020.3</em></p>
<p>Alation supports the OAuth 2.0 protocol for connections from Compose to Snowflake data sources.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>OAuth 2.0 provides a secure mechanism for authorizing an application to access database resources. This process is overseen by an authorization server.</p>
<p>Authorization is managed with access tokens which are used by an application to access resources to which it is authorized according to the token until that token expires.</p>
<p>When an access token has expired, a refresh token can be used to retrieve a new access token without re-authorization if the authorization server is configured to issue refresh tokens and a refresh token has been requested.</p>
</div>
<p>Snowflake offers two OAuth pathways:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>Snowflake built-in OAuth service</strong></p></li>
</ul>
<p>or</p>
<ul class="simple">
<li><p><strong>External OAuth service</strong> that integrates with an external OAuth 2.0-supporting authorization server.</p></li>
</ul>
</div></blockquote>
<p>Both these configurations are supported.</p>
<p>When OAuth is enabled for a Snowflake data source in Alation, a Compose user’s login credentials for Snowflake are not stored on the Alation server. When Compose users establish a connection to the data source, they are redirected to the Snowflake OAuth login screen in a new browser tab. They authenticate with the authorization server (built-in or external, depending on the configuration in Snowflake). After that the login screen tab closes, the tokens are stored, and Alation establishes the connection to the Snowflake resources.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Alation can connect to Snowflake with OAuth regardless of whether or not federated login is set up for Snowflake. In either case, users will be first redirected to the Snowflake login page to authorize and consent to connections.</p>
</div>
<p>The following functionality is supported with OAuth:</p>
<blockquote>
<div><ul class="simple">
<li><p>Query execution in Compose</p></li>
<li><p>Scheduled query execution</p></li>
<li><p>Query forms</p></li>
<li><p>Excel Live Reports</p></li>
<li><p>Data upload</p></li>
<li><p>Dynamic Profiling</p></li>
<li><p>Desktop Compose</p></li>
</ul>
</div></blockquote>
<section id="snowflake-service-account">
<h2>Snowflake Service Account<a class="headerlink" href="#snowflake-service-account" title="Permalink to this headline">¶</a></h2>
<p>The service account that is set up in Alation during the Snowflake data source configuration and that is used for MDE, Profiling, and QLI <strong>does NOT use OAuth</strong> to connect to Snowflake. OAuth works for Compose users only.</p>
</section>
<section id="no-enforcement-of-oauth">
<h2>No Enforcement of OAuth<a class="headerlink" href="#no-enforcement-of-oauth" title="Permalink to this headline">¶</a></h2>
<p>Enabling OAuth for a Snowflake data source is an option and is not enforced. Connection with OAuth can be enabled by including the <code class="docutils literal notranslate"><span class="pre">authenticator=oauth</span></code> parameter into the Compose URI after OAuth configuration is provided in the data source Settings.</p>
<p>Compose users still have the ability to connect by directly providing their Snowflake credentials. In such a case, their credentials will be stored on the Alation server for reuse.</p>
</section>
<section id="snowflake-built-in-oauth">
<h2>Snowflake Built-in OAuth<a class="headerlink" href="#snowflake-built-in-oauth" title="Permalink to this headline">¶</a></h2>
<p>To use Snowflake built-in OAuth service, perform the following configuration:</p>
<section id="step-1-create-a-snowflake-security-integration-for-alation">
<h3>STEP 1: Create a Snowflake Security Integration for Alation<a class="headerlink" href="#step-1-create-a-snowflake-security-integration-for-alation" title="Permalink to this headline">¶</a></h3>
<p>Support for connections to Snowflake OAuth server from Alation is built on the Snowflake OAuth for <a class="reference external" href="https://docs.snowflake.com/en/user-guide/oauth-custom.html">Custom Clients</a>.  This requires a Snowflake <em>security integration</em> to be created for Alation in Snowflake.</p>
<section id="minimal-security-integration">
<h4>Minimal Security Integration<a class="headerlink" href="#minimal-security-integration" title="Permalink to this headline">¶</a></h4>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">CREATE SECURITY INTEGRATION &lt;name&gt;</span>
<span class="go">  TYPE = OAUTH</span>
<span class="go">  ENABLED = TRUE</span>
<span class="go">  OAUTH_CLIENT = CUSTOM</span>
<span class="go">  OAUTH_CLIENT_TYPE = &#39;CONFIDENTIAL&#39;</span>
<span class="go">  OAUTH_REDIRECT_URI = &#39;https://&lt;alation.company.com&gt;/api/datasource_auth/oauth/callback&#39;;</span>
</pre></div>
</div>
<p>Note that the <strong>name</strong> of the security integration is visible to users on the consent screen following authorization.</p>
<p>The redirect URI must refer to the <strong>/api/datasource_auth/oauth/callback</strong> endpoint on the Alation instance from which users will connect to Snowflake.</p>
</section>
<section id="extended-integration">
<h4>Extended Integration<a class="headerlink" href="#extended-integration" title="Permalink to this headline">¶</a></h4>
<p>The following <a class="reference external" href="https://docs.snowflake.com/en/sql-reference/sql/create-security-integration.html#snowflake-oauth-custom-client-parameters-optional">parameters</a> can be additionally used when creating a security integration:</p>
<section id="refresh-tokens">
<h5>Refresh Tokens<a class="headerlink" href="#refresh-tokens" title="Permalink to this headline">¶</a></h5>
<p>Refresh tokens can greatly minimize the frequency with which Compose users must re-authorize with the Snowflake authorization server. This can be particularly useful for features such as scheduled queries and Excel Live Reports.</p>
<ul class="simple">
<li><p><strong>OAUTH_ISSUE_REFRESH_TOKENS</strong> parameter: controls whether refresh tokens can be used to acquire new access tokens without re-authorization from the user.</p></li>
<li><p><strong>OAUTH_REFRESH_TOKEN_VALIDITY</strong>: configures the lifetime of refresh tokens. Set to <strong>90</strong> days by default.</p></li>
</ul>
</section>
<section id="pkce">
<h5>PKCE<a class="headerlink" href="#pkce" title="Permalink to this headline">¶</a></h5>
<p><strong>OAUTH_ENFORCE_PKCE</strong> parameter: Alation uses PKCE to make the OAuth flow more secure. By default, this is not required by the Snowflake security integration.</p>
</section>
<section id="tls">
<h5>TLS<a class="headerlink" href="#tls" title="Permalink to this headline">¶</a></h5>
<p><strong>OAUTH_ALLOW_NON_TLS_REDIRECT_URI</strong> parameter: <strong>not recommended</strong></p>
<p>The integration can be configured to not enforce TLS using the OAUTH_ALLOW_NON_TLS_REDIRECT_URI parameter. If necessary, this allows the Snowflake authorization server to redirect to an Alation server over HTTP when returning authorization codes used in subsequent token requests.</p>
</section>
<section id="example">
<h5>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h5>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">CREATE SECURITY INTEGRATION &lt;name&gt;</span>
<span class="go">TYPE=OAUTH</span>
<span class="go">ENABLED=TRUE</span>
<span class="go">OAUTH_CLIENT = CUSTOM</span>
<span class="go">OAUTH_CLIENT_TYPE=&#39;CONFIDENTIAL&#39;</span>
<span class="go">OAUTH_REDIRECT_URI=&#39;http://&lt;alation.company.com&gt;/api/datasource_auth/oauth/callback&#39;</span>
<span class="go">OAUTH_ISSUE_REFRESH_TOKENS = TRUE</span>
<span class="go">OAUTH_REFRESH_TOKEN_VALIDITY = 3600;</span>
<span class="go">OAUTH_ENFORCE_PKCE = TRUE</span>
<span class="go">OAUTH_ALLOW_NON_TLS_REDIRECT_URI = TRUE</span>
</pre></div>
</div>
<p>After the security integration has been created, proceed to <a class="reference internal" href="#enable-oauth-in-alation">Enable OAuth in Alation</a>.</p>
</section>
</section>
</section>
</section>
<section id="snowflake-external-oauth">
<h2>Snowflake External OAuth<a class="headerlink" href="#snowflake-external-oauth" title="Permalink to this headline">¶</a></h2>
<p>Alation supports Snowflake External OAuth with IdPs that support the <strong>OAuth 2.0 authorization code grant type</strong>. Alation requires a client ID and Secret to request access tokens for authorization with Snowflake.</p>
<p>Specific OAuth providers supported by Snowflake are described in <a class="reference external" href="https://docs.snowflake.com/en/user-guide/oauth-external.html">External OAuth</a> in Snowflake documentation. In case of a custom provider, the JWT claims expected by Snowflake are described in <a class="reference external" href="https://docs.snowflake.com/en/user-guide/oauth-ext-custom.html#external-oauth-token-payload-requirements">External OAuth Token Payload Requirements</a>.</p>
<p>Specific steps to register Alation in your OAuth environment for Snowflake will differ depending on the OAuth provider. You need to perform configuration on the Snowflake side and the IdP side before configuring OAuth in the Snowflake data source settings in Alation. Please refer to the Snowflake documentation linked above for details on how to set up OAuth with Snowflake-supported providers.</p>
<p>When registering Alation with your IdP, use the following redirect URL:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">https://&lt;your_Alation_URL&gt;/api/datasource_auth/oauth/callback</span></code></p></li>
</ul>
</div></blockquote>
<p>For configuration on the Alation side, collect the values listed below from your OAuth environment. The required values can usually be found in the authorization server metadata file and in the authorization client settings.</p>
<blockquote>
<div><ul class="simple">
<li><p>Authorization client ID</p></li>
<li><p>Authorization client Secret</p></li>
<li><p>Authorization endpoint</p></li>
<li><p>Token endpoint</p></li>
<li><p>jwks_uri</p></li>
</ul>
</div></blockquote>
<p>If you wish to allow Compose users to switch roles using the <code class="docutils literal notranslate"><span class="pre">USE</span> <span class="pre">ROLE</span></code> statement, make sure the Snowflake security integration includes the required parameters to enable the <code class="docutils literal notranslate"><span class="pre">any_role</span></code> mode and that the authorization server configuration includes the required scopes.</p>
<p>For a specific example, see <a class="reference internal" href="#example-configuration-external-oauth-with-okta">Example Configuration: External OAuth with Okta</a> below.</p>
<p>Ensure that any IdP users expected to connect with access tokens issued by the authorization server also exist in Snowflake.</p>
<section id="snowflake-users">
<h3>Snowflake Users<a class="headerlink" href="#snowflake-users" title="Permalink to this headline">¶</a></h3>
<p>The login name for users as specified by EXTERNAL_OAUTH_SNOWFLAKE_USER_MAPPING_ATTRIBUTE in the Snowflake security integration for the External OAuth provider must be correctly mapped onto the value specified by EXTERNAL_OAUTH_TOKEN_USER_MAPPING_CLAIM (for example, “sub” (subject) claim for default Okta setup).</p>
<p>Also ensure that the user is explicitly assigned a default role within Snowflake, as the PUBLIC role is not automatically assigned to users without a default role when making connections with an External OAuth token. This, however, is not required if the role is specified as Default Scope in Alation or the authorization server, including the case when role switching is authorized.</p>
</section>
</section>
<section id="enable-oauth-in-alation">
<h2>Enable OAuth in Alation<a class="headerlink" href="#enable-oauth-in-alation" title="Permalink to this headline">¶</a></h2>
<p>Perform this configuration in Alation after performing the required configuration in Snowflake and /or on the external authorization server side.</p>
<p>To enable OAuth in Compose for Snowflake,</p>
<ol class="arabic simple">
<li><p>Open the data source Settings &gt; <strong>General Settings</strong> tab, scroll down to the <strong>Compose Connections</strong> section, and locate the <strong>OAuth Connection</strong> block.</p></li>
<li><p>Select the checkbox <strong>Enable OAuth for all Compose Connections</strong>. This reveals a number of parameters for the OAuth setup:</p></li>
</ol>
<p><strong>2020.3</strong>:</p>
<blockquote>
<div><img alt="../../_images/DS_SnowflakeOAuth01.png" src="../../_images/DS_SnowflakeOAuth01.png" />
</div></blockquote>
<p><strong>2020.4 and later</strong>:</p>
<blockquote>
<div><img alt="../../_images/DS_SnowflakeOAuth12.png" src="../../_images/DS_SnowflakeOAuth12.png" />
</div></blockquote>
<ol class="arabic" start="3">
<li><p>Specify the values. See <a class="reference internal" href="#oauth-parameters">OAuth Parameters</a>.</p></li>
<li><p>Click <strong>Save</strong>.</p></li>
<li><p>Edit the default Compose connection to use OAuth as described below or add a new Compose connection that is OAuth-enabled. For making the connection string OAuth-enabled, add the query parameter <strong>authenticator=oauth</strong> to the connection URI with the &amp; symbol as the separator.</p>
<blockquote>
<div><p>Example:</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>snowflake://alation_test.us-east-1.snowflakecomputing.com:443/?warehouse<span class="o">=</span>DEMO_WH<span class="p">&amp;</span><span class="nv">authenticator</span><span class="o">=</span>oauth
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Test the configuration in Compose by connecting to your Snowflake data source and running a test query.</p></li>
</ol>
<section id="edit-the-default-compose-connection">
<h3>Edit the Default Compose Connection<a class="headerlink" href="#edit-the-default-compose-connection" title="Permalink to this headline">¶</a></h3>
<p>The Default Compose Connection inherits the URI provided during the data source set up. It is recommended to change the URI of the Default Connection under General Settings &gt; <strong>Compose Connections</strong> so that Compose users connect via OAuth by default and are not.</p>
<p>Add the parameter <strong>authenticator=oauth</strong> to the Default Connection URI and save:</p>
<blockquote>
<div><img alt="../../_images/DS_SnowflakeOAuth04.png" src="../../_images/DS_SnowflakeOAuth04.png" />
</div></blockquote>
<p>Now in Compose, when users use the default connection, they will be prompted to authenticate with the OAuth authorization server configured in Snowflake.</p>
</section>
<section id="oauth-parameters">
<h3>OAuth Parameters<a class="headerlink" href="#oauth-parameters" title="Permalink to this headline">¶</a></h3>
<table class="longtable colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Snowflake built-in
OAuth</p></th>
<th class="head"><p>Snowflake External
OAuth</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Client ID</p></td>
<td><p>Authorization Client
ID</p></td>
<td><p>Client ID provided by
Snowflake when the client
is registered with the
security integration</p></td>
<td><p>Client ID is usually
available in the OAuth
client application
settings</p></td>
</tr>
<tr class="row-odd"><td><p>Client Secret</p></td>
<td><p>Authorization Client
Secret</p></td>
<td><p>Client Secret is provided
by Snowflake  when the
client is registered with
the security integration</p></td>
<td><p>Client Secret is usually
available in the OAuth
client application
settings</p></td>
</tr>
<tr class="row-even"><td><p>Authorization
Endpoint</p></td>
<td><p>The authorization endpoint
to be used to obtain an
authorization grant after
a user authorizes a client
with Snowflake.</p></td>
<td><p>Stored in the security
integration</p></td>
<td><p>Is usually available in
the IdP metadata file if
one is provided</p></td>
</tr>
<tr class="row-odd"><td><p>Token Request
Endpoint</p></td>
<td><p>This endpoint returns access
tokens or refresh tokens
depending on the request
parameters.</p></td>
<td><p>Stored in the security
integration</p></td>
<td><p>Is usually available in
the IdP metadata file if
one is provided</p></td>
</tr>
<tr class="row-even"><td><p>Default Scope</p></td>
<td><p>The Scope parameters limit
the operations and the role
permitted by the access
token. This field can be
used to specify a default
Snowflake role for every
user.</p></td>
<td><p>Can be left blank to use
the Snowflake default
value. The default is
determined by the user’s
default role. If no
default role is assigned
to the user, the default
is PUBLIC.</p></td>
<td><p>Scope is usually
configured on the
authorization server side
if it supports scope.</p></td>
</tr>
<tr class="row-odd"><td><p>Request for Refresh
Token</p></td>
<td><p>Allows offline access or
whether refresh tokens can
be used to acquire new
access tokens without
re-authorization from the
user. Refresh tokens can
greatly minimize the
frequency with which Compose
users must re-authorize</p></td>
<td><p>Should be selected if the
OAUTH_ISSUE_REFRESH_TOKENS
property is set to TRUE in
the Snowflake security
integration.</p></td>
<td><p>Depends on the
authorization
server configuration.</p></td>
</tr>
<tr class="row-even"><td><p>Refresh Scope</p></td>
<td><p>Applies when the Request
for Refresh Token is
enabled. Use this field
to specify the scope for
Alation to use during
authorization in order to
request refresh tokens from
the authorization server
during token request.</p></td>
<td><p>Set to: <code class="docutils literal notranslate"><span class="pre">refresh_token</span></code></p></td>
<td><p>Depends on the
authorization
server configuration.</p></td>
</tr>
<tr class="row-odd"><td><p>Username field/claim</p></td>
<td><p>Property of the top-level
JSON attribute in the
Snowflake authorization
server response to a token
request that contains
the identity of the
authorized Snowflake user.</p></td>
<td><p>Set to: <code class="docutils literal notranslate"><span class="pre">username</span></code></p></td>
<td><p>Can be obtained from the
Snowflake security
integration
for the External IdP
provider</p></td>
</tr>
<tr class="row-even"><td><p>Enable PKCE
Proof Key for Code
Exchange</p></td>
<td><p>PKCE is a way to make a
token request more secure.
Optional property.
Select if available.</p></td>
<td><p>Select if the
OAUTH_ENFORCE_PKCE field
of the security
integration is set to
TRUE</p></td>
<td><p>Depends on the
authorization
server configuration.</p></td>
</tr>
<tr class="row-odd"><td><p>In <strong>2020.3</strong>:</p>
<p>Extract Username
from JWT claim</p>
<p>In <strong>2020.4</strong>:</p>
<p>JWT</p>
</td>
<td><p>For most authorization
servers, access tokens are
issued as a JWT, and the
username information can be
extracted as a specific
claim from the token.
Alation needs to determine
the Snowflake user who has
been authorized and is
used for the connection for
both display purposes and
to enable storage and
tracking of multiple access
tokens per Alation user and
per connection URI.
When this checkbox is left
unselected, Alation attempts
to extract the username
information as a top-level
attribute of the JSON
response returned from the
authorization server upon
token request.</p></td>
<td><p>Leave this checkbox
unselected. Snowflake
issues the username as
a top-level JSON attribute
in the response returned
for the token request.</p></td>
<td><p>Select this checkbox</p></td>
</tr>
<tr class="row-even"><td><p>Access token
parameter name*</p></td>
<td><p><em>Available from 2020.4</em></p>
<p>Provide the name of the
parameter your JDBC driver
uses to pass in the OAuth
token. Can be saved as
blank. When no value is
provided by the  Admin,
Alation supplies the default
value that is accepted by
the built-in driver.</p>
</td>
<td><p>Can leave blank</p></td>
<td><p>Can leave blank</p></td>
</tr>
<tr class="row-odd"><td><p>OAuth Enablers*</p></td>
<td><p><em>Available from 2020.4</em></p>
<p>Provide a single parameter
or a list of parameters
separated by the <code class="docutils literal notranslate"><span class="pre">&amp;</span></code>
symbol that indicate that
OAuth is enabled for your
connection.
Can be saved as blank. When
no value is provided by the
Admin, Alation supplies
the default value that is
accepted by the built-in
driver.</p>
</td>
<td><p>Can leave blank</p></td>
<td><p>Can leave blank</p></td>
</tr>
</tbody>
</table>
<p>* - The <strong>Access token parameter name</strong> and <strong>OAuth Enablers</strong> will be supplied with default values when saved as blank fields. The default values are the ones required by the default driver. You can leave these fields blank when using the built-in driver for Snowflake. If you are using a custom driver, specify the OAuth parameters accepted by your custom driver.</p>
</section>
<section id="configuration-for-snowflake-built-in-oauth">
<h3>Configuration For Snowflake Built-In OAuth<a class="headerlink" href="#configuration-for-snowflake-built-in-oauth" title="Permalink to this headline">¶</a></h3>
<p>Example:</p>
<blockquote>
<div><img alt="../../_images/DS_SnowflakeOAuth02.png" src="../../_images/DS_SnowflakeOAuth02.png" />
</div></blockquote>
<p>Parameter Values:</p>
<table class="longtable colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Recommendations</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Client ID</p>
<p>Client Secret</p>
</td>
<td><p>Can be retrieved with the
<strong>SYSTEM$SHOW_OAUTH_CLIENT_SECRETS</strong> function:</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span><span class="sb">``</span>SELECT<span class="w"> </span>SYSTEM<span class="nv">$SHOW_OAUTH_CLIENT_SECRETS</span><span class="o">(</span><span class="w"> </span><span class="s1">&#39;&lt;name&gt;&#39;</span><span class="w"> </span><span class="o">)</span><span class="p">;</span><span class="sb">``</span>
</pre></div>
</div>
</div></blockquote>
</td>
</tr>
<tr class="row-odd"><td><p>Authorization Endpoint</p>
<p>Token Request Endpoint</p>
</td>
<td><p>Can be retrieved with:</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>DESC<span class="w"> </span>SECURITY<span class="w"> </span>INTEGRATION<span class="w"> </span>&lt;name&gt;<span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
<p>The Authorization Endpoint looks similar to:
<code class="docutils literal notranslate"><span class="pre">https://&lt;account_name&gt;.snowflakecomputing.com/oauth/authorize</span></code></p>
<p>The Token Request Endpoint looks similar to:
<code class="docutils literal notranslate"><span class="pre">https://&lt;account_name&gt;.snowflakecomputing.com/oauth/token-request</span></code></p>
</td>
</tr>
<tr class="row-even"><td><p>Default Scope</p></td>
<td><p>The built-in Snowflake authorization server automatically assigns a
default scope if none is specified in the authorization request.
The default is determined by the user’s default role;
if no default role is assigned to the user, the default is PUBLIC.
Note that <code class="docutils literal notranslate"><span class="pre">SESSION:ROLE-ANY</span></code> can not be used as an authorization
scope as role switching is supported only with External OAuth.</p></td>
</tr>
<tr class="row-odd"><td><p>Request for Refresh
Token</p></td>
<td><p>For the built-in OAuth, this is controlled by the
OAUTH_ISSUE_REFRESH_TOKENS parameter of the Snowflake
security integration.</p>
<p>Select this checkbox if the OAUTH_ISSUE_REFRESH_TOKENS property is
set to TRUE in the security integration used for Alation.</p>
<p>The expiry of refresh tokens can be configured via the
OAUTH_REFRESH_TOKEN_VALIDITY parameter and defaults to 90 days.</p>
</td>
</tr>
<tr class="row-even"><td><p>Refresh Scope</p></td>
<td><p>Specify value: <code class="docutils literal notranslate"><span class="pre">refresh_token</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Username field/claim</p></td>
<td><p>Specify value: <code class="docutils literal notranslate"><span class="pre">username</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Enable PKCE</p></td>
<td><p>Select if the OAUTH_ENFORCE_PKCE property of the security integration
is set to TRUE.</p></td>
</tr>
<tr class="row-odd"><td><p>Extract Username from
JWT claim/JWT</p></td>
<td><p>Leave unselected</p></td>
</tr>
<tr class="row-even"><td><p>Access token parameter
name</p></td>
<td><p>Can be left blank</p></td>
</tr>
<tr class="row-odd"><td><p>OAuth Enablers</p></td>
<td><p>Can be left blank</p></td>
</tr>
</tbody>
</table>
</section>
<section id="configuration-for-external-snowflake-oauth">
<h3>Configuration for External Snowflake OAuth<a class="headerlink" href="#configuration-for-external-snowflake-oauth" title="Permalink to this headline">¶</a></h3>
<p>Example:</p>
<blockquote>
<div><img alt="../../_images/DS_SnowflakeOAuth02.png" src="../../_images/DS_SnowflakeOAuth02.png" />
</div></blockquote>
<p>Parameter Values:</p>
<table class="longtable colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Recommendations</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Client ID</p>
<p>Client Secret</p>
<p>Authorization Endpoint</p>
<p>Token Request Endpoint</p>
</td>
<td><p>The values can usually be obtained from the OAuth client
configuration. They may also be present in the server metadata file
when one is available.</p></td>
</tr>
<tr class="row-odd"><td><p>Default Scope</p></td>
<td><p>The OAuth provider may allow for specifying the default scope and
may allow for creating policies for assigning such default scope.
It is important that scope for at least one Snowflake role
is specified if Snowflake users do not have a default role assigned
within Snowflake.
The authorization server may only issue authorization for Default Scope
specified in the authorization server configuration if no other scope
is specified during authorization. Any scope specified in the Alation
settings Default Scope takes priority over the Default Scope
specified by the authorization server.
If you choose to provide a specific role for the Default Scope
in Alation, note that the authorization server may expect the case
to match between the Scope specified in the authorization request and
the Scope configured for the authorization server. The authorization
server configuration must declare the scope to match case, for example:
<code class="docutils literal notranslate"><span class="pre">session:role:ALL_CAPS_ROLE_NAME</span></code>. The case of the value specified
in Alation must use the matching case: <code class="docutils literal notranslate"><span class="pre">session:role:PUBLIC</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p>Request for Refresh
Token</p></td>
<td><p>Select this checkbox in order to use the refresh grant type to allow
Alation to automatically retrieve new access tokens.</p></td>
</tr>
<tr class="row-odd"><td><p>Refresh Scope</p></td>
<td><p>If the refresh grant type is enabled, Refresh Scope specifies
what scope Alation will use during authorization in order to request
refresh tokens from the authorization server during token request.</p>
<p>Different authorization servers may use a different value or not
require refresh scope at all and issue refresh tokens automatically
based on server configuration.</p>
<p>The authorization server may only issue authorization for default scope
specified in the authorization server configuration if no other
scope is specified during authorization. Any scope specified here
in the Alation settings Refresh Scope, or the Alation settings Default
Scope, or by specifying a role in the connection URI can result
in none of the default scope specified in the authorization server
configuration to be applied.</p>
</td>
</tr>
<tr class="row-even"><td><p>Extract Username from
JWT claim/JWT</p></td>
<td><p>This should be selected for external OAuth with Snowflake.</p>
<p>For most authorization servers, the username information
can be extracted as a specific claim from the token; otherwise, Alation
attempts to extract the username information as a top-level attribute
of the JSON response returned by the authorization server upon token
request.</p>
</td>
</tr>
<tr class="row-odd"><td><p>Username field/claim</p></td>
<td><p>The claim attribute to be used to retrieve the user requesting
authorization from the access token. This is the value of the
EXTERNAL_OAUTH_TOKEN_USER_MAPPING_CLAIM field of the Snowflake security
integration for the External OAuth provider.
The value here must match the value of a Snowflake user’s login
name as specified by EXTERNAL_OAUTH_SNOWFLAKE_USER_MAPPING_ATTRIBUTE
in the security integration. EXTERNAL_OAUTH_TOKEN_USER_MAPPING_CLAIM
will differ for Okta, Azure AD, PingFederate, and other custom client
authorization servers.</p></td>
</tr>
<tr class="row-even"><td><p>Enable PKCE</p></td>
<td><p>This should be selected if the Authorization Server is configured to
use PKCE.
This will not be possible for some setups. For example, with Okta’s Web
application type, PKCE is not available.</p></td>
</tr>
<tr class="row-odd"><td><p>Access token parameter
name</p></td>
<td><p>Can be left blank</p></td>
</tr>
<tr class="row-even"><td><p>OAuth Enablers</p></td>
<td><p>Can be left blank</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="role-switching">
<h2>Role Switching<a class="headerlink" href="#role-switching" title="Permalink to this headline">¶</a></h2>
<p>Role switching is not supported with Snowflake built-in OAuth. With built-in OAuth, Compose users can connect with either of the following:</p>
<blockquote>
<div><ul class="simple">
<li><p>The role they provided in the Connection URI;</p></li>
<li><p>The role specified in the Default Scope in the OAuth configuration parameters in Alation;</p></li>
<li><p>If neither of the above is specified, then the connection will be established with the default role assigned to them in Snowflake. If no default role is assigned, the connection uses the role PUBLIC.</p></li>
</ul>
</div></blockquote>
<p>Role switching is supported with the External OAuth configuration. This means the USE ROLE statement in Compose can be used to switch to any role accessible to the Snowflake user.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Role switching needs the Default Scope to be set to SESSION:ROLE-ANY.</p>
<p>To apply the Default Scope  SESSION:ROLE-ANY, ensure that the <strong>EXTERNAL_OAUTH_ANY_ROLE_MODE</strong> field is set to ENABLE in the Snowflake security integration used in the External OAuth configuration.</p>
</div>
<p>Even if the configured <strong>Default Scope</strong> for the data source includes SESSION:ROLE-ANY, any role specified by the user in the connection URI will still validly result in additional scope specified in the authorization request. For example, Okta issues an access token valid for both scopes.</p>
<p>If the configured <strong>Default Scope</strong> for the data source includes a specific Snowflake role, the more permissive role is assigned as the current role when the connection is initiated even if the user’s default role is less permissive. In this case, role switching is not allowed as it is only enabled with the SESSION:ROLE-ANY value specified in the Default Scope.</p>
<section id="using-case-sensitive-roles-or-roles-with-special-characters">
<h3>Using Case-Sensitive Roles or Roles with Special Characters<a class="headerlink" href="#using-case-sensitive-roles-or-roles-with-special-characters" title="Permalink to this headline">¶</a></h3>
<p><em>Applies from version 2021.3</em></p>
<p>Snowflake roles that are case-sensitive or contain special characters require double-quoted identifiers in order to be resolved. An example can be a role defined in Snowflake as <code class="docutils literal notranslate"><span class="pre">role.name</span></code>:</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">CREATE ROLE IF NOT EXISTS &quot;role.name&quot;</span>
</pre></div>
</div>
</div></blockquote>
<p>A user may have such a role assigned as their default role. If not, they should follow the recommendations below to switch to such a role.</p>
<section id="id1">
<h4>External OAuth<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>Switch roles with the <code class="docutils literal notranslate"><span class="pre">USE</span> <span class="pre">ROLE</span></code> statement and using the double-quoted identifiers.</p>
</section>
<section id="built-in-snowflake-oauth">
<h4>Built-in Snowflake OAuth<a class="headerlink" href="#built-in-snowflake-oauth" title="Permalink to this headline">¶</a></h4>
<p>Specify the role in the connection URI, using URL-encoding for the role name, for example:</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">role=%22role.name%22</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>URI example</strong>:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>snowflake://your_domain.snowflakecomputing.com:443/?warehouse<span class="o">=</span>DEMO<span class="p">&amp;</span><span class="nv">authenticator</span><span class="o">=</span>oath<span class="p">&amp;</span><span class="nv">role</span><span class="o">=</span>%22role.name%22
</pre></div>
</div>
</div></blockquote>
</section>
</section>
</section>
<section id="connect-in-compose">
<h2>Connect in Compose<a class="headerlink" href="#connect-in-compose" title="Permalink to this headline">¶</a></h2>
<p>Compose users can connect to the OAuth-enabled Snowflake data source either selecting a connection from <strong>Company Connections</strong> or from <strong>My Connections</strong>.</p>
<p><strong>Company Connections</strong> are defined under General Settings &gt; <strong>Compose Connections</strong>. My Connections lists private connections created by users:</p>
<blockquote>
<div><img alt="../../_images/DS_SnowflakeOAuth05.png" src="../../_images/DS_SnowflakeOAuth05.png" />
</div></blockquote>
<section id="oauth-connection-uri">
<h3>OAuth Connection URI<a class="headerlink" href="#oauth-connection-uri" title="Permalink to this headline">¶</a></h3>
<p>In order to create a connection that uses OAuth, the URI must include the <code class="docutils literal notranslate"><span class="pre">authenticator=oauth</span></code> query parameter. For example:</p>
<p><code class="docutils literal notranslate"><span class="pre">snowflake://account.snowflakecomputing.com:443/?warehouse=WH1&amp;authenticator=oauth</span></code></p>
</section>
<section id="specify-a-role-for-connection">
<h3>Specify a Role for Connection<a class="headerlink" href="#specify-a-role-for-connection" title="Permalink to this headline">¶</a></h3>
<p>Compose users can specify a role in the Connection URI:</p>
<p><code class="docutils literal notranslate"><span class="pre">snowflake://alation_partner.us-east-1.snowflakecomputing.com:443/?warehouse=DEMO_WH&amp;authenticator=oauth&amp;role=&lt;role_name&gt;</span></code></p>
<p>When a role is specified the connection allows to query Snowflake within the scope of this role.</p>
<p>If role-switching is configured, then users can switch to a different role available to them in Snowflake with the USE ROLE statement.</p>
</section>
</section>
<section id="example-configuration-external-oauth-with-okta">
<h2>Example Configuration: External OAuth with Okta<a class="headerlink" href="#example-configuration-external-oauth-with-okta" title="Permalink to this headline">¶</a></h2>
<p>For details on how Snowflake works with Okta as External OAuth provider, refer to <a class="reference external" href="https://docs.snowflake.com/en/user-guide/oauth-okta.html">Configure Okta for External OAuth</a> in Snowflake documentation.</p>
<p>To set up External OAuth with Okta, perform the following configuration:</p>
<blockquote>
<div><ul class="simple">
<li><p>In Snowflake: if this has not been done yet, set up External OAuth with Okta;</p></li>
<li><p>In Okta: create an OAuth client application for Alation;</p></li>
<li><p>In Alation: enable and configure the OAuth for your Snowflake data source.</p></li>
</ul>
</div></blockquote>
<section id="okta-client-application">
<h3>Okta Client Application<a class="headerlink" href="#okta-client-application" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p>When creating the client application in Okta, use <strong>Web</strong> as the Application type.</p></li>
<li><p>In the client application settings:</p>
<blockquote>
<div><ul>
<li><p>Under <strong>General &gt; General Settings &gt; Application &gt; Allowed grant types</strong>, ensure that the <strong>Authorization Code</strong> and <strong>Refresh Token</strong> checkboxes are selected;</p></li>
<li><p>(Optional) <strong>Under General &gt; General Settings &gt; User Consent &gt; User consent</strong>, select <strong>Require consent</strong>;</p></li>
<li><p>Under <strong>General &gt; General Settings &gt; LOGIN &gt; Login redirect URIs</strong>, add <code class="docutils literal notranslate"><span class="pre">https://&lt;alation.company.com&gt;/api/datasource_auth/oauth/callback/</span></code></p>
<blockquote>
<div><ul class="simple">
<li><p>Ensure the URI ends with “/”</p></li>
<li><p>HTTP can be specified without having to change any TLS settings</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ol>
</section>
<section id="okta-authorization-server-configuration">
<h3>Okta Authorization Server Configuration<a class="headerlink" href="#okta-authorization-server-configuration" title="Permalink to this headline">¶</a></h3>
<p>In the Okta Authorization Server for Snowflake settings:</p>
<ol class="arabic simple">
<li><p>Ensure that the audience URL does not have a trailing slash, for example: <code class="docutils literal notranslate"><span class="pre">https://alation_test.us-east-1.snowflakecomputing.com</span></code></p></li>
<li><p>Consider adding <code class="docutils literal notranslate"><span class="pre">SESSION:ROLE-ANY</span></code> as a Scope to avoid adding a Scope entry for each role. You can create a policy to allow all users’ use of this scope. This will allow users to connect to Snowflake as any role to which they have access in Snowflake and will also enable role switching in Compose with the <code class="docutils literal notranslate"><span class="pre">USE</span> <span class="pre">ROLE</span></code> statement. Otherwise, create Scopes linked to specific Snowflake roles and add policies limiting use of these roles to specific users.</p></li>
</ol>
<p>3. In the security integration created for this Okta Authorization Server in Snowflake,
to enable role switching, set the <code class="docutils literal notranslate"><span class="pre">EXTERNAL_OAUTH_ANY_ROLE_MODE</span></code> field to <code class="docutils literal notranslate"><span class="pre">ENABLE</span></code>.</p>
</section>
<section id="configuration-in-alation">
<h3>Configuration in Alation<a class="headerlink" href="#configuration-in-alation" title="Permalink to this headline">¶</a></h3>
<img alt="../../_images/DS_SnowflakeOAuth13.png" src="../../_images/DS_SnowflakeOAuth13.png" />
<table class="docutils align-default">
<colgroup>
<col style="width: 34%" />
<col style="width: 66%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Property</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Client ID</p></td>
<td><p>Public identifier for the client. Can be found in
the Okta client application settings &gt; Client Credentials.</p></td>
</tr>
<tr class="row-odd"><td><p>Client Secret</p></td>
<td><p>Secret used by the client to request the access token. Can
be found in the Okta client application settings &gt;
Client Credentials.</p></td>
</tr>
<tr class="row-even"><td><p>Request Refresh Tokens</p></td>
<td><p>Select this checkbox</p></td>
</tr>
<tr class="row-odd"><td><p>Enable PKCE</p></td>
<td><p>Leave this checkbox clear</p></td>
</tr>
<tr class="row-even"><td><p>Authorization Endpoint</p></td>
<td><p>Can be found in the metadata file of the Okta authorization
server that is used for External OAuth in Snowflake</p></td>
</tr>
<tr class="row-odd"><td><p>Token Request Endpoint</p></td>
<td><p>Can be found in the metadata file of the authorization server</p></td>
</tr>
<tr class="row-even"><td><p>Default Scope</p></td>
<td><p>Can be found in the authorization server settings &gt; Scopes.
Example: <code class="docutils literal notranslate"><span class="pre">SESSION:ROLE-ANY</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Refresh Scope</p></td>
<td><p>Set to <code class="docutils literal notranslate"><span class="pre">offline_access</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Username Field/Claim</p></td>
<td><p>Usually set to <code class="docutils literal notranslate"><span class="pre">sub</span></code>
Can be found in the <code class="docutils literal notranslate"><span class="pre">EXTERNAL_OAUTH_TOKEN_USER_MAPPING_CLAIM</span></code>
field of the Snowflake security integration.</p></td>
</tr>
<tr class="row-odd"><td><p>Extract Username from JWT claim
/JWT</p></td>
<td><p>Select this checkbox</p></td>
</tr>
<tr class="row-even"><td><p>Access token parameter name</p></td>
<td><p>Leave clear (this results in Alation using the default value)</p></td>
</tr>
<tr class="row-odd"><td><p>OAuth enablers</p></td>
<td><p>Leave clear (this results in Alation using the default value)</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="authorization-flow-in-compose">
<h2>Authorization Flow in Compose<a class="headerlink" href="#authorization-flow-in-compose" title="Permalink to this headline">¶</a></h2>
<p>The following query execution features are supported in Compose using OAuth connections:</p>
<ul class="simple">
<li><p>Run Full Query</p></li>
<li><p>Run Current Statement</p></li>
<li><p>Run Full Query as Script</p></li>
<li><p>Run Full Query &amp; Ignore Errors</p></li>
<li><p>Run &amp; Export Full Query</p></li>
<li><p>Run &amp; Export Current Statement</p></li>
<li><p>Run &amp; Export as Script</p></li>
</ul>
<p>Each of query execution operations is performed in the context of a connection URI and may require authorization before the connection can be established. Authorization is required when the connection using the URI is established for the first time. Re-authorization is required when both the access and refresh tokens have expired. Separate authorization is required for each Snowflake account used to authorize connections with the same URI.</p>
<p>When authorization is required to establish a connection, the Compose user is prompted to initiate the authorization flow by clicking the link <strong>Click here to authorize access before connecting</strong>:</p>
<img alt="../../_images/DS_SnowflakeOAuth06.png" src="../../_images/DS_SnowflakeOAuth06.png" />
<p>When clicked, a new browser tab is opened and the user is navigated to the Snowflake authorization screen where they must authenticate with Snowflake either by:</p>
<ul class="simple">
<li><p>entering their Snowflake credentials</p></li>
<li><p>if federated access is configured, by being redirected to the appropriate IdP for authentication:</p></li>
</ul>
<img alt="../../_images/DS_SnowflakeOAuth09.png" src="../../_images/DS_SnowflakeOAuth09.png" />
<p>Next, the user will be presented with a consent screen if this is the first time they are connecting using this Snowflake role:</p>
<img alt="../../_images/DS_SnowflakeOAuth10.png" src="../../_images/DS_SnowflakeOAuth10.png" />
<p>After authorization and consent have been completed, this browser tab closes, and the user is returned to Compose where they will see confirmation of successful connection:</p>
<a class="reference internal image-reference" href="../../_images/DS_SnowflakeOAuth07.png"><img alt="../../_images/DS_SnowflakeOAuth07.png" src="../../_images/DS_SnowflakeOAuth07.png" style="width: 300px;" /></a>
</section>
<section id="authorization-flow-for-scheduling-queries">
<h2>Authorization Flow for Scheduling Queries<a class="headerlink" href="#authorization-flow-for-scheduling-queries" title="Permalink to this headline">¶</a></h2>
<p>It is possible to use an OAuth-enabled connection when scheduling queries in Compose. You can either select from saved connections or specify a new URI manually.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is recommended to enable refresh tokens for the Snowflake integration so that access tokens are requested automatically. However, if both the access and refresh tokens expire, the scheduled query run cannot happen until users re-authorize in Compose.</p>
</div>
<p>Click <strong>Test Authorization</strong> in the Schedule Query dialog to verify the connection:</p>
<a class="reference internal image-reference" href="../../_images/DS_SnowflakeOAuth11.png"><img alt="../../_images/DS_SnowflakeOAuth11.png" src="../../_images/DS_SnowflakeOAuth11.png" style="width: 400px;" /></a>
<p>Note that you may need to re-authorize if the tokens have expired. In this case, <strong>Test Authorization</strong> will start the authorization flow with Snowflake.</p>
</section>
<section id="authorization-error-messages">
<h2>Authorization Error Messages<a class="headerlink" href="#authorization-error-messages" title="Permalink to this headline">¶</a></h2>
<p>In case the OAuth configuration is incorrect and does not match the Authorization Server configurations, you may get authorization errors in Alation. The error usually contains details about possible causes and may include some troubleshooting tips.</p>
<section id="authorization-errors">
<h3>Authorization Errors<a class="headerlink" href="#authorization-errors" title="Permalink to this headline">¶</a></h3>
<table class="longtable colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Error</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Authorization terminated unexpectedly.</p></td>
<td><p>This message is shown:</p>
<ul class="simple">
<li><p>If the redirect browser window or tab is manually closed
before authorization completes;</p></li>
<li><p>The Client ID specified in the OAuth configuration may be
incorrect;</p></li>
<li><p>The authorization endpoint may be incorrect.</p></li>
</ul>
<p>Check the OAuth configuration in Alation and ensure that you
are passing the correct Client ID, authorization endpoint.</p>
</td>
</tr>
<tr class="row-odd"><td><p>The authorization server reported a failed
authorization attempt:</p></td>
<td><p>If authorization fails, the authorization server may respond
respond with error details which will be listed after
such an error message. Examples:</p>
<ul class="simple">
<li><p>Invalid scope defined as Default Scope in the data source
OAuth configuration;</p></li>
<li><p>Invalid scope defined as Refresh Scope in the data source
OAuth configuration;</p></li>
<li><p>A Snowflake role is specified in the connection URI and does
not map to an allowed scope on the authorization server;</p></li>
<li><p>The authorization step is canceled by some UI control on an
authorization, authentication, or consent screen;</p></li>
<li><p>The authorization step is canceled due to an authentication
failure.</p></li>
</ul>
<p>Check the OAuth configuration in Alation and ensure that you
are passing the correct property values.</p>
</td>
</tr>
<tr class="row-even"><td><p>Token request failed following successful
authorization.</p></td>
<td><p>In some cases after successful authorization, the request
for tokens can fail. This message will be followed by further
details and troubleshooting tips, for example:</p>
<ul class="simple">
<li><p>Please check that the PKCE, client secret, and
other OAuth settings for the data source are correct</p></li>
<li><p>Please check the authorization server token
request endpoint and other OAuth settings for
the data source</p></li>
<li><p>Please check the OAuth settings for the data source</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>There was a problem extracting username
information following successful authorization
and token retrieval. Please check the OAuth
settings for the data source.</p></td>
<td><p>Username extraction failure. After a successful authorization
and subsequent token request, Alation attempts to extract
username information from the authorization server response.
If this fails, this error is issued. Possible causes:</p>
<ul>
<li><p>The OAuth configuration specifies that the username should
be extracted as a JWT claim and:</p>
<blockquote>
<div><ul class="simple">
<li><p>the access token can not be decoded as a JWT;</p></li>
<li><p>no JWT claim is specified in the OAuth configuration;</p></li>
<li><p>the specified claim does not exist in the token’s
claim set;</p></li>
</ul>
</div></blockquote>
</li>
<li><p>The OAuth configuration specifies that the username should
not be extracted as a JWT claim and:</p>
<blockquote>
<div><ul class="simple">
<li><p>no username field is specified in the OAuth config;</p></li>
<li><p>the specified field does not exist in the response
returned from the authorization server upon token
request.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
</section>
<section id="post-authorization-errors">
<h3>Post-Authorization Errors<a class="headerlink" href="#post-authorization-errors" title="Permalink to this headline">¶</a></h3>
<p>In some cases, authorization completes successfully and a connection is attempted but an error immediately results.
These errors may be caused by an issue with:</p>
<blockquote>
<div><ul>
<li><p>Snowflake configuration</p></li>
<li><p>Snowflake access controls</p></li>
<li><p>Some incompatibility to:</p>
<blockquote>
<div><ul class="simple">
<li><p>assigned scopes and policies within the authorization server or</p></li>
<li><p>assigned scopes specified in the Alation configuration.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
<p>These errors will be shown when a connection is made during query execution but will not necessarily be shown when testing authorization at the time of configuring connections for the other features (query scheduling, dynamic profiling, and others). Instead, a generic error will be shown: <strong>Error verifying credentials. Please check your username and password.</strong> A more specific error may be shown when the connection is established later; for instance, if a scheduled query fails due to one of these errors, the notification email will contain the details.</p>
<p>Some examples of the more specific errors and causes are below.</p>
<table class="longtable colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Error</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>No default role has been assigned to the user,
contact a local system administrator to assign
a default role and retry.</p></td>
<td><p>Displayed if there is no default role assigned to the user
in Snowflake and none is specified in the connection URI.</p></td>
</tr>
<tr class="row-odd"><td><p>Role &lt;role_name&gt; specified in the connect
string is not granted to this user.
Contact your local system administrator,
or attempt to login with another role,
e.g. PUBLIC.</p></td>
<td><p>Displayed if the role is not accessible to the user and this
role is specified in the connection URI and is authorized
either explicitly in the scope or via SESSION:ROLE-ANY scope.</p></td>
</tr>
<tr class="row-even"><td><p>The role requested in the connection or the
default role if none was requested in the
connection (‘SYSADMIN’) is not listed in the
Access Token or was filtered. Please specify
another role, or contact your OAuth
Authorization server administrator.</p></td>
<td><p>Displayed if either:</p>
<ul class="simple">
<li><p>the role is assigned as the default role to a user but this
role is not authorized because it is not specified in the
URI or in the Default Scope;</p></li>
<li><p>the role is specified in the connection URI but the user
does not have access to that role.</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>User’s configured default role ‘SYSADMIN’ is
not granted to this user. Contact your local
system administrator, or attempt to login
using a CLI client with a connect string
selecting another role, e.g. PUBLIC.</p></td>
<td><p>Displayed if the role is not accessible to the user in
Snowflake but this role is authorized either via Default Scope
by Alation or a role-related scope on the authorization
server.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="other-errors">
<h3>Other Errors<a class="headerlink" href="#other-errors" title="Permalink to this headline">¶</a></h3>
<p>The following errors require troubleshooting beyond configuration changes.</p>
<section id="missing-code-verifier">
<h4>Missing Code Verifier<a class="headerlink" href="#missing-code-verifier" title="Permalink to this headline">¶</a></h4>
<p>If Alation is unable to retrieve the code verifier it cached prior to authorization redirect when PKCE is enabled when it is needed for token request, an error reading <strong>A PKCE code verifier for the token request could not be found</strong> will be issued.</p>
</section>
<section id="unknown-authorization-failure">
<h4>Unknown Authorization Failure<a class="headerlink" href="#unknown-authorization-failure" title="Permalink to this headline">¶</a></h4>
<p>If at any time during the authorization redirect flow an unexpected, unclassifiable error occurs then one of two errors may be shown:</p>
<blockquote>
<div><ul class="simple">
<li><p>if the error occurs in preparation for the redirect to the authorization server: <strong>There was a problem preparing redirection to the authorization server</strong></p></li>
<li><p>if the error occurs following successful authorization: <strong>Token request failed following successful authorization</strong></p></li>
</ul>
</div></blockquote>
</section>
<section id="connection-errors">
<h4>Connection Errors<a class="headerlink" href="#connection-errors" title="Permalink to this headline">¶</a></h4>
<p>When there is a problem reaching Alation’s database connector component: <strong>Could not connect to database</strong>
When the user’s Alation log-in has expired: <strong>You have been logged out of Alation. Please refresh and try again</strong></p>
</section>
<section id="oauth-related">
<h4>OAuth-Related<a class="headerlink" href="#oauth-related" title="Permalink to this headline">¶</a></h4>
<p>The following errors may be issued apart from authorization when a database connection is attempted when pressing “Connect” on the Connection dialog:</p>
<ul class="simple">
<li><p>OAuth access token not found. Authorization may not have been performed or has failed to complete successfully.</p></li>
<li><p>OAuth access token expired and refresh failed.</p></li>
<li><p>OAuth access token unavailable or expired while refresh token is either unavailable or expired. Either re-authorization is required or prior authorization attempt failed.</p></li>
</ul>
</section>
</section>
</section>
<section id="logs">
<h2>Logs<a class="headerlink" href="#logs" title="Permalink to this headline">¶</a></h2>
<p>The log entries for OAuth authorization are to be found in <strong>/opt/alation/site/logs/uwsgi.log</strong> (path inside the Alation shell).</p>
</section>
</section>


           </div>
          </div>
          <footer>

  
<div class="navigation-bar">

    <div class="navigation navigation--prev">
        
        <a class="navigation__link" href="Snowflake.html">
            <button class="navigation__button">
                <i class="icon icon-left"></i>
            </button>
            <div class="navigation__title">
                <span class="heading">Previous</span> <br />Snowflake
            </div>
        </a>
        
    </div>

    <div class="navigation navigation--next">
        
        <a class="navigation__link" title="Accesskey Alt(+Shift)+p" accesskey="p" href="SQLServer.html">
            <div class="navigation__title">
                <span class="heading">Next</span> <br />SQL Server
            </div>
            <button class="navigation__button" title="Accesskey Alt(+Shift)+n" accesskey="n">
                <i class="icon icon-right"></i>
            </button>
        </a>
        
    </div>

</div>


</footer>

        </div>
      </div>

    </section>

    <div class="wy-nav-side wy-nav-secondary">
      <div class="wy-side-scroll">
        <div class="wy-side-scroll__content">
          <div class="wy-menu-secondary">
              <div class="comments">
    <a href="mailto:no-reply-docs-feedback@alation.com?subject=Documentation Feedback on datasources/AddDataSources/SnowflakeSSO&body=Alation%20welcomes%20your%20comments%20on%20typos,%20content%20accuracy%20and%20completeness,%20and%20whether%20you%20found%20this%20page%20helpful.%20You%20will%20not%20receive%20a%20reply%20to%20this%20email.">
        <i class="icon icon-envelope" aria-hidden="true"></i>Request docs changes
    </a>
    <a href="#open-modal-pdf">
        <i class="icon icon-pdf" aria-hidden="true"></i>Download PDF
    </a>
</div>
              
                <p class="wy-menu-secondary-header">On this page</p>
                <ul>
<li><a class="reference internal" href="#">Snowflake OAuth For Compose</a><ul>
<li><a class="reference internal" href="#snowflake-service-account">Snowflake Service Account</a></li>
<li><a class="reference internal" href="#no-enforcement-of-oauth">No Enforcement of OAuth</a></li>
<li><a class="reference internal" href="#snowflake-built-in-oauth">Snowflake Built-in OAuth</a><ul>
<li><a class="reference internal" href="#step-1-create-a-snowflake-security-integration-for-alation">STEP 1: Create a Snowflake Security Integration for Alation</a><ul>
<li><a class="reference internal" href="#minimal-security-integration">Minimal Security Integration</a></li>
<li><a class="reference internal" href="#extended-integration">Extended Integration</a><ul>
<li><a class="reference internal" href="#refresh-tokens">Refresh Tokens</a></li>
<li><a class="reference internal" href="#pkce">PKCE</a></li>
<li><a class="reference internal" href="#tls">TLS</a></li>
<li><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#snowflake-external-oauth">Snowflake External OAuth</a><ul>
<li><a class="reference internal" href="#snowflake-users">Snowflake Users</a></li>
</ul>
</li>
<li><a class="reference internal" href="#enable-oauth-in-alation">Enable OAuth in Alation</a><ul>
<li><a class="reference internal" href="#edit-the-default-compose-connection">Edit the Default Compose Connection</a></li>
<li><a class="reference internal" href="#oauth-parameters">OAuth Parameters</a></li>
<li><a class="reference internal" href="#configuration-for-snowflake-built-in-oauth">Configuration For Snowflake Built-In OAuth</a></li>
<li><a class="reference internal" href="#configuration-for-external-snowflake-oauth">Configuration for External Snowflake OAuth</a></li>
</ul>
</li>
<li><a class="reference internal" href="#role-switching">Role Switching</a><ul>
<li><a class="reference internal" href="#using-case-sensitive-roles-or-roles-with-special-characters">Using Case-Sensitive Roles or Roles with Special Characters</a><ul>
<li><a class="reference internal" href="#id1">External OAuth</a></li>
<li><a class="reference internal" href="#built-in-snowflake-oauth">Built-in Snowflake OAuth</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#connect-in-compose">Connect in Compose</a><ul>
<li><a class="reference internal" href="#oauth-connection-uri">OAuth Connection URI</a></li>
<li><a class="reference internal" href="#specify-a-role-for-connection">Specify a Role for Connection</a></li>
</ul>
</li>
<li><a class="reference internal" href="#example-configuration-external-oauth-with-okta">Example Configuration: External OAuth with Okta</a><ul>
<li><a class="reference internal" href="#okta-client-application">Okta Client Application</a></li>
<li><a class="reference internal" href="#okta-authorization-server-configuration">Okta Authorization Server Configuration</a></li>
<li><a class="reference internal" href="#configuration-in-alation">Configuration in Alation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#authorization-flow-in-compose">Authorization Flow in Compose</a></li>
<li><a class="reference internal" href="#authorization-flow-for-scheduling-queries">Authorization Flow for Scheduling Queries</a></li>
<li><a class="reference internal" href="#authorization-error-messages">Authorization Error Messages</a><ul>
<li><a class="reference internal" href="#authorization-errors">Authorization Errors</a></li>
<li><a class="reference internal" href="#post-authorization-errors">Post-Authorization Errors</a></li>
<li><a class="reference internal" href="#other-errors">Other Errors</a><ul>
<li><a class="reference internal" href="#missing-code-verifier">Missing Code Verifier</a></li>
<li><a class="reference internal" href="#unknown-authorization-failure">Unknown Authorization Failure</a></li>
<li><a class="reference internal" href="#connection-errors">Connection Errors</a></li>
<li><a class="reference internal" href="#oauth-related">OAuth-Related</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#logs">Logs</a></li>
</ul>
</li>
</ul>

              
            </div>
          </div>
      </div>
    </div>

  </div>

  
  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->

  
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/clipboard.min.js"></script>
      <script type="text/javascript" src="../../_static/copybutton.js"></script>
      <script type="text/javascript" src="../../_static/js/rtd_sphinx_search.min.js"></script>
  
  <script type="text/javascript" src="../../_static/searchtools.js"></script> <script type="text/javascript" id="idPiwikScriptPlaceholder"></script><script type="text/javascript" src="../../_static/js/main.bundle.js"></script>
  <script type="text/javascript" src="../../_static/js/runtime.bundle.js"></script>

  
  

  
    <div id="open-modal-pdf" class="modal-window">
<div>
  <a href="#" title="Close" class="modal-close">Close</a>
  <h4>Alation Documentation PDF</h4>
  <p>This PDF contains all our documentation and is more than <b>120 MB</b> in size. We recommend using an ethernet or Wi-Fi connection for downloading.</p>
  <br>
  <div class="modal-buttons">
    <a href="https://pdf-docs.alation.com/AlationUserDocs.pdf" class="btn-cta btn-cta--primary" target="_blank">
      Download PDF
    </a>
    <a href="#" title="Close" class="btn-cta">Cancel</a>
  </div>
</div>
  

</body>
</html>
<!--3.6.17-->