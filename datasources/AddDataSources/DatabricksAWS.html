
<!DOCTYPE html>
<html lang="" >
<head>
  <meta charset="utf-8"/>
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="book-version"      content=""/>
  <meta name="book-release"      content=""/>
  <meta name="docsearch:name"    content="Alation User Guide" />
  <meta name="docsearch:version" content="" />
  <meta name="docsearch:package_type" content="" />
	<meta name="robots" content="noindex" />

  
  <title>Databricks on AWS &mdash; Alation User Guide</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  

  
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/main.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx_collapse.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/rtd_sphinx_search.min.css" type="text/css" />
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="Alation User Guide" href="#"/>
        <link rel="up" title="Adding Data Sources" href="index.html"/>
        <link rel="next" title="DB2 LUW" href="DB2LUW.html"/>
        <link rel="prev" title="Cassandra" href="Cassandra.html"/>

	

	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-67846571-1"></script>
	<script>
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());

	gtag('config', 'UA-67846571-1');
	</script>

	<!-- Global site tag (gtag.js) - Google Analytics -->
	<!-- Second Google Analytics tag to assist mapping with mattermost.com visits --> 
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-120238482-1"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  gtag('config', 'UA-120238482-1');
	</script>


</head>

<body class="wy-body-for-nav" role="document">

  <header>
    <div class="header__container wy-max-content-width">
        <a href="/" class="header__logo">
            <img width="176" src="../../_static/img/logo-alation.svg" alt="Alation" />
        </a>
        <ul class="header__links">
            <li><a href="https://help.alation.com/s/">Alation Help Center</a></li>
        </ul>
    </div>
</header>

  <div class="wy-grid-for-nav wy-max-content-width">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-scroll__content">
          <div class="wy-side-nav-search">
            

            <ul class="sidebartop">
              <li class="nolink search"><div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search this project" aria-label="Search this project" id="searchinput" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
</li>

            </ul>

            
          </div>

          <div class="wy-menu wy-sidebar wy-sidebar--hidden" data-spy="affix" role="navigation" aria-label="main navigation">
            
              
              
              
                  <p class="caption" role="heading"><span class="caption-text">Welcome to Alation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/About/index.html">About Alation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/CloudAndOnPrem/index.html">Alation Cloud and On-Premise</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/QuickStart/index.html">Quick Start Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/UserProfileandPreferences/index.html">User Profile and Preferences</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/CatalogBasics/index.html">Catalog Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/Conversations/index.html">Conversations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/Domains/index.html">Domains</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/BestPractices/index.html">Best Practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/Glossary/index.html">Alation Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alation Cloud Service</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../cloud/StatusPage/index.html">Status Page</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cloud/CloudOverview/index.html">Cloud Service Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cloud/CloudConfiguration/index.html">Configuration for Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cloud/AlationAgent/index.html">Alation Agent</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alation Integration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../integration/AlationAnywhere/index.html">Alation Anywhere</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../integration/AlationConnectedSheets/index.html">Alation Connected Sheets</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Installation &amp; Configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/ServerInstallation/index.html">Install Alation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/HighAvailability/index.html">High Availability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/Runbook/index.html">Runbook for Administrators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/Update/index.html">Update Alation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/BackupandRestore/index.html">Back Up and Restore</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/LineageV2/index.html">Lineage V2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/LineageV3/index.html">Lineage V3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/AlationAnalyticsV2/index.html">Alation Analytics V2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/AlationContainerService/index.html">Alation Container Service</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Sources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../sources/CatalogSources/index.html">Catalog Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sources/VirtualDataSources/index.html">Virtual Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sources/Lineage/index.html">Lineage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sources/APIResources/index.html">API Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sources/WorkwithCatalogData/index.html">Working with Catalog Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sources/OpenConnectorFramework/index.html">Open Connector Framework</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Sources</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../DSConfiguration/index.html">Data Source Configuration</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Adding Data Sources</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="AWSGluewithoutHive.html">AWS Glue without Hive</a></li>
<li class="toctree-l2"><a class="reference internal" href="AzureDataWarehouse.html">Azure Data Warehouse</a></li>
<li class="toctree-l2"><a class="reference internal" href="Cassandra.html">Cassandra</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Databricks on AWS</a></li>
<li class="toctree-l2"><a class="reference internal" href="DB2LUW.html">DB2 LUW</a></li>
<li class="toctree-l2"><a class="reference internal" href="Greenplum.html">Greenplum</a></li>
<li class="toctree-l2"><a class="reference internal" href="Impala.html">Impala</a></li>
<li class="toctree-l2"><a class="reference internal" href="MongoDB.html">MongoDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="MemSQL.html">MemSQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="MySQL.html">MySQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="Netezza.html">Netezza</a></li>
<li class="toctree-l2"><a class="reference internal" href="Oracle.html">Oracle</a></li>
<li class="toctree-l2"><a class="reference internal" href="PostgreSQL.html">PostgreSQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="PrestoOnHive.html">Presto on Hive</a></li>
<li class="toctree-l2"><a class="reference internal" href="Redshift.html">Amazon Redshift</a></li>
<li class="toctree-l2"><a class="reference internal" href="Salesforce.html">Salesforce</a></li>
<li class="toctree-l2"><a class="reference internal" href="SAPHANA.html">SAP Hana</a></li>
<li class="toctree-l2"><a class="reference internal" href="SAS.html">SAS</a></li>
<li class="toctree-l2"><a class="reference internal" href="Snowflake.html">Snowflake</a></li>
<li class="toctree-l2"><a class="reference internal" href="SnowflakeSSO.html">Snowflake OAuth For Compose</a></li>
<li class="toctree-l2"><a class="reference internal" href="SQLServer.html">SQL Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="SybaseIQ.html">Sybase IQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="SybaseASE.html">Sybase Adaptive Server Enterprise (ASE)</a></li>
<li class="toctree-l2"><a class="reference internal" href="Teradata.html">Teradata</a></li>
<li class="toctree-l2"><a class="reference internal" href="Vertica.html">Vertica</a></li>
<li class="toctree-l2"><a class="reference internal" href="KerberosConfiguration.html">Kerberos Configuration (General)</a></li>
<li class="toctree-l2"><a class="reference internal" href="ConfigureAlationDB.html">Configure Alation DB</a></li>
<li class="toctree-l2"><a class="reference internal" href="Appendix.html">Appendix</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ComposeSSOAWSDataSources/index.html">Compose SSO for Amazon Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ComposeSSOAzureDataSources/index.html">Compose SSO for Azure Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AuthenticationForExtraction/index.html">Authentication for Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CustomDB/index.html">Custom DB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GBQ/index.html">Google BigQuery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Hive/index.html">Hive</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">BI Sources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../bisources/AddBISources/index.html">Add BI Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bisources/AddTableauServer/index.html">Add Tableau Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bisources/WorkwithBISources/index.html">Working with BI Sources</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">File System Sources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/FileSystems/index.html">Add File Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/VirtualFileSystems/index.html">Virtual File Systems</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alation for Analysts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../analyst/UserAuthenticationForDataSources/index.html">User Authentication for Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analyst/ShareAndAccessQueries/index.html">Share and Access Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analyst/WriteQueries/index.html">Write Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analyst/DevelopQueries/index.html">Develop Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analyst/WorkwithQueryResults/index.html">Work with Query Results</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alation for Data Stewards</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../steward/GovernanceApp/index.html">Governance App</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/PolicyCenter/index.html">Policy Center</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/Workflow/index.html">Workflow Center</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/GovernanceDashboard/index.html">Governance Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/StewardshipWorkbench/index.html">Stewardship Workbench</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/AnalyticsStewardship/index.html">Analytics Stewardship</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/Glossary/index.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/ArticlesAndTags/index.html">Articles and Tags</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/ArticleGroups/index.html">Article Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/DataCatalogCustomization/index.html">Customize Your Data Catalog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/DataDocumentation/index.html">Data Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/AutoTitlingandLexicon/index.html">Auto-titling and Lexicon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/SnowflakeTags/index.html">Snowflake Tags</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alation for Server Administrators</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../admins/CustomizableHomePage/index.html">Customizable Homepage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/AdminSettings/index.html">Administrator Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/AdditionalConfiguration/index.html">Additional Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/RunbookForAdministrators/index.html">Runbook for Administrators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/AlationAPIs/index.html">Alation APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/How-tos/index.html">How-tos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/Troubleshooting/index.html">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Release Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../releases/releasenotes/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/supportmatrices/index.html">Support Matrices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/endofsupport/index.html">End Of Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/snowflakeclladdon/index.html">Snowflake Parser Add-On</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/fieldnotices/index.html">Important Notices and Security Alerts</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Archived Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../archive/About/index.html">About the Documentation Archive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../archive/AdminConfig/index.html">Administration and Update Archive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../archive/ReleaseNotes/index.html">Release Notes Archive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../archive/Usage/index.html">Usage and Customization Archive</a></li>
</ul>

              
            
          </div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="wy-nav-top-icon"></i>
        <a href="../../index.html">Alation User Guide</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">

          <div role="navigation" aria-label="breadcrumbs" class="breadcrumbs">
    <a href="../../index.html">Docs</a>
    <span class="separator">&gt;</span>
    <a href="index.html">Adding Data Sources</a>
    <span class="separator">&gt;</span>
    <span>Databricks on AWS</span>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody" class="toBeIndexed">
            
  <section id="databricks-on-aws">
<h1>Databricks on AWS<a class="headerlink" href="#databricks-on-aws" title="Permalink to this headline">¶</a></h1>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Starting <strong>August 30, 2023</strong>, we will remove the ability to create new data sources using the Databricks on AWS Native Connector. Support for the Databricks on AWS Native Connector will cease on <strong>December 1, 2023</strong>, as set out in Alation’s <a class="reference external" href="https://www.alation.com/tscs/support/">Support Policy</a>. See the <a class="reference external" href="https://community.alation.com/communityhubmicrosite/blogs/diby-malakar/2023/07/12/transition-from-native-to-ocf-connectors">Transition from Native to OCF Connectors</a> announcement in Alation Community (requires login to Community).</p>
</div>
<p><em>Available from version V R3 (5.6.0)</em></p>
<p>Databricks on AWS can be added as a data source of the type <strong>Databricks</strong> using the built-in (native) drivers for Databricks.</p>
<section id="required-information">
<h2>Required Information<a class="headerlink" href="#required-information" title="Permalink to this headline">¶</a></h2>
<section id="jdbc-uri">
<h3>JDBC URI<a class="headerlink" href="#jdbc-uri" title="Permalink to this headline">¶</a></h3>
<p>Depending on the Alation version, the driver and the URI format for the Databricks data source differ. The compatible driver versions can be found in the Support Matrix for your release: <a class="reference internal" href="../../releases/supportmatrices/index.html"><span class="doc">Support Matrices</span></a>.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-0-0-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-0-0-0" name="0-0" role="tab" tabindex="0">Version 2020.4.x and newer</button><button aria-controls="panel-0-0-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-1" name="0-1" role="tab" tabindex="-1">Versions before 2020.4</button></div><div aria-labelledby="tab-0-0-0" class="sphinx-tabs-panel" id="panel-0-0-0" name="0-0" role="tabpanel" tabindex="0"><p>Use the following URI format:</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>spark://&lt;hostname&gt;:443/default<span class="p">;</span><span class="nv">transportMode</span><span class="o">=</span>http<span class="p">;</span><span class="nv">ssl</span><span class="o">=</span><span class="m">1</span><span class="p">;</span><span class="nv">httpPath</span><span class="o">=</span>&lt;databricks_http_path_prefix&gt;/&lt;databricks_cluster_id&gt;<span class="p">;</span><span class="nv">AuthMech</span><span class="o">=</span><span class="m">3</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>Example</strong></p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>spark://dbc-65ebe48d-8ecb.cloud.databricks.com:443/default<span class="p">;</span><span class="nv">transportMode</span><span class="o">=</span>http<span class="p">;</span><span class="nv">ssl</span><span class="o">=</span><span class="m">1</span><span class="p">;</span><span class="nv">httpPath</span><span class="o">=</span>sql/protocolv1/o/6625748827900751/0520-195244-whizz481<span class="p">;</span><span class="nv">AuthMech</span><span class="o">=</span><span class="m">3</span><span class="p">;</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-0-0-1" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-1" name="0-1" role="tabpanel" tabindex="0"><p>Use the following format:</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>hive2://hostname:443/default<span class="p">;</span><span class="nv">transportMode</span><span class="o">=</span>http<span class="p">;</span><span class="nv">ssl</span><span class="o">=</span>true<span class="p">;</span><span class="nv">httpPath</span><span class="o">=</span>sql/protocolv1/o/123/cluster
</pre></div>
</div>
</div></div>
</section>
<section id="service-account">
<h3>Service Account<a class="headerlink" href="#service-account" title="Permalink to this headline">¶</a></h3>
<p>The Alation service account requires privileges to access the Databricks cluster for metadata extraction and profiling. You can use the following types of authentication:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>Token-based authentication</strong>: For information on how to generate a unique token and use it for authentication, refer to <a class="reference external" href="https://docs.databricks.com/api/latest/authentication.html">this page</a> in Databricks documentation.</p></li>
<li><p>Basic authentication with a <strong>username and password</strong></p></li>
</ul>
</div></blockquote>
<section id="permissions-for-metadata-extraction-and-profiling">
<h4>Permissions for Metadata Extraction and Profiling<a class="headerlink" href="#permissions-for-metadata-extraction-and-profiling" title="Permalink to this headline">¶</a></h4>
<p>The service account must have the following permissions to perform MDE and profiling:</p>
<blockquote>
<div><ul class="simple">
<li><p>Workspace access — Refer to <a class="reference external" href="https://docs.databricks.com/administration-guide/users-groups/users.html#manage-user-entitlements">Manage users</a>.</p></li>
<li><p>Cluster level access — Refer to <a class="reference external" href="https://docs.databricks.com/security/access-control/cluster-acl.html">Cluster access control</a>.</p></li>
</ul>
</div></blockquote>
<p>By default, all cluster users have access to all data stored in a cluster’s managed tables unless table access control is enabled for that cluster. The table access control option is only available for high-concurrency clusters. Refer to <a class="reference external" href="https://docs.databricks.com/security/access-control/table-acls/table-acl.html#create-a-cluster-enabled-for-table-access-control">Table Access Control</a> for more information</p>
<p>If the <strong>Table Access Control</strong> option is enabled on the cluster:</p>
<blockquote>
<div><ul>
<li><p>Grant the SELECT privilege on all schemas and all their tables and views in a catalog.</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>GRANT<span class="w"> </span>USAGE<span class="w"> </span>ON<span class="w"> </span>CATALOG<span class="w"> </span>&lt;catalog-name&gt;<span class="w"> </span>TO<span class="w"> </span><span class="sb">`</span>&lt;user&gt;@&lt;domain-name&gt;<span class="sb">`</span><span class="p">;</span>
GRANT<span class="w"> </span>SELECT<span class="w"> </span>ON<span class="w"> </span>CATALOG<span class="w"> </span>&lt;catalog-name&gt;<span class="w"> </span>TO<span class="w"> </span><span class="sb">`</span>&lt;user&gt;@&lt;domain-name&gt;<span class="sb">`</span><span class="p">;</span>
</pre></div>
</div>
</li>
<li><p>Grant the SELECT privilege on a specific schema and all its tables and views.</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>GRANT<span class="w"> </span>USAGE<span class="w"> </span>ON<span class="w"> </span>SCHEMA<span class="w"> </span>&lt;schema-name&gt;<span class="w"> </span>TO<span class="w"> </span><span class="sb">`</span>&lt;user&gt;@&lt;domain-name&gt;<span class="sb">`</span><span class="p">;</span>
GRANT<span class="w"> </span>SELECT<span class="w"> </span>ON<span class="w"> </span>SCHEMA<span class="w"> </span>&lt;schema-name&gt;<span class="w"> </span>TO<span class="w"> </span><span class="sb">`</span>&lt;user&gt;@&lt;domain-name&gt;<span class="sb">`</span><span class="p">;</span>
</pre></div>
</div>
</li>
<li><p>Grant the SELECT privilege on specific tables and views in a schema.</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>GRANT<span class="w"> </span>USAGE<span class="w"> </span>ON<span class="w"> </span>SCHEMA<span class="w"> </span>&lt;schema-name&gt;<span class="w"> </span>TO<span class="w"> </span><span class="sb">`</span>&lt;user&gt;@&lt;domain-name&gt;<span class="sb">`</span><span class="p">;</span>
GRANT<span class="w"> </span>SELECT<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>&lt;schema-name&gt;.&lt;table-name&gt;<span class="w"> </span>TO<span class="w"> </span><span class="sb">`</span>&lt;user&gt;@&lt;domain-name&gt;<span class="sb">`</span><span class="p">;</span>
GRANT<span class="w"> </span>SELECT<span class="w"> </span>ON<span class="w"> </span>VIEW<span class="w"> </span>&lt;schema-name&gt;.&lt;view-name&gt;<span class="w"> </span>TO<span class="w"> </span><span class="sb">`</span>&lt;user&gt;@&lt;domain-name&gt;<span class="sb">`</span><span class="p">;</span>
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
<p>Refer to <a class="reference external" href="https://docs.databricks.com/security/access-control/table-acls/object-privileges.html#data-governance-model">Data object privileges</a> for more information.</p>
</section>
</section>
<section id="query-log-ingestion">
<h3>Query Log Ingestion<a class="headerlink" href="#query-log-ingestion" title="Permalink to this headline">¶</a></h3>
<p>The Alation service account requires an AWS IAM role with the <strong>read</strong> permission for the Amazon S3 bucket that stores query logs.</p>
<p>You will need to run a log setup script on the Databricks cluster before configuring query log ingestion (QLI) in Alation. Additional information is available below.</p>
</section>
</section>
<section id="query-log-ingestion-setup">
<h2>Query Log Ingestion Setup<a class="headerlink" href="#query-log-ingestion-setup" title="Permalink to this headline">¶</a></h2>
<p>Configure an AWS IAM role to save the query logs in Amazon S3. For additional information on how to set up secure access to Amazon S3 buckets using an AWS IAM role, see <a class="reference external" href="https://docs.databricks.com/administration-guide/cloud-configurations/aws/iam-roles.html">this Databricks topic</a>.</p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>The logs should be pointed to an S3 bucket other than the Databricks root S3 bucket. Do not use the root directory. The Databricks root S3 bucket operates like Alation’s chroot: it prevents outside tools from reading or modifying the files.</p>
</div>
</div></blockquote>
<p>You can perform QLI either using a Python init script or a Scala script. In Alation version 2021.2 and later versions, we recommend using the Python init script as this approach generates smaller log files and the admin does not need to re-run the script after restarting the cluster.</p>
<section id="python-init-script">
<h3>Python Init Script<a class="headerlink" href="#python-init-script" title="Permalink to this headline">¶</a></h3>
<p><em>Applies from version 2021.2</em></p>
<p>This is the recommended option.</p>
<p>Perform the steps in this sections to enable QLI using a Python init script:</p>
<ol class="arabic">
<li><p>In the Databricks settings portal, ensure that the <strong>Cluster Log Path</strong> and <strong>Destination</strong> are set under the <strong>Logging tab</strong>. Do not leave the Destination path as <strong>None</strong>.</p>
<blockquote>
<div><a class="reference internal image-reference" href="../../_images/DS_DatabricksAzure03.png"><img alt="../../_images/DS_DatabricksAzure03.png" src="../../_images/DS_DatabricksAzure03.png" style="width: 400px;" /></a>
<p>For more information on how to set the logging path in DBFS, see <a class="reference external" href="https://docs.databricks.com/clusters/clusters-manage.html#view-cluster-logs">Databricks documentation</a>.</p>
<p>You can choose to mount external storage onto the DBFS for log storage. For more information on the mount process, see:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference external" href="https://docs.databricks.com/data/data-sources/aws/amazon-s3.html">Amazon S3</a></p></li>
<li><p><a class="reference external" href="https://docs.databricks.com/spark/latest/data-sources/azure/azure-storage.html#mount-azure-blob-storage-containers-with-dbfs">Azure Blob</a></p></li>
<li><p><a class="reference external" href="https://docs.databricks.com/data/data-sources/azure/azure-datalake-gen2.html">ADLS Gen 2</a>.</p></li>
</ul>
</div></blockquote>
</div></blockquote>
</li>
<li><p>Create a <a class="reference external" href="https://docs.databricks.com/notebooks/notebooks-manage.html#create-a-notebook">Python Notebook</a> and run the script given below on your Databricks cluster using this Python notebook. This script creates the <strong>scripts</strong> directory to store the QLI script.</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>dbutils.fs.mkdirs<span class="o">(</span><span class="s2">&quot;dbfs:/databricks/scripts/&quot;</span><span class="o">)</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>In the same notebook, run the next script to create the file with the init script in the <strong>scripts</strong> directory.</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>dbutils.fs.put<span class="o">(</span><span class="s2">&quot;/databricks/scripts/init.sh&quot;</span>,<span class="s2">&quot;&quot;&quot;</span>
<span class="s2">#!/bin/bash</span>
<span class="s2">echo &quot;</span>Executing<span class="w"> </span>on<span class="w"> </span>Driver:<span class="w"> </span><span class="nv">$DB_IS_DRIVER</span><span class="s2">&quot;</span>
<span class="s2">if [[ </span><span class="nv">$DB_IS_DRIVER</span><span class="s2"> = &quot;</span>TRUE<span class="s2">&quot; ]]; then</span>
<span class="s2">LOG4J_PATH=&quot;</span>/home/ubuntu/databricks/spark/dbconf/log4j/driver/log4j.properties<span class="s2">&quot;</span>
<span class="s2">else</span>
<span class="s2">LOG4J_PATH=&quot;</span>/home/ubuntu/databricks/spark/dbconf/log4j/executor/log4j.properties<span class="s2">&quot;</span>
<span class="s2">fi</span>
<span class="s2">echo &quot;</span>Adjusting<span class="w"> </span>log4j.properties<span class="w"> </span>here:<span class="w"> </span><span class="si">${</span><span class="nv">LOG4J_PATH</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="s2">echo &quot;</span>log4j.logger.org.apache.spark.sql.execution.SparkSqlParser<span class="o">=</span>DEBUG<span class="s2">&quot; &gt;&gt; </span><span class="si">${</span><span class="nv">LOG4J_PATH</span><span class="si">}</span>
<span class="s2">echo &quot;</span>log4j.appender.publicFile.layout.ConversionPattern<span class="o">=</span>%d<span class="o">{</span>yyyy-MM-dd<span class="w"> </span>HH:mm:ss.SS<span class="o">}</span><span class="w"> </span><span class="o">[</span>%t<span class="o">]</span><span class="w"> </span>%p<span class="w"> </span>%c<span class="o">{</span><span class="m">1</span><span class="o">}</span>:<span class="w"> </span>%m%n<span class="s2">&quot; &gt;&gt; </span><span class="si">${</span><span class="nv">LOG4J_PATH</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>,<span class="w"> </span>True<span class="o">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Alternatively, you can create the init script locally and copy it to the Databricks cluster using the following command:</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>dbfs<span class="w"> </span>cp<span class="w"> </span>init.sh<span class="w"> </span>dbfs:/databricks/scripts/init.sh
</pre></div>
</div>
</div>
</div></blockquote>
</li>
<li><p>Use the following command to make sure that the script was created successfully:</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>display<span class="o">(</span>dbutils.fs.ls<span class="o">(</span><span class="s2">&quot;dbfs:/databricks/scripts/init.sh&quot;</span><span class="o">))</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Use the cluster configuration page to configure the cluster to run the <strong>init</strong> script: <a class="reference external" href="https://docs.databricks.com/clusters/init-scripts.html">Add init script</a>.</p></li>
<li><p>Restart the cluster.</p></li>
</ol>
</section>
<section id="scala-script">
<h3>Scala Script<a class="headerlink" href="#scala-script" title="Permalink to this headline">¶</a></h3>
<p>Run the following script in the Databricks cluster through a Scala notebook. This script, provided by Databricks, enables debug logs having queries.</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>import<span class="w"> </span>org.apache.log4j.<span class="o">{</span>LogManager,<span class="w"> </span>Level,<span class="w"> </span>ConsoleAppender<span class="o">}</span>
import<span class="w"> </span>org.apache.commons.logging.LogFactory
import<span class="w"> </span>org.apache.log4j.PatternLayout

<span class="w">   </span>LogManager.getRootLogger<span class="o">()</span>.setLevel<span class="o">(</span>Level.DEBUG<span class="o">)</span>

<span class="w">   </span>val<span class="w"> </span><span class="nv">ca</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>LogManager.getRootLogger<span class="o">()</span>.getAppender<span class="o">(</span><span class="s2">&quot;publicFile&quot;</span><span class="o">)</span>
<span class="w">   </span>println<span class="o">(</span><span class="s2">&quot;layout &quot;</span><span class="w"> </span>+<span class="w"> </span>ca.getLayout.asInstanceOf<span class="o">[</span>PatternLayout<span class="o">]</span>.getConversionPattern<span class="o">)</span>
<span class="w">   </span>ca.setLayout<span class="o">(</span>new<span class="w"> </span>PatternLayout<span class="o">(</span><span class="s2">&quot;%d{yy/MM/dd HH:mm:ss} [%t] %p %c{1}: %m%n&quot;</span><span class="o">))</span><span class="p">;</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The above script should be run whenever the cluster is started or restarted. By default, Databricks does not enable debug level logs.</p>
</div>
</section>
</section>
<section id="configure-databricks-in-alation">
<h2>Configure Databricks in Alation<a class="headerlink" href="#configure-databricks-in-alation" title="Permalink to this headline">¶</a></h2>
<section id="service-account-credentials">
<h3>Service Account Credentials<a class="headerlink" href="#service-account-credentials" title="Permalink to this headline">¶</a></h3>
<p>If using token-based authentication, enter the token information in the <strong>Username</strong> and <strong>Password</strong> fields as follows:</p>
<blockquote>
<div><ul class="simple">
<li><p>For the Username, enter the word <strong>token</strong>.</p></li>
<li><p>For the Password, enter your token string:</p></li>
</ul>
<a class="reference internal image-reference" href="../../_images/DS_DatabricksAWS01.png"><img alt="../../_images/DS_DatabricksAWS01.png" class="align-center" src="../../_images/DS_DatabricksAWS01.png" style="width: 3.5in;" /></a>
</div></blockquote>
</section>
<section id="query-log-ingestion-configuration">
<h3>Query Log Ingestion Configuration<a class="headerlink" href="#query-log-ingestion-configuration" title="Permalink to this headline">¶</a></h3>
<p>You will see the option to enter the QLI settings in the initial setup wizard. Skip this step. You can enter the configuration information on the <strong>Query Log Ingestion</strong> tab on the data source <strong>Settings</strong> page as shown below:</p>
<blockquote>
<div><img alt="../../_images/DS_DatabricksAWS02.png" class="align-center" src="../../_images/DS_DatabricksAWS02.png" />
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The common format of the Databricks log files is <strong>log4j-yyyy-mm-dd-hh.log.gz</strong> and the current hour log or real-time will be in the <strong>log4j-active.log.</strong> format.</p>
</div>
<p>Provide the values in the fields on the <strong>Query Log Ingestion</strong> tab as described below.</p>
<section id="apache-spark-settings">
<h4>Apache Spark Settings<a class="headerlink" href="#apache-spark-settings" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><ul>
<li><p><strong>Spark Log Folder AWS S3 Path</strong></p>
<blockquote>
<div><ul>
<li><p>Path of the file starting from the S3 bucket name in the following format: <code class="docutils literal notranslate"><span class="pre">/s3_bucket_name/path_to_the_file</span></code>.</p>
<blockquote>
<div><ul class="simple">
<li><p>Example: <strong>/databricks-logging-20220420/dbc-36ad4224-mb19/0330-193314-wuadi0q9/driver</strong></p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p><strong>Spark Log File Name Prefix</strong></p>
<blockquote>
<div><ul>
<li><p>A common name prefix for the files to be extracted is <code class="docutils literal notranslate"><span class="pre">log4j-</span></code>.</p>
<blockquote>
<div><ul class="simple">
<li><p>Example: Files to be extracted usually have names like: <strong>log4j-2022-01-01-10.log.gz</strong>. Setting the prefix value to <code class="docutils literal notranslate"><span class="pre">log4j-</span></code> serves this file name format.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p>Number of Log files in directory</p>
<blockquote>
<div><ul class="simple">
<li><p>Optional parameter: if not specified, all files matching the prefix will be captured.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><strong>Log4j Time Format</strong></p>
<blockquote>
<div><ul class="simple">
<li><p>The time format is set based on the init script you are using. The value should be set to <code class="docutils literal notranslate"><span class="pre">yyyy-MM-dd</span> <span class="pre">HH:mm:ss.SS</span></code>.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><strong>Log4j Conversion Pattern</strong></p>
<blockquote>
<div><ul>
<li><p>The conversion pattern is set based on the init script you are using. The format is <code class="docutils literal notranslate"><span class="pre">TIMESTAMP</span> <span class="pre">[THREAD]</span> <span class="pre">LEVEL</span> <span class="pre">LOGGER</span> <span class="pre">MESSAGE</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The thread name for Databricks has a space. We enclose the thread name in square brackets to enable correct processing in Alation.</p>
</div>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</section>
<section id="aws-s3-settings">
<h4>AWS S3 Settings<a class="headerlink" href="#aws-s3-settings" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><ul class="simple">
<li><p><strong>AWS Access Key ID</strong></p></li>
<li><p><strong>AWS Access Key Secret</strong></p></li>
<li><p><strong>AWS Region</strong> (the default is <code class="docutils literal notranslate"><span class="pre">us-east-1</span></code>)</p></li>
<li><p><strong>Exclude log files</strong> - Provide the log file names that you want to exclude from ingestion.</p></li>
</ul>
</div></blockquote>
<p>Save the configuration and click <strong>Import</strong> to ingest the log files.</p>
</section>
</section>
</section>
<section id="migrating-from-custom-db-to-databricks">
<h2>Migrating from Custom DB to Databricks<a class="headerlink" href="#migrating-from-custom-db-to-databricks" title="Permalink to this headline">¶</a></h2>
<p>If you had previously set up a connection to Databricks using the Alation Custom DB connector, you can change the connection type to the native Databricks to be able to configure query log ingestion for this connection.</p>
<p>To change the connection, you will need the data source ID. It is visible in the URL on the data source page in the Alation UI. You will also need access to the Alation shell.</p>
<p>From your Alation host:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>/etc/init.d/alation<span class="w"> </span>shell
alation_psql
update<span class="w"> </span>rosetmeta_datasource<span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="nv">dbtype</span><span class="o">=</span><span class="s1">&#39;databricks&#39;</span><span class="w"> </span>where<span class="w"> </span><span class="nv">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>&lt;data_source_id&gt;<span class="p">;</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  
<div class="navigation-bar">

    <div class="navigation navigation--prev">
        
        <a class="navigation__link" href="Cassandra.html">
            <button class="navigation__button">
                <i class="icon icon-left"></i>
            </button>
            <div class="navigation__title">
                <span class="heading">Previous</span> <br />Cassandra
            </div>
        </a>
        
    </div>

    <div class="navigation navigation--next">
        
        <a class="navigation__link" title="Accesskey Alt(+Shift)+p" accesskey="p" href="DB2LUW.html">
            <div class="navigation__title">
                <span class="heading">Next</span> <br />DB2 LUW
            </div>
            <button class="navigation__button" title="Accesskey Alt(+Shift)+n" accesskey="n">
                <i class="icon icon-right"></i>
            </button>
        </a>
        
    </div>

</div>


</footer>

        </div>
      </div>

    </section>

    <div class="wy-nav-side wy-nav-secondary">
      <div class="wy-side-scroll">
        <div class="wy-side-scroll__content">
          <div class="wy-menu-secondary">
              <div class="comments">
    <a href="mailto:no-reply-docs-feedback@alation.com?subject=Documentation Feedback on datasources/AddDataSources/DatabricksAWS&body=Alation%20welcomes%20your%20comments%20on%20typos,%20content%20accuracy%20and%20completeness,%20and%20whether%20you%20found%20this%20page%20helpful.%20You%20will%20not%20receive%20a%20reply%20to%20this%20email.">
        <i class="icon icon-envelope" aria-hidden="true"></i>Request docs changes
    </a>
    <a href="#open-modal-pdf">
        <i class="icon icon-pdf" aria-hidden="true"></i>Download PDF
    </a>
</div>
              
                <p class="wy-menu-secondary-header">On this page</p>
                <ul>
<li><a class="reference internal" href="#">Databricks on AWS</a><ul>
<li><a class="reference internal" href="#required-information">Required Information</a><ul>
<li><a class="reference internal" href="#jdbc-uri">JDBC URI</a></li>
<li><a class="reference internal" href="#service-account">Service Account</a><ul>
<li><a class="reference internal" href="#permissions-for-metadata-extraction-and-profiling">Permissions for Metadata Extraction and Profiling</a></li>
</ul>
</li>
<li><a class="reference internal" href="#query-log-ingestion">Query Log Ingestion</a></li>
</ul>
</li>
<li><a class="reference internal" href="#query-log-ingestion-setup">Query Log Ingestion Setup</a><ul>
<li><a class="reference internal" href="#python-init-script">Python Init Script</a></li>
<li><a class="reference internal" href="#scala-script">Scala Script</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configure-databricks-in-alation">Configure Databricks in Alation</a><ul>
<li><a class="reference internal" href="#service-account-credentials">Service Account Credentials</a></li>
<li><a class="reference internal" href="#query-log-ingestion-configuration">Query Log Ingestion Configuration</a><ul>
<li><a class="reference internal" href="#apache-spark-settings">Apache Spark Settings</a></li>
<li><a class="reference internal" href="#aws-s3-settings">AWS S3 Settings</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#migrating-from-custom-db-to-databricks">Migrating from Custom DB to Databricks</a></li>
</ul>
</li>
</ul>

              
            </div>
          </div>
      </div>
    </div>

  </div>

  
  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->

  
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/clipboard.min.js"></script>
      <script type="text/javascript" src="../../_static/copybutton.js"></script>
      <script type="text/javascript" src="../../_static/tabs.js"></script>
      <script type="text/javascript" src="../../_static/js/rtd_sphinx_search.min.js"></script>
  
  <script type="text/javascript" src="../../_static/searchtools.js"></script> <script type="text/javascript" id="idPiwikScriptPlaceholder"></script><script type="text/javascript" src="../../_static/js/main.bundle.js"></script>
  <script type="text/javascript" src="../../_static/js/runtime.bundle.js"></script>

  
  

  
    <div id="open-modal-pdf" class="modal-window">
<div>
  <a href="#" title="Close" class="modal-close">Close</a>
  <h4>Alation Documentation PDF</h4>
  <p>This PDF contains all our documentation and is more than <b>120 MB</b> in size. We recommend using an ethernet or Wi-Fi connection for downloading.</p>
  <br>
  <div class="modal-buttons">
    <a href="https://pdf-docs.alation.com/AlationUserDocs.pdf" class="btn-cta btn-cta--primary" target="_blank">
      Download PDF
    </a>
    <a href="#" title="Close" class="btn-cta">Cancel</a>
  </div>
</div>
  

</body>
</html>
<!--3.6.17-->