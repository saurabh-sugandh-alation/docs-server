
<!DOCTYPE html>
<html lang="" >
<head>
  <meta charset="utf-8"/>
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="book-version"      content=""/>
  <meta name="book-release"      content=""/>
  <meta name="docsearch:name"    content="Alation User Guide" />
  <meta name="docsearch:version" content="" />
  <meta name="docsearch:package_type" content="" />
	<meta name="robots" content="noindex" />

  
  <title>SQL Server &mdash; Alation User Guide</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  

  
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/main.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx_collapse.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/rtd_sphinx_search.min.css" type="text/css" />
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="Alation User Guide" href="#"/>
        <link rel="up" title="Adding Data Sources" href="index.html"/>
        <link rel="next" title="Sybase IQ" href="SybaseIQ.html"/>
        <link rel="prev" title="Snowflake" href="Snowflake.html"/>

	

	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-67846571-1"></script>
	<script>
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());

	gtag('config', 'UA-67846571-1');
	</script>

	<!-- Global site tag (gtag.js) - Google Analytics -->
	<!-- Second Google Analytics tag to assist mapping with mattermost.com visits --> 
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-120238482-1"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  gtag('config', 'UA-120238482-1');
	</script>


</head>

<body class="wy-body-for-nav" role="document">

  <header>
    <div class="header__container wy-max-content-width">
        <a href="/" class="header__logo">
            <img width="176" src="../../_static/img/logo-alation.svg" alt="Alation" />
        </a>
        <ul class="header__links">
            <li><a href="https://help.alation.com/s/">Alation Help Center</a></li>
        </ul>
    </div>
</header>

  <div class="wy-grid-for-nav wy-max-content-width">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-scroll__content">
          <div class="wy-side-nav-search">
            

            <ul class="sidebartop">
              <li class="nolink search"><div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search this project" aria-label="Search this project" id="searchinput" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
</li>

            </ul>

            
          </div>

          <div class="wy-menu wy-sidebar wy-sidebar--hidden" data-spy="affix" role="navigation" aria-label="main navigation">
            
              
              
              
                  <p class="caption" role="heading"><span class="caption-text">Welcome to Alation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/About/index.html">About Alation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/CloudAndOnPrem/index.html">Alation Cloud and On-Premise</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/UserProfileandPreferences/index.html">User Profile and Preferences</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/CatalogBasics/index.html">Catalog Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/CatalogPages/index.html">Catalog Pages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/Conversations/index.html">Conversations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/Domains/index.html">Domains</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/BestPractices/index.html">Best Practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/Glossary/index.html">Alation Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alation Cloud Service</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../cloud/StatusPage/index.html">Status Page</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cloud/CloudOverview/index.html">Cloud Service Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cloud/CloudConfiguration/index.html">Configuration for Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cloud/AlationAgent/index.html">Alation Agent</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alation Integration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../integration/AlationAnywhere/index.html">Alation Anywhere</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../integration/AlationConnectedSheets/index.html">Alation Connected Sheets</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Installation &amp; Configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/ServerInstallation/index.html">Install Alation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/HighAvailability/index.html">High Availability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/Update/index.html">Update Alation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/BackupandRestore/index.html">Back Up and Restore</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/LineageV2/index.html">Lineage V2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/LineageV3/index.html">Lineage V3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/AlationAnalyticsV2/index.html">Alation Analytics V2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installconfig/AlationContainerService/index.html">Alation Container Service</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Sources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../sources/CatalogSources/index.html">Catalog Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sources/VirtualDataSources/index.html">Virtual Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sources/Lineage/index.html">Lineage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sources/APIResources/index.html">API Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sources/WorkwithCatalogData/index.html">Working with Catalog Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sources/OpenConnectorFramework/index.html">Open Connector Framework</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Sources</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../DSConfiguration/index.html">Data Source Configuration</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Adding Data Sources</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="AWSGluewithoutHive.html">AWS Glue without Hive</a></li>
<li class="toctree-l2"><a class="reference internal" href="AzureDataWarehouse.html">Azure Data Warehouse</a></li>
<li class="toctree-l2"><a class="reference internal" href="Cassandra.html">Cassandra</a></li>
<li class="toctree-l2"><a class="reference internal" href="DatabricksAWS.html">Databricks on AWS</a></li>
<li class="toctree-l2"><a class="reference internal" href="DB2LUW.html">DB2Â LUW</a></li>
<li class="toctree-l2"><a class="reference internal" href="Greenplum.html">Greenplum</a></li>
<li class="toctree-l2"><a class="reference internal" href="Impala.html">Impala</a></li>
<li class="toctree-l2"><a class="reference internal" href="MongoDB.html">MongoDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="MemSQL.html">MemSQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="MySQL.html">MySQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="Netezza.html">Netezza</a></li>
<li class="toctree-l2"><a class="reference internal" href="Oracle.html">Oracle</a></li>
<li class="toctree-l2"><a class="reference internal" href="PostgreSQL.html">PostgreSQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="PrestoOnHive.html">Presto on Hive</a></li>
<li class="toctree-l2"><a class="reference internal" href="Redshift.html">Amazon Redshift</a></li>
<li class="toctree-l2"><a class="reference internal" href="Salesforce.html">Salesforce</a></li>
<li class="toctree-l2"><a class="reference internal" href="SAPHANA.html">SAP Hana</a></li>
<li class="toctree-l2"><a class="reference internal" href="SAS.html">SAS</a></li>
<li class="toctree-l2"><a class="reference internal" href="Snowflake.html">Snowflake</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">SQL Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="SybaseIQ.html">Sybase IQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="SybaseASE.html">Sybase Adaptive Server Enterprise (ASE)</a></li>
<li class="toctree-l2"><a class="reference internal" href="Teradata.html">Teradata</a></li>
<li class="toctree-l2"><a class="reference internal" href="Vertica.html">Vertica</a></li>
<li class="toctree-l2"><a class="reference internal" href="KerberosConfiguration.html">Kerberos Configuration (General)</a></li>
<li class="toctree-l2"><a class="reference internal" href="ConfigureAlationDB.html">Configure Alation DB</a></li>
<li class="toctree-l2"><a class="reference internal" href="Appendix.html">Appendix</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ComposeSSOAWSDataSources/index.html">Compose SSO for Amazon Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ComposeSSOAzureDataSources/index.html">Compose SSO for Azure Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AuthenticationForExtraction/index.html">Authentication for Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CustomDB/index.html">Custom DB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GBQ/index.html">Google BigQuery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Hive/index.html">Hive</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">BI Sources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../bisources/AddBISources/index.html">Add BI Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bisources/AddTableauServer/index.html">Add Tableau Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bisources/WorkwithBISources/index.html">Working with BI Sources</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">File System Sources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/FileSystems/index.html">Add File Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/VirtualFileSystems/index.html">Virtual File Systems</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alation for Analysts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../analyst/UserAuthenticationForDataSources/index.html">User Authentication for Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analyst/ShareAndAccessQueries/index.html">Share and Access Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analyst/WriteQueries/index.html">Write Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analyst/DevelopQueries/index.html">Develop Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analyst/WorkwithQueryResults/index.html">Work with Query Results</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alation for Data Stewards</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../steward/GovernanceApp/index.html">Governance App</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/PolicyCenter/index.html">Policy Center</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/Workflow/index.html">Workflow Center</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/GovernanceDashboard/index.html">Governance Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/StewardshipWorkbench/index.html">Stewardship Workbench</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/AnalyticsStewardship/index.html">Analytics Stewardship</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/Glossary/index.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/ArticlesAndTags/index.html">Articles and Tags</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/ArticleGroups/index.html">Article Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/DataCatalogCustomization/index.html">Customize Your Data Catalog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/DataDocumentation/index.html">Data Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/AutoTitlingandLexicon/index.html">Auto-titling and Lexicon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/SnowflakeTags/index.html">Snowflake Tags</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alation for Server Administrators</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../admins/CustomizableHomePage/index.html">Customizable Homepage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/AdminSettings/index.html">Administrator Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/AdditionalConfiguration/index.html">Additional Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/RunbookForAdministrators/index.html">Runbook for Administrators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/AlationAPIs/index.html">Alation APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/How-tos/index.html">How-tos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/Troubleshooting/index.html">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Release Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../releases/releasenotes/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/supportmatrices/index.html">Support Matrices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/endofsupport/index.html">End Of Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/snowflakeclladdon/index.html">Snowflake Parser Add-On</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/fieldnotices/index.html">Important Notices and Security Alerts</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Archived Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../archive/About/index.html">About the Documentation Archive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../archive/AdminConfig/index.html">Administration and Update Archive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../archive/ReleaseNotes/index.html">Release Notes Archive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../archive/Usage/index.html">Usage and Customization Archive</a></li>
</ul>

              
            
          </div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="wy-nav-top-icon"></i>
        <a href="../../index.html">Alation User Guide</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">

          <div role="navigation" aria-label="breadcrumbs" class="breadcrumbs">
    <a href="../../index.html">Docs</a>
    <span class="separator">&gt;</span>
    <a href="index.html">Adding Data Sources</a>
    <span class="separator">&gt;</span>
    <span>SQL Server</span>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody" class="toBeIndexed">
            
  <section id="sql-server">
<h1>SQL Server<a class="headerlink" href="#sql-server" title="Permalink to this headline">Â¶</a></h1>
<section id="required-information">
<h2>Required Information<a class="headerlink" href="#required-information" title="Permalink to this headline">Â¶</a></h2>
<p>To configure SQL Server in Alation, you will need the following information:</p>
<ul>
<li><p>Hostname or IP address of your server</p></li>
<li><p>Port number</p></li>
<li><p>Database name - Optional</p></li>
<li><p>Instance name - Optional</p></li>
<li><p>SSL confirmation</p>
<blockquote>
<div><ul>
<li><p>Authentication Type confirmation (Active Directory preferred)</p>
<blockquote>
<div><ul class="simple">
<li><p>Realm (if using NTLM)</p></li>
<li><p>Server SPN (for Kerberos)</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p>Service account with privileges listed below</p></li>
<li><p>Query Log Ingestion setup: Extended events</p></li>
</ul>
</section>
<section id="preliminaries">
<h2>Preliminaries<a class="headerlink" href="#preliminaries" title="Permalink to this headline">Â¶</a></h2>
<p>Firewall Configuration:</p>
<blockquote>
<div><ul class="simple">
<li><p>Open outbound TCP port 1433 to SQL Server</p></li>
<li><p>SQL Server instances can listen on non-standard ports. If you connect Alation to a SQL Server instance, then open the appropriate outbound TCP ports from the Alation server.</p></li>
</ul>
</div></blockquote>
</section>
<section id="create-service-account">
<h2>Create Service Account<a class="headerlink" href="#create-service-account" title="Permalink to this headline">Â¶</a></h2>
<p><strong>We recommend using an Active Directory service account</strong>.Â This enables Alation to read
log files generated by Extended Events. Â A SQL
Server username/password also reads log files generated by Extended
Events.</p>
<p>Alation supports both DB based authentication and Windows
authentication. For Windows authentication, SQL-Server should be
configured for Kerberos, SQL-Server default, or instance SPNs must be
registered with the Active Directory.</p>
<p>You can verify if the SQL-Server is configured for Kerberos by running
the following command from a Windows CMD prompt. The command should be
run on a computer in the same Realm as the SQL Server:</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>setspn<span class="w"> </span>-L<span class="w"> </span><span class="o">[</span>SQL-server-hostname<span class="o">]</span>
</pre></div>
</div>
<p>Following is a sample output of <code class="docutils literal notranslate"><span class="pre">setspn</span></code> command showing the SPNs for
SQL-Server default instance:</p>
<a class="reference internal image-reference" href="../../_images/DS_SQLServer02.png"><img alt="../../_images/DS_SQLServer02.png" class="align-center" src="../../_images/DS_SQLServer02.png" style="width: 5.5in;" /></a>
<p>The following information is required during configuration if SQL Server
uses Windows Authentication:</p>
<ul class="simple">
<li><p>Active Directory realm</p></li>
<li><p>Active Directory server IP or DNS name</p></li>
</ul>
</section>
<section id="steps-in-alation">
<h2>Steps In Alation<a class="headerlink" href="#steps-in-alation" title="Permalink to this headline">Â¶</a></h2>
<section id="step-1-add-a-datasource">
<h3>Step 1: Add a Datasource<a class="headerlink" href="#step-1-add-a-datasource" title="Permalink to this headline">Â¶</a></h3>
<p>Add a new Datasource on the Sources page, refer to <a class="reference internal" href="../DSConfiguration/AddingaDataSource.html"><span class="doc">Adding a Data Source</span></a>.</p>
</section>
<section id="step-2-set-up-the-connection">
<h3>Step 2: Set up the Connection<a class="headerlink" href="#step-2-set-up-the-connection" title="Permalink to this headline">Â¶</a></h3>
<section id="jdbc-uri">
<h4>JDBC URI<a class="headerlink" href="#jdbc-uri" title="Permalink to this headline">Â¶</a></h4>
<p>Add an SQL Server data source to Alation by filling the required and optional fields which construct the URI with the details provided or construct and provide the URI string manually.</p>
<section id="fill-in-fields">
<h5>Fill In Fields<a class="headerlink" href="#fill-in-fields" title="Permalink to this headline">Â¶</a></h5>
<p>To add a SQL Server data source to Alation; On the Add a Data Source screen of the wizard, specify:</p>
<blockquote>
<div><ul>
<li><p>In the <strong>Database Type</strong> list select <strong>SQL Server</strong>;</p></li>
<li><p>In the <strong>Host</strong> field, provide the hostname or IP address of your server.</p></li>
<li><p>In the <strong>Port</strong> field, type the port number <strong>1433</strong>;</p></li>
<li><p>Provide the Database name (Optional)</p></li>
<li><p>Provide the Instance name  (Optional)</p></li>
<li><p>Select SSL certificate if required.</p></li>
<li><p>If using Windows Active Directory for Authentication, select the <strong>Use Windows Active Directory</strong> checkbox and then select the required protocols:</p>
<blockquote>
<div><ul>
<li><p>NTLM</p>
<blockquote>
<div><ul>
<li><p>Realm</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>From 2020.4, when you use the NTLM protocol with Active Directory authentication, Alation will pre-select a built-in jTDS driver when you go through all the steps. However, NTLM authentication for SQL Server does not work with this jTDS driver, and you must switch to the Microsoft JDBC driver on the <strong>General Settings</strong> page. See below.</p>
</div>
</li>
</ul>
</div></blockquote>
</li>
<li><p>Kerberos</p>
<blockquote>
<div><ul class="simple">
<li><p>Server SPN (Optional)</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
<a class="reference internal image-reference" href="../../_images/DS_SQLServer13.png"><img alt="../../_images/DS_SQLServer13.png" src="../../_images/DS_SQLServer13.png" style="width: 450px;" /></a>
</div></blockquote>
</section>
<section id="provide-the-uri-as-a-string">
<h5>Provide the URI as a String<a class="headerlink" href="#provide-the-uri-as-a-string" title="Permalink to this headline">Â¶</a></h5>
<p>Alternatively, you can add a Data Source connection using JDBC URI. Click <strong>Enter JDBC URI</strong> and provide the JDBC URI to create a connection:</p>
<blockquote>
<div><a class="reference internal image-reference" href="../../_images/DS_SQLServer14.png"><img alt="../../_images/DS_SQLServer14.png" src="../../_images/DS_SQLServer14.png" style="width: 450px;" /></a>
</div></blockquote>
<p>Use the required  format for the JDBC URI depending on the Authentication Protocol and your database environment configuration.</p>
</section>
</section>
<section id="ntlm">
<h4>NTLM<a class="headerlink" href="#ntlm" title="Permalink to this headline">Â¶</a></h4>
<section id="microsoft-driver">
<h5>Microsoft Driver<a class="headerlink" href="#microsoft-driver" title="Permalink to this headline">Â¶</a></h5>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>sqlserver://&lt;Host_Name&gt;:&lt;Port&gt;<span class="p">;</span><span class="nv">domain</span><span class="o">=</span>&lt;Domain_Name&gt;<span class="p">;</span><span class="nv">authenticationScheme</span><span class="o">=</span>NTLM<span class="p">;</span><span class="nv">integratedSecurity</span><span class="o">=</span><span class="nb">true</span>
</pre></div>
</div>
<p><em>Example:</em></p>
<blockquote>
<div><p>sqlserver://10.13.82.165:1433;domain=al55527.test.local;authenticationScheme=NTLM;integratedSecurity=true</p>
</div></blockquote>
</section>
<section id="jtds-driver">
<h5>JTDS Driver<a class="headerlink" href="#jtds-driver" title="Permalink to this headline">Â¶</a></h5>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Do not use JTDS Driver and its URI if you are using Alation version 2020.4 and later. It is recommended to use the Microsoft Driver and its URI.</p>
</div>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>sqlserver://&lt;Host_Name&gt;:&lt;Port&gt;/&lt;db_name&gt;<span class="p">;</span><span class="nv">domain</span><span class="o">=</span>&lt;Domain_Name&gt;<span class="p">;</span><span class="nv">useNTLMv2</span><span class="o">=</span><span class="nb">true</span>
</pre></div>
</div>
<p><em>Example:</em></p>
<p>sqlserver://10.13.47.231:1433/SQL;domain=al55527.test.local;useNTLMv2=true</p>
</section>
</section>
<section id="kerberos">
<h4>Kerberos<a class="headerlink" href="#kerberos" title="Permalink to this headline">Â¶</a></h4>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>sqlserver://&lt;Host_name&gt;:&lt;Port&gt;<span class="p">;</span><span class="nv">databaseName</span><span class="o">=</span>&lt;name&gt;<span class="p">;</span><span class="nv">integratedSecurity</span><span class="o">=</span>true<span class="p">;</span><span class="nv">authenticationScheme</span><span class="o">=</span>JavaKerberos
</pre></div>
</div>
<p><em>Example:</em></p>
<blockquote>
<div><p>sqlserver://10.13.47.231:1433;databaseName=SQL;integratedSecurity=true;authenticationScheme=JavaKerberosâ</p>
</div></blockquote>
</section>
<section id="basic-authentication">
<h4>Basic Authentication<a class="headerlink" href="#basic-authentication" title="Permalink to this headline">Â¶</a></h4>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>sqlserver://&lt;Host_Name&gt;/databaseName<span class="o">=</span>&lt;db_name&gt;<span class="p">;</span>
</pre></div>
</div>
<p><em>Example:</em></p>
<blockquote>
<div><p>sqlserver://10.13.47.231:1433;databaseName=SQL;</p>
</div></blockquote>
</section>
</section>
<section id="step-3-enter-service-account-credentials">
<h3>Step 3: Enter Service Account Credentials<a class="headerlink" href="#step-3-enter-service-account-credentials" title="Permalink to this headline">Â¶</a></h3>
<blockquote>
<div><ol class="arabic simple">
<li><p>Select <strong>Yes</strong>.</p></li>
<li><p>Provide the username and password of the service account created for Alation.</p></li>
<li><p>Click <strong>Save and Continue</strong>. After this step, you are navigated to the <strong>Settings</strong> page of your data source.</p></li>
</ol>
</div></blockquote>
</section>
<section id="step-4-configure-your-data-source">
<h3>Step 4: Configure Your Data Source<a class="headerlink" href="#step-4-configure-your-data-source" title="Permalink to this headline">Â¶</a></h3>
<p>Click <strong>Skip this Step</strong>. After this step, you are navigated to the <strong>Settings</strong> page of your data source.</p>
</section>
</section>
<section id="general-settings">
<h2>General Settings<a class="headerlink" href="#general-settings" title="Permalink to this headline">Â¶</a></h2>
<section id="driver-for-sql-server-2017">
<h3>Driver for SQL Server 2017<a class="headerlink" href="#driver-for-sql-server-2017" title="Permalink to this headline">Â¶</a></h3>
<p>Refer to <a class="reference internal" href="../../releases/supportmatrices/index.html"><span class="doc">Support Matrix</span></a> for the certified driver version.</p>
<p>To see the certified JDBC driver in the drop-down list of drivers, the driver must be added to the custom_drivers path in the instance. Steps are as follows:</p>
<blockquote>
<div><ul class="simple">
<li><p>Download JDBC driver.</p></li>
<li><p>Copy the driver to the Alation instance.</p></li>
<li><p>ssh to the Alation instance.</p></li>
<li><p>Move the file to /opt/alation/alation/data1/site_data/custom_drivers/</p></li>
<li><p>$ sudo service alation restart</p></li>
</ul>
</div></blockquote>
</section>
<section id="driver-to-use-with-ntlm-authentication">
<h3>Driver to Use With NTLM Authentication<a class="headerlink" href="#driver-to-use-with-ntlm-authentication" title="Permalink to this headline">Â¶</a></h3>
<p>From release 2020.4, when you use the Add Data Source wizard screen to fill the fields and select the NTLM protocol with Active Directory authentication, Alation will later pre-select a built-in jTDS driver when you add a SQL server data source. NTLM authentication for SQL Server does not work with jTDS drivers in Alation, so you must switch to the Microsoft JDBC driver on the <strong>General Settings</strong> tab of the Settings.</p>
<p>Select the Microsoft JDBC driver from the list of drivers on the <strong>General Settings</strong> page and make sure the URI is in the required format: <a class="reference internal" href="#microsoft-driver">Microsoft Driver</a></p>
</section>
</section>
<section id="metadata-extraction">
<h2>Metadata Extraction<a class="headerlink" href="#metadata-extraction" title="Permalink to this headline">Â¶</a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="k">ANY</span><span class="w"> </span><span class="n">DEFINITION</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="k">Database</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="k">Schema</span><span class="w"> </span><span class="k">level</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">alation</span><span class="w"> </span><span class="p">(</span><span class="n">service</span><span class="w"> </span><span class="n">account</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="synonym-extraction">
<h2>Synonym Extraction<a class="headerlink" href="#synonym-extraction" title="Permalink to this headline">Â¶</a></h2>
<p><em>Available from release V R7 (5.12.x)</em></p>
<p>Synonyms will be extracted if Synonym Extraction feature is enabled in <strong>Labs/Feature Configuration</strong>. Alation will extract synonyms if their parent schemas are extracted during MDE.</p>
</section>
<section id="table-profiles">
<h2>Table Profiles<a class="headerlink" href="#table-profiles" title="Permalink to this headline">Â¶</a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="k">Database</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="k">Schema</span><span class="w"> </span><span class="k">level</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">alation</span><span class="w"> </span><span class="p">(</span><span class="n">service</span><span class="w"> </span><span class="n">account</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="query-history">
<h2>Query History<a class="headerlink" href="#query-history" title="Permalink to this headline">Â¶</a></h2>
<p>Alation supports several methods of query ingestion for SQL Server. Select one type of query ingestion from the options below. Use Extended Events if you have SQL Server 2008 or later. Extended events are supported for SQL Server with the 2008 version onwards.
For more details, refer to <a class="reference external" href="https://docs.microsoft.com/en-us/azure/sql-database/sql-database-xevent-db-diff-from-svr">SQL Server documentation</a>.</p>
<section id="option-1-extended-events">
<h3>Option 1: Extended Events<a class="headerlink" href="#option-1-extended-events" title="Permalink to this headline">Â¶</a></h3>
<p>To use this option, make sure your Alation service account has the
required permissions. If the Alation service account is a local SQL Server
account, it must have the <strong>sysadmin</strong>Â role. If an Active Directory account is used,
the âsysadminâÂ role is not required.</p>
<p>The SQL Server account (not the Alation service account) must
have read/writeÂ access to the directory where the logs are being stored.</p>
<p>Query Log Ingestion using <a class="reference external" href="https://technet.microsoft.com/en-us/library/bb630354(v%3Dsql.105).aspx">extended events</a> Â is
the preferred method and has less performance impact on the SQL Server
system than the other methods. An extended events session is created
that logs queries to files. Alation reads those files through SQL
queries sent to SQL Server to ingest them. The volume of events
may be high, so in the SQL to set up the extended events (provided
later in the guide) it defaults to logging only a sample of the events
and tries to filter out as many queries as possible that arenât useful
to Alation. We suggest starting with this and scaling back the sampling
after Query Log Ingestion is configured and working with the sampled
log.</p>
<section id="steps">
<h4>Steps:<a class="headerlink" href="#steps" title="Permalink to this headline">Â¶</a></h4>
<ol class="arabic">
<li><p>Grant the Alation service account VIEW SERVER STATE permission.</p>
<blockquote>
<div><p><strong>Why is this needed?</strong>
Alation must have access to run <code class="docutils literal notranslate"><span class="pre">sys.fn_xe_file_target_read_file</span></code> command to read the logged XEL files that extended events create. VIEW SERVER STATE is required to use that command.</p>
</div></blockquote>
</li>
<li><p>Grant the Alation service account permission to run the stored procedure <code class="docutils literal notranslate"><span class="pre">xp_dirtree</span></code>.</p>
<blockquote>
<div><p><strong>Why is this needed?</strong>
Alation needs to read the list of logged XEL files that it is going to ingest. This stored procedure lists files in a directory.</p>
</div></blockquote>
</li>
<li><p>Create and turn on an extended events session that logs queries. Depending on the SQL Server version, refer to:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference internal" href="Appendix.html#appendix-1a"><span class="std std-ref">A.1a SQL Server Extended Events Session Creation</span></a></p></li>
<li><p><a class="reference internal" href="Appendix.html#appendix-1b"><span class="std std-ref">A.1b SQL Server 2008 Extended Events Session Creation</span></a></p></li>
</ul>
<p>You will have to change the file path to log files and may optionally change some of the other parameters like the buffer size.</p>
</div></blockquote>
</li>
</ol>
<ol class="arabic simple" start="4">
<li><p>When you first turn on the session, monitor it for a few hours to see that it is working and the volume of log files. If the volume is small, - only a few log files per day, - you can edit the Extended Events SQL to turn down or remove the sampling. See the comments in the SQL code.</p></li>
<li><p>Have an Alation Admin for your instance configure the Settings from the Alation UI to point to the files that are being logged. Ensure that you include the trailing <code class="docutils literal notranslate"><span class="pre">\</span></code> at the end of the path or you will get partial_success âno logs to ingest.â</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you run XEvents for SQL Server, enter the file
path in the format <code class="docutils literal notranslate"><span class="pre">C:\Users\Public\Documents\</span></code> and run QLI. Use the trailing backslash at the end of the path.</p>
</div>
<a class="reference internal image-reference" href="../../_images/DS_SQLServer03.png"><img alt="../../_images/DS_SQLServer03.png" class="align-center" src="../../_images/DS_SQLServer03.png" style="width: 5.5in;" /></a>
</section>
</section>
<section id="option-2-server-side-trace">
<h3>Option 2: Server Side Trace<a class="headerlink" href="#option-2-server-side-trace" title="Permalink to this headline">Â¶</a></h3>
<p>Alation uses Server Side Trace to capture Query History log. By default,
Server Side Trace can log a lot of unwanted queries like system queries,
backup or maintenance queries that can take up a lot of disk space. To
limit disk usage, it is important to limit the traced queries to only
the important ones that support your use case. For example:</p>
<ul class="simple">
<li><p>Model queries from data analysts that can be used for reference and
knowledge sharing.</p></li>
<li><p>Queries on a subset of DBs to compute object popularity in a DB.</p></li>
</ul>
<p>If filtering doesnât help limit the size of Query History log,
Trace script can be run for a short interval anywhere from two to four hours
to capture of a subset of the queries.</p>
<p>Refer to Appendix <cite>A.1c SQL Server Trace Script &lt;Appendix_1c&gt;</cite> for a sample Trace script. The script is run directly on the server.</p>
</section>
<section id="option-3-sql-profiler">
<h3>Option 3: SQL Profiler<a class="headerlink" href="#option-3-sql-profiler" title="Permalink to this headline">Â¶</a></h3>
<p>SQL Server environments with light, infrequent loads can use Client
Side Profiling with SQL Profiler to capture the Query History Log. The
following steps show the method to set up Query History Log using
Profiler.</p>
<ol class="arabic">
<li><p>Launch SQL Server Profiler and create a new Template called <strong>AlationQueryLog</strong>:</p>
<blockquote>
<div><a class="reference internal image-reference" href="../../_images/DS_SQLServer04.png"><img alt="../../_images/DS_SQLServer04.png" class="align-center" src="../../_images/DS_SQLServer04.png" style="width: 3.5in;" /></a>
</div></blockquote>
</li>
</ol>
<div class="line-block">
<div class="line"><br /></div>
</div>
<blockquote>
<div><a class="reference internal image-reference" href="../../_images/DS_SQLServer05.png"><img alt="../../_images/DS_SQLServer05.png" class="align-center" src="../../_images/DS_SQLServer05.png" style="width: 3.5in;" /></a>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>Click the <strong>Events Selection</strong>Â tab and pick the following events:</p></li>
</ol>
<blockquote>
<div><ul>
<li><p>Stored Procedures -&gt; SP:StmtCompleted</p></li>
<li><p>TSQL -&gt; SQL:StmtCompleted</p>
<a class="reference internal image-reference" href="../../_images/DS_SQLServer06.png"><img alt="../../_images/DS_SQLServer06.png" class="align-center" src="../../_images/DS_SQLServer06.png" style="width: 3.5in;" /></a>
</li>
</ul>
</div></blockquote>
<p>3.Â For <code class="docutils literal notranslate"><span class="pre">SP:StmtCompleted</span></code> and <code class="docutils literal notranslate"><span class="pre">SQL:StmtCompleted</span></code> events, select the following Columns:</p>
<blockquote>
<div><ul class="simple">
<li><p>ApplicationName</p></li>
<li><p>CPU</p></li>
<li><p>DatabaseName</p></li>
<li><p>Duration</p></li>
<li><p>EndTime</p></li>
<li><p>LoginName</p></li>
<li><p>NTUserName</p></li>
<li><p>Reads</p></li>
<li><p>RowCounts</p></li>
<li><p>SPID</p></li>
<li><p>StartTime</p></li>
<li><p>TextData</p></li>
<li><p>Writes</p></li>
</ul>
<a class="reference internal image-reference" href="../../_images/DS_SQLServer07.png"><img alt="../../_images/DS_SQLServer07.png" class="align-center" src="../../_images/DS_SQLServer07.png" style="width: 5.5in;" /></a>
</div></blockquote>
<p>4.Â Set <strong>Filters</strong>Â to log only the important queries (for example not routine maintenance queries). This step is optional. Click the <strong>Column Filters</strong>Â button on the <strong>Events Selection</strong>Â tab:</p>
<blockquote>
<div><a class="reference internal image-reference" href="../../_images/DS_SQLServer08.png"><img alt="../../_images/DS_SQLServer08.png" class="align-center" src="../../_images/DS_SQLServer08.png" style="width: 2.5in;" /></a>
</div></blockquote>
<p>For example, to exclude queries from <code class="docutils literal notranslate"><span class="pre">MaintenanceApp</span></code>Â set <code class="docutils literal notranslate"><span class="pre">ApplicationNameÂ Not</span> <span class="pre">Like</span></code>Â filter to <code class="docutils literal notranslate"><span class="pre">MaintenanceApp%</span></code>.</p>
<p>Set Filters on other Columns as you see fit to limit logging to useful queries.</p>
<blockquote>
<div><a class="reference internal image-reference" href="../../_images/DS_SQLServer09.png"><img alt="../../_images/DS_SQLServer09.png" class="align-center" src="../../_images/DS_SQLServer09.png" style="width: 3.5in;" /></a>
</div></blockquote>
<p>5.Â Save the template.</p>
<p>6.Â Start a Trace using the AlationQueryLog template.</p>
<blockquote>
<div><a class="reference internal image-reference" href="../../_images/DS_SQLServer10.png"><img alt="../../_images/DS_SQLServer10.png" class="align-center" src="../../_images/DS_SQLServer10.png" style="width: 3.5in;" /></a>
</div></blockquote>
<p>7.Â Select <strong>Save To Table</strong>. Select <strong>Set maximum rows</strong>Â and define a limit based on the workload in your environment and the disk space on the server.</p>
<blockquote>
<div><a class="reference internal image-reference" href="../../_images/DS_SQLServer11.png"><img alt="../../_images/DS_SQLServer11.png" class="align-center" src="../../_images/DS_SQLServer11.png" style="width: 5.5in;" /></a>
</div></blockquote>
<p>8.Â Observe the Trace and adjust the Column Filters as needed (after pausing the Trace).</p>
<blockquote>
<div><a class="reference internal image-reference" href="../../_images/DS_SQLServer12.png"><img alt="../../_images/DS_SQLServer12.png" class="align-center" src="../../_images/DS_SQLServer12.png" style="width: 5.5in;" /></a>
</div></blockquote>
<p>9.Â Set up a job to periodically copy rows from Trace Table into another Archive table where you maintain history for three or four days.</p>
<p>10.Â Provide SELECT privileges to Alation database account on the Archive Table to read Query History.</p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>Create a view from the SQL ProfilerÂ for SQL
Server 2017 and enter the qualified table view name under QLI section on
the <strong>General Settings</strong> page and perform QLI.</p>
</div>
</div></blockquote>
</section>
<section id="option-4-sql-server-audit">
<h3>Option 4: SQL Server Audit<a class="headerlink" href="#option-4-sql-server-audit" title="Permalink to this headline">Â¶</a></h3>
<p>Query history information can be captured from the SQL Server Audit database.</p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>For specific details about SQL Server Audit, please refer to the SQL Server documentation for the relevant SQL Server version:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference external" href="https://docs.microsoft.com/en-us/sql/relational-databases/security/auditing/sql-server-audit-database-engine?view=sql-server-ver15&amp;viewFallbackFrom=sql-server-2017curity%2Fauditing%2Fsql-server-audit-database-engine%3Fview%3Dsql-server-ver15">SQL Server Audit (Database Engine)</a></p></li>
<li><p><a class="reference external" href="https://docs.microsoft.com/en-us/sql/t-sql/statements/create-database-audit-specification-transact-sql?view=sql-server-2017">CREATE DATABASE AUDIT SPECIFICATION (Transact-SQL)</a></p></li>
<li><p><a class="reference external" href="https://docs.microsoft.com/en-us/sql/relational-databases/security/auditing/sql-server-audit-action-groups-and-actions?view=sql-server-2017">SQL Server Audit Action Groups and Actions</a></p></li>
</ul>
</div></blockquote>
</div>
</div></blockquote>
<section id="id1">
<h4>Preliminaries<a class="headerlink" href="#id1" title="Permalink to this headline">Â¶</a></h4>
<p>To use SQL Server Audit for QLI in Alation:</p>
<ol class="arabic">
<li><p>Create a Server Audit to log query events for Alation QLI. <code class="docutils literal notranslate"><span class="pre">FILEPATH</span></code> is the path to the directory to store the audit files:</p>
<blockquote>
<div><div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="n">SERVER</span><span class="w"> </span><span class="n">AUDIT</span><span class="w"> </span><span class="n">test_audit</span>
<span class="k">TO</span><span class="w"> </span><span class="n">FILE</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">FILEPATH</span><span class="w"> </span><span class="o">=</span>
<span class="s1">&#39;C:\Users\Public\Documents\&#39;</span><span class="w"> </span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Create a Database Audit Specification that defines which events to audit for Alation. Audit groups specify the type of queries to be logged:</p>
<blockquote>
<div><div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">DATABASE</span><span class="w"> </span><span class="n">AUDIT</span><span class="w"> </span><span class="n">SPECIFICATION</span><span class="w"> </span><span class="n">test_audit_spec</span>
<span class="k">FOR</span><span class="w"> </span><span class="n">SERVER</span><span class="w"> </span><span class="n">AUDIT</span><span class="w"> </span><span class="n">test_audit</span>
<span class="k">ADD</span><span class="p">(</span><span class="w"> </span><span class="n">DATABASE_OBJECT_CHANGE_GROUP</span><span class="p">),</span>
<span class="k">ADD</span><span class="p">(</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DATABASE</span><span class="p">::</span><span class="n">db_name</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="o">&lt;</span><span class="k">role</span><span class="o">&gt;</span><span class="p">))</span>
<span class="k">WITH</span><span class="w"> </span><span class="p">(</span><span class="k">STATE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">ON</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Allow some time for users to query the database before performing QLI in Alation. Alation recommends to have 2 to 3 weeks of query history logs in the database for QLI to render meaningful results. Logs will be stored in the file path you have set up in the <strong>.sqlaudit</strong> format.</p></li>
<li><p>To list  the files that currently exist in the file path, you can run the following command:</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>EXEC<span class="w"> </span>xp_dirtree<span class="w"> </span><span class="s1">&#39;C:\Users\Public\Documents&#39;</span>,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="m">1</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Create a QLI View for Alation with the data from the audit files:</p>
<blockquote>
<div><div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">Alation_QLI_View</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="k">SELECT</span>
<span class="w">  </span><span class="n">application_name</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ApplicationName</span><span class="p">,</span>
<span class="w">  </span><span class="n">server_principal_sid</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">CPU</span><span class="p">,</span>
<span class="w">  </span><span class="n">database_name</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">DatabaseName</span><span class="p">,</span>
<span class="w">  </span><span class="n">duration_milliseconds</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Duration</span><span class="p">,</span>
<span class="w">  </span><span class="n">event_time</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">EndTime</span><span class="p">,</span>
<span class="w">  </span><span class="n">server_principal_name</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">LoginName</span><span class="p">,</span>
<span class="w">  </span><span class="n">server_principal_name</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">NTUserName</span><span class="p">,</span>
<span class="w">  </span><span class="mi">0</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">Reads</span><span class="p">,</span>
<span class="w">  </span><span class="n">affected_rows</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">RowCounts</span><span class="p">,</span>
<span class="w">  </span><span class="n">server_principal_sid</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">SPID</span><span class="p">,</span>
<span class="w">  </span><span class="n">event_time</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">StartTime</span><span class="p">,</span>
<span class="w">  </span><span class="k">statement</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">TextData</span><span class="p">,</span>
<span class="w">  </span><span class="n">session_id</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Writes</span><span class="p">,</span>
<span class="w">  </span><span class="k">null</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">EventClass</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">fn_get_audit_file</span><span class="p">(</span><span class="s1">&#39;C:\Users\Public\Documents\*&#39;</span><span class="p">,</span><span class="k">default</span><span class="p">,</span><span class="k">default</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Grant SELECT privileges on the created QLI view to the Alation service account.</p></li>
</ol>
</section>
<section id="configure-qli-in-alation">
<h4>Configure QLI in Alation<a class="headerlink" href="#configure-qli-in-alation" title="Permalink to this headline">Â¶</a></h4>
<p>When you have created the QLI view, configure QLI in Alation:</p>
<ol class="arabic">
<li><p>Go to the SQL Server Data Source Settings &gt; <strong>Query Log Ingestion</strong> tab.</p></li>
<li><p>Clear the <strong>Use XEvents</strong> checkbox.</p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>When the Use XEvents checkbox is selected on the Query Log Ingestion tab, the Query Log Privileges section is not available on the General Settings tab.</p>
</div>
</div></blockquote>
</li>
<li><p>Open the <strong>General Settings</strong> tab and under the <strong>Query Log Privileges</strong> section, provide the name of the database query history view in the format <strong>datasorcename.schema.table</strong>. For example: <code class="docutils literal notranslate"><span class="pre">Craft_Beer_Sales.dbo.Alation_QLI_View</span></code>.</p></li>
<li><p>Click <strong>Save</strong>.</p></li>
<li><p>Go back to the <strong>Query Log Ingestion</strong> tab. Set the QLI date range. Import the Query Logs on demand by clicking <strong>Import</strong> or set an automatic schedule.</p></li>
</ol>
</section>
</section>
<section id="other-methods">
<h3>Other Methods<a class="headerlink" href="#other-methods" title="Permalink to this headline">Â¶</a></h3>
<p>Alation can also support ingestion from a custom table (not recommended). For information on the custom table set up, see <cite>A.1d SQL Server Ingestion from Custom Table Setup &lt;Appendix_1d&gt;</cite>.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  
<div class="navigation-bar">

    <div class="navigation navigation--prev">
        
        <a class="navigation__link" href="Snowflake.html">
            <button class="navigation__button">
                <i class="icon icon-left"></i>
            </button>
            <div class="navigation__title">
                <span class="heading">Previous</span> <br />Snowflake
            </div>
        </a>
        
    </div>

    <div class="navigation navigation--next">
        
        <a class="navigation__link" title="Accesskey Alt(+Shift)+p" accesskey="p" href="SybaseIQ.html">
            <div class="navigation__title">
                <span class="heading">Next</span> <br />Sybase IQ
            </div>
            <button class="navigation__button" title="Accesskey Alt(+Shift)+n" accesskey="n">
                <i class="icon icon-right"></i>
            </button>
        </a>
        
    </div>

</div>


</footer>

        </div>
      </div>

    </section>

    <div class="wy-nav-side wy-nav-secondary">
      <div class="wy-side-scroll">
        <div class="wy-side-scroll__content">
          <div class="wy-menu-secondary">
              <div class="comments">
    <a href="mailto:no-reply-docs-feedback@alation.com?subject=Documentation Feedback on datasources/AddDataSources/SQLServer&body=Alation%20welcomes%20your%20comments%20on%20typos,%20content%20accuracy%20and%20completeness,%20and%20whether%20you%20found%20this%20page%20helpful.%20You%20will%20not%20receive%20a%20reply%20to%20this%20email.">
        <i class="icon icon-envelope" aria-hidden="true"></i>Request docs changes
    </a>
    <a href="#open-modal-pdf">
        <i class="icon icon-pdf" aria-hidden="true"></i>Download PDF
    </a>
</div>
              
                <p class="wy-menu-secondary-header">On this page</p>
                <ul>
<li><a class="reference internal" href="#">SQL Server</a><ul>
<li><a class="reference internal" href="#required-information">Required Information</a></li>
<li><a class="reference internal" href="#preliminaries">Preliminaries</a></li>
<li><a class="reference internal" href="#create-service-account">Create Service Account</a></li>
<li><a class="reference internal" href="#steps-in-alation">Steps In Alation</a><ul>
<li><a class="reference internal" href="#step-1-add-a-datasource">Step 1: Add a Datasource</a></li>
<li><a class="reference internal" href="#step-2-set-up-the-connection">Step 2: Set up the Connection</a><ul>
<li><a class="reference internal" href="#jdbc-uri">JDBC URI</a><ul>
<li><a class="reference internal" href="#fill-in-fields">Fill In Fields</a></li>
<li><a class="reference internal" href="#provide-the-uri-as-a-string">Provide the URI as a String</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ntlm">NTLM</a><ul>
<li><a class="reference internal" href="#microsoft-driver">Microsoft Driver</a></li>
<li><a class="reference internal" href="#jtds-driver">JTDS Driver</a></li>
</ul>
</li>
<li><a class="reference internal" href="#kerberos">Kerberos</a></li>
<li><a class="reference internal" href="#basic-authentication">Basic Authentication</a></li>
</ul>
</li>
<li><a class="reference internal" href="#step-3-enter-service-account-credentials">Step 3: Enter Service Account Credentials</a></li>
<li><a class="reference internal" href="#step-4-configure-your-data-source">Step 4: Configure Your Data Source</a></li>
</ul>
</li>
<li><a class="reference internal" href="#general-settings">General Settings</a><ul>
<li><a class="reference internal" href="#driver-for-sql-server-2017">Driver for SQL Server 2017</a></li>
<li><a class="reference internal" href="#driver-to-use-with-ntlm-authentication">Driver to Use With NTLM Authentication</a></li>
</ul>
</li>
<li><a class="reference internal" href="#metadata-extraction">Metadata Extraction</a></li>
<li><a class="reference internal" href="#synonym-extraction">Synonym Extraction</a></li>
<li><a class="reference internal" href="#table-profiles">Table Profiles</a></li>
<li><a class="reference internal" href="#query-history">Query History</a><ul>
<li><a class="reference internal" href="#option-1-extended-events">Option 1: Extended Events</a><ul>
<li><a class="reference internal" href="#steps">Steps:</a></li>
</ul>
</li>
<li><a class="reference internal" href="#option-2-server-side-trace">Option 2: Server Side Trace</a></li>
<li><a class="reference internal" href="#option-3-sql-profiler">Option 3: SQL Profiler</a></li>
<li><a class="reference internal" href="#option-4-sql-server-audit">Option 4: SQL Server Audit</a><ul>
<li><a class="reference internal" href="#id1">Preliminaries</a></li>
<li><a class="reference internal" href="#configure-qli-in-alation">Configure QLI in Alation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#other-methods">Other Methods</a></li>
</ul>
</li>
</ul>
</li>
</ul>

              
            </div>
          </div>
      </div>
    </div>

  </div>

  
  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->

  
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/clipboard.min.js"></script>
      <script type="text/javascript" src="../../_static/copybutton.js"></script>
      <script type="text/javascript" src="../../_static/js/rtd_sphinx_search.min.js"></script>
  
  <script type="text/javascript" src="../../_static/searchtools.js"></script> <script type="text/javascript" id="idPiwikScriptPlaceholder"></script><script type="text/javascript" src="../../_static/js/main.bundle.js"></script>
  <script type="text/javascript" src="../../_static/js/runtime.bundle.js"></script>

  
  

  
    <div id="open-modal-pdf" class="modal-window">
<div>
  <a href="#" title="Close" class="modal-close">Close</a>
  <h4>Alation Documentation PDF</h4>
  <p>This PDF contains all our documentation and is more than <b>120 MB</b> in size. We recommend using an ethernet or Wi-Fi connection for downloading.</p>
  <br>
  <div class="modal-buttons">
    <a href="https://pdf-docs.alation.com/AlationUserDocs.pdf" class="btn-cta btn-cta--primary" target="_blank">
      Download PDF
    </a>
    <a href="#" title="Close" class="btn-cta">Cancel</a>
  </div>
</div>
  

</body>
</html>
<!--3.6.17-->