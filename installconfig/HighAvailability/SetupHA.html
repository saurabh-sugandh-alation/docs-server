
<!DOCTYPE html>
<html lang="" >
<head>
  <meta charset="utf-8"/>
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="book-version"      content=""/>
  <meta name="book-release"      content=""/>
  <meta name="docsearch:name"    content="Alation User Guide" />
  <meta name="docsearch:version" content="" />
  <meta name="docsearch:package_type" content="" />
	<meta name="robots" content="noindex" />

  
  <title>Set Up High Availability &mdash; Alation User Guide</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  

  
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/main.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx_collapse.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/rtd_sphinx_search.min.css" type="text/css" />
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="Alation User Guide" href="#"/>
        <link rel="up" title="High Availability" href="index.html"/>
        <link rel="next" title="Revert the High Availability Pair to Standalone Mode" href="RevertHAPairtoStandaloneMode.html"/>
        <link rel="prev" title="HA Requirements" href="HARequirements.html"/>

	

	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-67846571-1"></script>
	<script>
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());

	gtag('config', 'UA-67846571-1');
	</script>

	<!-- Global site tag (gtag.js) - Google Analytics -->
	<!-- Second Google Analytics tag to assist mapping with mattermost.com visits --> 
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-120238482-1"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  gtag('config', 'UA-120238482-1');
	</script>


</head>

<body class="wy-body-for-nav" role="document">

  <header>
    <div class="header__container wy-max-content-width">
        <a href="/" class="header__logo">
            <img width="176" src="../../_static/img/logo-alation.svg" alt="Alation" />
        </a>
        <ul class="header__links">
            <li><a href="https://help.alation.com/s/">Alation Help Center</a></li>
        </ul>
    </div>
</header>

  <div class="wy-grid-for-nav wy-max-content-width">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-scroll__content">
          <div class="wy-side-nav-search">
            

            <ul class="sidebartop">
              <li class="nolink search"><div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search this project" aria-label="Search this project" id="searchinput" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
</li>

            </ul>

            
          </div>

          <div class="wy-menu wy-sidebar wy-sidebar--hidden" data-spy="affix" role="navigation" aria-label="main navigation">
            
              
              
              
                  <p class="caption" role="heading"><span class="caption-text">Welcome to Alation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/About/index.html">About Alation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/CloudAndOnPrem/index.html">Alation Cloud and On-Premise</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/UserProfileandPreferences/index.html">User Profile and Preferences</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/CatalogBasics/index.html">Catalog Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/CatalogPages/index.html">Catalog Pages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/Conversations/index.html">Conversations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/Domains/index.html">Domains</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/BestPractices/index.html">Best Practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/Glossary/index.html">Alation Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alation Cloud Service</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../cloud/StatusPage/index.html">Status Page</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cloud/CloudOverview/index.html">Cloud Service Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cloud/CloudConfiguration/index.html">Configuration for Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cloud/AlationAgent/index.html">Alation Agent</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alation Integration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../integration/AlationAnywhere/index.html">Alation Anywhere</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../integration/AlationConnectedSheets/index.html">Alation Connected Sheets</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Installation &amp; Configuration</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../ServerInstallation/index.html">Install Alation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">High Availability</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="OverviewOfHighAvailability.html">Overview of High Availability</a></li>
<li class="toctree-l2"><a class="reference internal" href="HARequirements.html">HA Requirements</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Set Up High Availability</a></li>
<li class="toctree-l2"><a class="reference internal" href="RevertHAPairtoStandaloneMode.html">Revert the High Availability Pair to Standalone Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="FailovertoSecondary.html">Failover to Secondary</a></li>
<li class="toctree-l2"><a class="reference internal" href="MigratefromLegacytoSupportedHA.html">Migrate from Legacy to Supported High Availability</a></li>
<li class="toctree-l2"><a class="reference internal" href="SetupReplicationonaHAPair.html">Set up Replication on HA Pair (4.7 and Below)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Update/index.html">Update Alation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../BackupandRestore/index.html">Back Up and Restore</a></li>
<li class="toctree-l1"><a class="reference internal" href="../LineageV2/index.html">Lineage V2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../LineageV3/index.html">Lineage V3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AlationAnalyticsV2/index.html">Alation Analytics V2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AlationContainerService/index.html">Alation Container Service</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Sources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../sources/CatalogSources/index.html">Catalog Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sources/VirtualDataSources/index.html">Virtual Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sources/Lineage/index.html">Lineage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sources/APIResources/index.html">API Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sources/WorkwithCatalogData/index.html">Working with Catalog Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sources/OpenConnectorFramework/index.html">Open Connector Framework</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Sources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../datasources/DSConfiguration/index.html">Data Source Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../datasources/AddDataSources/index.html">Adding Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../datasources/ComposeSSOAWSDataSources/index.html">Compose SSO for Amazon Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../datasources/ComposeSSOAzureDataSources/index.html">Compose SSO for Azure Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../datasources/AuthenticationForExtraction/index.html">Authentication for Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../datasources/CustomDB/index.html">Custom DB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../datasources/GBQ/index.html">Google BigQuery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../datasources/Hive/index.html">Hive</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">BI Sources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../bisources/AddBISources/index.html">Add BI Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bisources/AddTableauServer/index.html">Add Tableau Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bisources/WorkwithBISources/index.html">Working with BI Sources</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">File System Sources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/FileSystems/index.html">Add File Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/VirtualFileSystems/index.html">Virtual File Systems</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alation for Analysts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../analyst/UserAuthenticationForDataSources/index.html">User Authentication for Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analyst/ShareAndAccessQueries/index.html">Share and Access Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analyst/WriteQueries/index.html">Write Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analyst/DevelopQueries/index.html">Develop Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analyst/WorkwithQueryResults/index.html">Work with Query Results</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alation for Data Stewards</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../steward/GovernanceApp/index.html">Governance App</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/PolicyCenter/index.html">Policy Center</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/Workflow/index.html">Workflow Center</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/GovernanceDashboard/index.html">Governance Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/StewardshipWorkbench/index.html">Stewardship Workbench</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/AnalyticsStewardship/index.html">Analytics Stewardship</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/Glossary/index.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/ArticlesAndTags/index.html">Articles and Tags</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/ArticleGroups/index.html">Article Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/DataCatalogCustomization/index.html">Customize Your Data Catalog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/DataDocumentation/index.html">Data Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/AutoTitlingandLexicon/index.html">Auto-titling and Lexicon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/SnowflakeTags/index.html">Snowflake Tags</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alation for Server Administrators</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../admins/CustomizableHomePage/index.html">Customizable Homepage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/AdminSettings/index.html">Administrator Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/AdditionalConfiguration/index.html">Additional Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/RunbookForAdministrators/index.html">Runbook for Administrators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/AlationAPIs/index.html">Alation APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/How-tos/index.html">How-tos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/Troubleshooting/index.html">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Release Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../releases/releasenotes/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/supportmatrices/index.html">Support Matrices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/endofsupport/index.html">End Of Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/snowflakeclladdon/index.html">Snowflake Parser Add-On</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/fieldnotices/index.html">Important Notices and Security Alerts</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Archived Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../archive/About/index.html">About the Documentation Archive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../archive/AdminConfig/index.html">Administration and Update Archive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../archive/ReleaseNotes/index.html">Release Notes Archive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../archive/Usage/index.html">Usage and Customization Archive</a></li>
</ul>

              
            
          </div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="wy-nav-top-icon"></i>
        <a href="../../index.html">Alation User Guide</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">

          <div role="navigation" aria-label="breadcrumbs" class="breadcrumbs">
    <a href="../../index.html">Docs</a>
    <span class="separator">&gt;</span>
    <a href="index.html">High Availability</a>
    <span class="separator">&gt;</span>
    <span>Set Up High Availability</span>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody" class="toBeIndexed">
            
  <section id="set-up-high-availability">
<h1>Set Up High Availability<a class="headerlink" href="#set-up-high-availability" title="Permalink to this headline">¶</a></h1>
<p class="on-prem-label hover-text">Customer Managed <span class="tooltip-text">Applies to customer-managed instances of Alation</span></p>
<p>Alation HA setup prioritizes having less downtime. Besides a few restarts of services, the setup process should only take between ten to
30 minutes regardless of instance size. The actual replication of your data may take hours and in some cases days to complete, depending on the size of the internal application database. This may also be dependent on your system and network.</p>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>The Primary and Secondary servers should have identical physical configuration.</p>
<ul>
<li><p>Data partitions must be the same size</p></li>
<li><p>Installation space (<strong>/opt/alation</strong>) must be the same size</p></li>
</ul>
</li>
<li><p>The same version of the Alation software must be installed on both servers. The Secondary server does not need to be configured because it will inherit the configuration from the Primary system. When installing the Secondary system, follow the <a class="reference internal" href="../ServerInstallation/Installation.html"><span class="doc">Installation Process</span></a> steps up to <code class="docutils literal notranslate"><span class="pre">/etc/init.d/alation</span> <span class="pre">start</span></code>.</p></li>
<li><p>The Primary and Secondary systems must be able to connect over the ports described in <a class="reference internal" href="HARequirements.html"><span class="doc">HA Requirements</span></a>.</p></li>
</ul>
</section>
<section id="setting-up-high-availability-pair">
<h2>Setting Up High Availability Pair<a class="headerlink" href="#setting-up-high-availability-pair" title="Permalink to this headline">¶</a></h2>
<p>The High Availability (HA) configuration that Alation currently uses is IP-based. This means that you cannot move your HA pair to a new instance by un-mounting the data drives from the old Primary and Secondary instances and then re-mounting them on new instances, as the new Primary and Secondary servers will not synchronize. If you want to transfer Alation to a new instance, we recommend that you do a backup of the data drive, restore it on a new server, and set up HA anew between the new Primary and Secondary instances.</p>
<section id="step-1-enter-the-alation-shell">
<h3>Step 1: Enter the Alation Shell<a class="headerlink" href="#step-1-enter-the-alation-shell" title="Permalink to this headline">¶</a></h3>
<p>On both the Primary and Secondary hosts, enter the Alation shell. The commands in this section must be run from the Alation shell.</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>/etc/init.d/alation<span class="w"> </span>shell
</pre></div>
</div>
</div></blockquote>
</section>
<section id="step-2-generate-keys">
<h3>Step 2: Generate Keys<a class="headerlink" href="#step-2-generate-keys" title="Permalink to this headline">¶</a></h3>
<p>On both Primary and Secondary, run:</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>alation_action<span class="w"> </span>cluster_generate_keys
</pre></div>
</div>
</div></blockquote>
<p>This action is <strong>safe</strong>, with no restart of services required.</p>
</section>
<section id="step-3-set-up-key-exchange">
<h3>Step 3: Set up Key Exchange<a class="headerlink" href="#step-3-set-up-key-exchange" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p>On both Primary and Secondary, run the command given below. This action is <strong>safe</strong>, with no restart of services required:</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>replication_helper
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>You will be presented with a public key for the current server and asked to paste the public key from the remote server.</p></li>
<li><p>You will be presented with the IP address of the current server and are prompted to enter the IP address of the remote server. Enter the IP addresses in the <strong>IPv4</strong> format. For example: <code class="docutils literal notranslate"><span class="pre">10.0.0.1</span></code>.</p></li>
</ol>
</section>
<section id="step-4-put-the-primary-server-into-master-mode">
<h3>Step 4: Put the Primary Server into Master Mode<a class="headerlink" href="#step-4-put-the-primary-server-into-master-mode" title="Permalink to this headline">¶</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This action includes the restart of Alation services.</p>
<p>This action is unsafe.</p>
</div>
<p>From the Primary, run:</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>alation_action<span class="w"> </span>cluster_enter_master_mode
</pre></div>
</div>
</div></blockquote>
</section>
<section id="step-5-disable-instance-protection-on-secondary">
<h3>Step 5: Disable Instance Protection on Secondary<a class="headerlink" href="#step-5-disable-instance-protection-on-secondary" title="Permalink to this headline">¶</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If important data exists on the target instance, ensure that you back it up first as this step will make it possible to delete all instance data.</p>
<p>This action is <strong>unsafe</strong> as it opens a way to delete the data.</p>
</div>
<p>From the Secondary, run:</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>alation_conf<span class="w"> </span>alation.cluster.protected_instance<span class="w"> </span>-s<span class="w"> </span>False
</pre></div>
</div>
</div></blockquote>
<p>No restart of services is required.</p>
<p>After instance protection is disabled, Primary can connect to Secondary and wipe its data.</p>
</section>
<section id="step-6-input-ip-addresses">
<h3>Step 6: Input IP Addresses<a class="headerlink" href="#step-6-input-ip-addresses" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This step applies from release 2020.4. If you are on an older release, skip this step and proceed to Step 7.</p>
</div>
<p>On both Primary and Secondary, use the commands given below to input the IP address of the current host in the <strong>IPv4</strong> format (example: <code class="docutils literal notranslate"><span class="pre">10.0.0.1</span></code>):</p>
<blockquote>
<div><ul class="simple">
<li><p>On Primary, input the IP address of the Primary host</p></li>
<li><p>On Secondary, input the IP address of the Secondary host</p></li>
</ul>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>alation_conf<span class="w"> </span>alation.cluster.override_ip<span class="w"> </span>-s<span class="w"> </span>&lt;host<span class="w"> </span>ip&gt;
</pre></div>
</div>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>alation_conf<span class="w"> </span>alation.cluster.enable_override_ip<span class="w"> </span>-s<span class="w"> </span>True
</pre></div>
</div>
</div></blockquote>
</section>
<section id="step-7-add-the-secondary-on-the-primary">
<h3>Step 7: Add the Secondary on the Primary<a class="headerlink" href="#step-7-add-the-secondary-on-the-primary" title="Permalink to this headline">¶</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This action deletes any instance that is not protected in order to set up replication and restarts PostgreSQL on the Primary and Alation services on the Secondary instance. Ensure that you have a valid backup before completing this step.</p>
<p>This action is unsafe.</p>
</div>
<p>From the Primary, run:</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>alation_action<span class="w"> </span>cluster_add_slaves
</pre></div>
</div>
</div></blockquote>
</section>
<section id="step-8-check-value-of-pgsql-config-max-wal-senders-on-secondary">
<h3>Step 8: Check Value of <code class="docutils literal notranslate"><span class="pre">pgsql.config.max_wal_senders</span></code> on Secondary<a class="headerlink" href="#step-8-check-value-of-pgsql-config-max-wal-senders-on-secondary" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This step applies from release 2021.3, where the internal PostgreSQL database is on version 13.x. If you are on an older release, skip this step and proceed to Step 9.</p>
</div>
<ol class="arabic">
<li><p>On Secondary, check the value of the <strong>alation_conf</strong> parameter <code class="docutils literal notranslate"><span class="pre">pgsql.config.max_wal_senders</span></code> to confirm the value is <code class="docutils literal notranslate"><span class="pre">4</span></code>.</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>alation_conf<span class="w"> </span>pgsql.config.max_wal_senders
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>If the value is not <code class="docutils literal notranslate"><span class="pre">4</span></code>, set it to <code class="docutils literal notranslate"><span class="pre">4</span></code>.</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>alation_conf<span class="w"> </span>pgsql.config.max_wal_senders<span class="w"> </span>-s<span class="w"> </span><span class="m">4</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>After changing this value, deploy the configuration.</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>alation_action<span class="w"> </span>deploy_conf_all
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
</section>
<section id="step-9-replicate-postgresql">
<h3>Step 9: Replicate PostgreSQL<a class="headerlink" href="#step-9-replicate-postgresql" title="Permalink to this headline">¶</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This action deletes all PostgreSQL data on the target machine. Ensure that you have a valid backup before completing this step.</p>
<p>This action is <strong>unsafe</strong>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Because this action may take a long time to run, consider using a tool such as <a class="reference external" href="https://linuxize.com/post/how-to-use-linux-screen/">Screen</a>.</p>
</div>
<ol class="arabic">
<li><p>On the Secondary, start a Screen session.</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>screen
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>If not in the shell, enter the Alation shell.</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>/etc/init.d/alation<span class="w"> </span>shell
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Replicate PostgreSQL.</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>alation_action<span class="w"> </span>cluster_replicate_postgres
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
<p>This step does not require a restart of any services on your Primary instance.</p>
</section>
<section id="step-10-copy-kv-store">
<span id="setup-ha-step-9"></span><h3>Step 10: Copy KV Store<a class="headerlink" href="#step-10-copy-kv-store" title="Permalink to this headline">¶</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This action deletes all your KV Store data on Secondary. Ensure that you have a valid backup before performing this step.</p>
<p>This action is <strong>unsafe</strong>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Because this action may take a long time to run, consider using Screen.</p>
</div>
<ol class="arabic">
<li><p>On the Secondary, start a Screen session.</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>screen
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>If not in the shell, enter the Alation shell.</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>/etc/init.d/alation<span class="w"> </span>shell
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Copy KV Store.</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>alation_action<span class="w"> </span>cluster_kvstore_copy
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
<p>This step does not require a restart of any services on your Primary instance.</p>
</section>
<section id="step-11-synchronize-the-event-bus-data">
<h3>Step 11: Synchronize the Event Bus Data<a class="headerlink" href="#step-11-synchronize-the-event-bus-data" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>This step applies from release <strong>2021.4</strong>. On older releases, skip this step.</p>
</div>
</div></blockquote>
<p>From the Secondary, run:</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>alation_action<span class="w"> </span>cluster_start_kafka_sync
</pre></div>
</div>
</div></blockquote>
</section>
</section>
<section id="verification">
<h2>Verification<a class="headerlink" href="#verification" title="Permalink to this headline">¶</a></h2>
<section id="ports">
<h3>Ports<a class="headerlink" href="#ports" title="Permalink to this headline">¶</a></h3>
<p>Without any command line arguments, <code class="docutils literal notranslate"><span class="pre">replication_port_check</span></code> reads
<strong>alation.cluster.hosts</strong> from Alation, iterates through each host, and runs
port checks. This is useful if you want to troubleshoot network
connectivity between the two hosts.</p>
<p>From the Alation shell, on both Primary and Secondary, run:</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>replication_port_check
</pre></div>
</div>
</div></blockquote>
<p>This action is <strong>safe</strong>, with no restart of services required.</p>
</section>
<section id="databases">
<h3>Databases<a class="headerlink" href="#databases" title="Permalink to this headline">¶</a></h3>
<p>The <strong>/monitor/replication</strong> URI returns a JSON with PostgreSQL lags. If PostgreSQL returns <code class="docutils literal notranslate"><span class="pre">unknown</span></code>, this indicates that something has gone wrong. You will need to rebuild replication for that service. In addition, if the lag bytes increase and never decrease, you may need to provide a faster machine to keep up.</p>
<p>From the Primary, run:</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-L<span class="w"> </span>http://localhost/monitor/replication
</pre></div>
</div>
</div></blockquote>
<p>Alternatively, in a browser tab, view: <code class="docutils literal notranslate"><span class="pre">http(s)://&lt;BASE_URL&gt;/monitor/replication</span></code>.</p>
</section>
<section id="files-configurations">
<h3>Files/Configurations<a class="headerlink" href="#files-configurations" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">alation_action</span> <span class="pre">cluster_replicate_files</span></code> command will run one-time (non-looping) and pass off the Python script that rsync’s files and sync’s configurations. If there are any rsync errors, capture the debug output and file a ticket with Alation Support to investigate.</p>
<p>From the the Alation shell on Secondary, run:</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>alation_action<span class="w"> </span>cluster_replicate_files
</pre></div>
</div>
</div></blockquote>
</section>
<section id="backup-v2">
<h3>Backup V2<a class="headerlink" href="#backup-v2" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This step applies to releases older than <strong>2021.2</strong>. From 2021.2, Backup V2 is the default backup tool.</p>
</div>
<p>Perform this step if before rebuilding the HA pair, you had Backup V2 enabled on your Alation instance. The HA setup resets the Alation Backup V2 feature flag back to the default value (<code class="docutils literal notranslate"><span class="pre">False</span></code>). Re-enable Backup V2 after HA setup is complete. On how to enable Backup V2, see <a class="reference internal" href="../BackupandRestore/BackupV1AndV2/EnableOrDisableBackupV2.html"><span class="doc">Enable or Disable Backup V2</span></a>.</p>
</section>
</section>
<section id="related-topics">
<h2>Related Topics<a class="headerlink" href="#related-topics" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p><a class="reference internal" href="index.html"><span class="doc">High Availability</span></a></p>
<p><a class="reference internal" href="HARequirements.html"><span class="doc">HA Requirements</span></a></p>
<p><a class="reference internal" href="FailovertoSecondary.html"><span class="doc">Failover to Secondary</span></a></p>
<p><a class="reference internal" href="MigratefromLegacytoSupportedHA.html"><span class="doc">Migrating from Legacy to Supported HA</span></a></p>
</div></blockquote>
</section>
</section>


           </div>
          </div>
          <footer>

  
<div class="navigation-bar">

    <div class="navigation navigation--prev">
        
        <a class="navigation__link" href="HARequirements.html">
            <button class="navigation__button">
                <i class="icon icon-left"></i>
            </button>
            <div class="navigation__title">
                <span class="heading">Previous</span> <br />HA Requirements
            </div>
        </a>
        
    </div>

    <div class="navigation navigation--next">
        
        <a class="navigation__link" title="Accesskey Alt(+Shift)+p" accesskey="p" href="RevertHAPairtoStandaloneMode.html">
            <div class="navigation__title">
                <span class="heading">Next</span> <br />Revert the High Availability Pair to Standalone Mode
            </div>
            <button class="navigation__button" title="Accesskey Alt(+Shift)+n" accesskey="n">
                <i class="icon icon-right"></i>
            </button>
        </a>
        
    </div>

</div>


</footer>

        </div>
      </div>

    </section>

    <div class="wy-nav-side wy-nav-secondary">
      <div class="wy-side-scroll">
        <div class="wy-side-scroll__content">
          <div class="wy-menu-secondary">
              <div class="comments">
    <a href="mailto:no-reply-docs-feedback@alation.com?subject=Documentation Feedback on installconfig/HighAvailability/SetupHA&body=Alation%20welcomes%20your%20comments%20on%20typos,%20content%20accuracy%20and%20completeness,%20and%20whether%20you%20found%20this%20page%20helpful.%20You%20will%20not%20receive%20a%20reply%20to%20this%20email.">
        <i class="icon icon-envelope" aria-hidden="true"></i>Request docs changes
    </a>
    <a href="#open-modal-pdf">
        <i class="icon icon-pdf" aria-hidden="true"></i>Download PDF
    </a>
</div>
              
                <p class="wy-menu-secondary-header">On this page</p>
                <ul>
<li><a class="reference internal" href="#">Set Up High Availability</a><ul>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li><a class="reference internal" href="#setting-up-high-availability-pair">Setting Up High Availability Pair</a><ul>
<li><a class="reference internal" href="#step-1-enter-the-alation-shell">Step 1: Enter the Alation Shell</a></li>
<li><a class="reference internal" href="#step-2-generate-keys">Step 2: Generate Keys</a></li>
<li><a class="reference internal" href="#step-3-set-up-key-exchange">Step 3: Set up Key Exchange</a></li>
<li><a class="reference internal" href="#step-4-put-the-primary-server-into-master-mode">Step 4: Put the Primary Server into Master Mode</a></li>
<li><a class="reference internal" href="#step-5-disable-instance-protection-on-secondary">Step 5: Disable Instance Protection on Secondary</a></li>
<li><a class="reference internal" href="#step-6-input-ip-addresses">Step 6: Input IP Addresses</a></li>
<li><a class="reference internal" href="#step-7-add-the-secondary-on-the-primary">Step 7: Add the Secondary on the Primary</a></li>
<li><a class="reference internal" href="#step-8-check-value-of-pgsql-config-max-wal-senders-on-secondary">Step 8: Check Value of <code class="docutils literal notranslate"><span class="pre">pgsql.config.max_wal_senders</span></code> on Secondary</a></li>
<li><a class="reference internal" href="#step-9-replicate-postgresql">Step 9: Replicate PostgreSQL</a></li>
<li><a class="reference internal" href="#step-10-copy-kv-store">Step 10: Copy KV Store</a></li>
<li><a class="reference internal" href="#step-11-synchronize-the-event-bus-data">Step 11: Synchronize the Event Bus Data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#verification">Verification</a><ul>
<li><a class="reference internal" href="#ports">Ports</a></li>
<li><a class="reference internal" href="#databases">Databases</a></li>
<li><a class="reference internal" href="#files-configurations">Files/Configurations</a></li>
<li><a class="reference internal" href="#backup-v2">Backup V2</a></li>
</ul>
</li>
<li><a class="reference internal" href="#related-topics">Related Topics</a></li>
</ul>
</li>
</ul>

              
            </div>
          </div>
      </div>
    </div>

  </div>

  
  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->

  
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/clipboard.min.js"></script>
      <script type="text/javascript" src="../../_static/copybutton.js"></script>
      <script type="text/javascript" src="../../_static/js/rtd_sphinx_search.min.js"></script>
  
  <script type="text/javascript" src="../../_static/searchtools.js"></script> <script type="text/javascript" id="idPiwikScriptPlaceholder"></script><script type="text/javascript" src="../../_static/js/main.bundle.js"></script>
  <script type="text/javascript" src="../../_static/js/runtime.bundle.js"></script>

  
  

  
    <div id="open-modal-pdf" class="modal-window">
<div>
  <a href="#" title="Close" class="modal-close">Close</a>
  <h4>Alation Documentation PDF</h4>
  <p>This PDF contains all our documentation and is more than <b>120 MB</b> in size. We recommend using an ethernet or Wi-Fi connection for downloading.</p>
  <br>
  <div class="modal-buttons">
    <a href="https://pdf-docs.alation.com/AlationUserDocs.pdf" class="btn-cta btn-cta--primary" target="_blank">
      Download PDF
    </a>
    <a href="#" title="Close" class="btn-cta">Cancel</a>
  </div>
</div>
  

</body>
</html>
<!--3.6.17-->