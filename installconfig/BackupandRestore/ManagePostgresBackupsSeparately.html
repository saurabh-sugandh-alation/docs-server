
<!DOCTYPE html>
<html lang="" >
<head>
  <meta charset="utf-8"/>
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="book-version"      content=""/>
  <meta name="book-release"      content=""/>
  <meta name="docsearch:name"    content="Alation User Guide" />
  <meta name="docsearch:version" content="" />
  <meta name="docsearch:package_type" content="" />
	<meta name="robots" content="noindex" />

  
  <title>Manage Postgres Backups Separately &mdash; Alation User Guide</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  

  
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/main.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx_collapse.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/rtd_sphinx_search.min.css" type="text/css" />
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="Alation User Guide" href="#"/>
        <link rel="up" title="Back Up and Restore" href="index.html"/>
        <link rel="next" title="Restore from a Backup" href="RestoreFromBackup/index.html"/>
        <link rel="prev" title="Monitor Backups" href="MonitorBackups.html"/>

	

	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-67846571-1"></script>
	<script>
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());

	gtag('config', 'UA-67846571-1');
	</script>

	<!-- Global site tag (gtag.js) - Google Analytics -->
	<!-- Second Google Analytics tag to assist mapping with mattermost.com visits --> 
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-120238482-1"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  gtag('config', 'UA-120238482-1');
	</script>


</head>

<body class="wy-body-for-nav" role="document">

  <header>
    <div class="header__container wy-max-content-width">
        <a href="/" class="header__logo">
            <img width="176" src="../../_static/img/logo-alation.svg" alt="Alation" />
        </a>
        <ul class="header__links">
            <li><a href="https://help.alation.com/s/">Alation Help Center</a></li>
        </ul>
    </div>
</header>

  <div class="wy-grid-for-nav wy-max-content-width">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-scroll__content">
          <div class="wy-side-nav-search">
            

            <ul class="sidebartop">
              <li class="nolink search"><div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search this project" aria-label="Search this project" id="searchinput" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
</li>

            </ul>

            
          </div>

          <div class="wy-menu wy-sidebar wy-sidebar--hidden" data-spy="affix" role="navigation" aria-label="main navigation">
            
              
              
              
                  <p class="caption" role="heading"><span class="caption-text">Welcome to Alation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/About/index.html">About Alation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/CloudAndOnPrem/index.html">Alation Cloud and On-Premise</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/UserProfileandPreferences/index.html">User Profile and Preferences</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/CatalogBasics/index.html">Catalog Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/CatalogPages/index.html">Catalog Pages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/Conversations/index.html">Conversations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/Domains/index.html">Domains</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/BestPractices/index.html">Best Practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../welcome/Glossary/index.html">Alation Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alation Cloud Service</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../cloud/StatusPage/index.html">Status Page</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cloud/CloudOverview/index.html">Cloud Service Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cloud/CloudConfiguration/index.html">Configuration for Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cloud/AlationAgent/index.html">Alation Agent</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alation Integration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../integration/AlationAnywhere/index.html">Alation Anywhere</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../integration/AlationConnectedSheets/index.html">Alation Connected Sheets</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Installation &amp; Configuration</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../ServerInstallation/index.html">Install Alation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../HighAvailability/index.html">High Availability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Update/index.html">Update Alation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Back Up and Restore</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="BackupV1AndV2/index.html">Backup V1 and Backup V2</a></li>
<li class="toctree-l2"><a class="reference internal" href="ConfigureBackups/index.html">Configure Backups</a></li>
<li class="toctree-l2"><a class="reference internal" href="CreateBackupsManually.html">Create Backups Manually</a></li>
<li class="toctree-l2"><a class="reference internal" href="FindBackups.html">Find Backups</a></li>
<li class="toctree-l2"><a class="reference internal" href="MonitorBackups.html">Monitor Backups</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Manage Postgres Backups Separately</a></li>
<li class="toctree-l2"><a class="reference internal" href="RestoreFromBackup/index.html">Restore from a Backup</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../LineageV2/index.html">Lineage V2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../LineageV3/index.html">Lineage V3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AlationAnalyticsV2/index.html">Alation Analytics V2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AlationContainerService/index.html">Alation Container Service</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Sources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../sources/CatalogSources/index.html">Catalog Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sources/VirtualDataSources/index.html">Virtual Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sources/Lineage/index.html">Lineage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sources/APIResources/index.html">API Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sources/WorkwithCatalogData/index.html">Working with Catalog Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sources/OpenConnectorFramework/index.html">Open Connector Framework</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Sources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../datasources/DSConfiguration/index.html">Data Source Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../datasources/AddDataSources/index.html">Adding Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../datasources/ComposeSSOAWSDataSources/index.html">Compose SSO for Amazon Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../datasources/ComposeSSOAzureDataSources/index.html">Compose SSO for Azure Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../datasources/AuthenticationForExtraction/index.html">Authentication for Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../datasources/CustomDB/index.html">Custom DB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../datasources/GBQ/index.html">Google BigQuery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../datasources/Hive/index.html">Hive</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">BI Sources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../bisources/AddBISources/index.html">Add BI Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bisources/AddTableauServer/index.html">Add Tableau Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bisources/WorkwithBISources/index.html">Working with BI Sources</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">File System Sources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/FileSystems/index.html">Add File Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/VirtualFileSystems/index.html">Virtual File Systems</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alation for Analysts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../analyst/UserAuthenticationForDataSources/index.html">User Authentication for Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analyst/ShareAndAccessQueries/index.html">Share and Access Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analyst/WriteQueries/index.html">Write Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analyst/DevelopQueries/index.html">Develop Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analyst/WorkwithQueryResults/index.html">Work with Query Results</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alation for Data Stewards</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../steward/GovernanceApp/index.html">Governance App</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/PolicyCenter/index.html">Policy Center</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/Workflow/index.html">Workflow Center</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/GovernanceDashboard/index.html">Governance Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/StewardshipWorkbench/index.html">Stewardship Workbench</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/AnalyticsStewardship/index.html">Analytics Stewardship</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/Glossary/index.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/ArticlesAndTags/index.html">Articles and Tags</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/ArticleGroups/index.html">Article Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/DataCatalogCustomization/index.html">Customize Your Data Catalog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/DataDocumentation/index.html">Data Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/AutoTitlingandLexicon/index.html">Auto-titling and Lexicon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steward/SnowflakeTags/index.html">Snowflake Tags</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alation for Server Administrators</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../admins/CustomizableHomePage/index.html">Customizable Homepage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/AdminSettings/index.html">Administrator Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/AdditionalConfiguration/index.html">Additional Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/RunbookForAdministrators/index.html">Runbook for Administrators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/AlationAPIs/index.html">Alation APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/How-tos/index.html">How-tos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admins/Troubleshooting/index.html">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Release Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../releases/releasenotes/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/supportmatrices/index.html">Support Matrices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/endofsupport/index.html">End Of Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/snowflakeclladdon/index.html">Snowflake Parser Add-On</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/fieldnotices/index.html">Important Notices and Security Alerts</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Archived Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../archive/About/index.html">About the Documentation Archive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../archive/AdminConfig/index.html">Administration and Update Archive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../archive/ReleaseNotes/index.html">Release Notes Archive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../archive/Usage/index.html">Usage and Customization Archive</a></li>
</ul>

              
            
          </div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="wy-nav-top-icon"></i>
        <a href="../../index.html">Alation User Guide</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">

          <div role="navigation" aria-label="breadcrumbs" class="breadcrumbs">
    <a href="../../index.html">Docs</a>
    <span class="separator">&gt;</span>
    <a href="index.html">Back Up and Restore</a>
    <span class="separator">&gt;</span>
    <span>Manage Postgres Backups Separately</span>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody" class="toBeIndexed">
            
  <section id="manage-postgres-backups-separately">
<h1>Manage Postgres Backups Separately<a class="headerlink" href="#manage-postgres-backups-separately" title="Permalink to this headline">¶</a></h1>
<p class="on-prem-label hover-text">Customer Managed <span class="tooltip-text">Applies to customer-managed instances of Alation</span></p>
<p><em>Available from version 2023.1</em></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The information in this section applies to <strong>Backup V2</strong>. Refer to <a class="reference internal" href="BackupV1AndV2/CheckCurrentBackupTool.html"><span class="doc">Check Current Backup Tool</span></a> for information on how to check your current backup framework.</p>
</div>
<p><strong>From version 2023.1</strong>, Alation Postgres backups are created using the <a class="reference external" href="https://pgbackrest.org/">pgBackRest tool</a> by default. If necessary, the pgBackRest tool allows you to separate Postgres backups from the Alation application backups. Excluding Postgres backups from Alation backups can noticeably decrease the backup creation time and can be recommended for large implementations of the catalog. However, in this case Postgres backups will have to be maintained separately from Alation backups. The restore process is affected too as it requires the full set of backups of all components.</p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>On previous releases, starting with <strong>2022.2</strong>, the default backup tool was <strong>pg_probackup</strong>. The pgBackRest tool was additionally available and could be enabled by an Alation admin on demand.</p>
</div>
</div></blockquote>
<section id="check-if-pgbackrest-is-in-use">
<h2>Check if PgBackRest Is in Use<a class="headerlink" href="#check-if-pgbackrest-is-in-use" title="Permalink to this headline">¶</a></h2>
<p>If necessary, you can validate that the pgBackRest tool is enabled on your Alation instance by checking the <strong>alation_conf</strong> parameter <code class="docutils literal notranslate"><span class="pre">alation.feature_flags.enable_pgbackrest</span></code>. From 2023.1, by default, this parameter is set to <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p>
<p>To check the pgBackRest setting:</p>
<ol class="arabic">
<li><p>Use SSH to connect to your Alation instance.</p></li>
<li><p>Enter the Alation shell.</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>/etc/init.d/alation<span class="w"> </span>shell
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Run the command given below. The output will show the current value of the parameter.</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>alation_conf<span class="w"> </span>alation.feature_flags.enable_pgbackrest
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Exit the Alation shell.</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span><span class="nb">exit</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
</section>
<section id="enable-pgbackrest">
<h2>Enable pgBackRest<a class="headerlink" href="#enable-pgbackrest" title="Permalink to this headline">¶</a></h2>
<p><em>Applies to versions 2022.2 - 2022.4</em></p>
<p>To enable pgbackRest:</p>
<ol class="arabic">
<li><p>Use SSH to connect to your Alation instance.</p></li>
<li><p>Enter the Alation shell.</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>/etc/init.d/alation<span class="w"> </span>shell
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Run the following command:</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>alation_conf<span class="w"> </span>alation.feature_flags.enable_pgbackrest<span class="w"> </span>-s<span class="w"> </span>True
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Enabling pgBackRest changes the WAL archive directory from <strong>pg_probackup</strong> (default) to <strong>pgbackrest</strong>. This change needs to be propagated down to the Postgres configuration on the Alation server. For this to happen, run the <code class="docutils literal notranslate"><span class="pre">enable_backupv2</span></code> action after enabling pgBackRest:</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>alation_action<span class="w"> </span>enable_backupv2
</pre></div>
</div>
<p>No restart is required.</p>
</div></blockquote>
</li>
<li><p>Because pgBackRest does not support Celery-based scheduled backups, you need to disable them to avoid a daily backup failure. You can schedule pgBackRest backups using Crontab: <a class="reference internal" href="#schedule-pgbackrest-backups">Schedule pgBackRest Backups</a>.</p>
<blockquote>
<div><p>Run the following command to disable daily backup schedule:</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>alation_conf<span class="w"> </span>snapshot.enabled<span class="w"> </span>-s<span class="w"> </span>False
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>If you later decide to return to the default backup tool, you’ll need to re-enable the daily backup schedule and disable the corresponding cron job.</p>
</div>
</div></blockquote>
</li>
</ol>
<p>6. If you are going to continue the backup configuration at this point, stay in the Alation shell. If not, exit the Alation shell:
<code class="docutils literal notranslate"><span class="pre">exit</span></code>.</p>
<p>Except for backup scheduling, pgBackRest supports most of the backup configuration options available for Backup V2. With pgBackRest enabled, you can use incremental backups. For more information, see <a class="reference internal" href="ConfigureBackups/ConfigureIncrementalBackups.html"><span class="doc">Configure Incremental Backups</span></a>.</p>
<p>After enabling pgBackRest, decide if you want to exclude the Postgres backup from the compressed Alation backup. Excluding the Postgres backup from the Alation backup can noticeably decrease the backup creation time and is recommended for large implementations of the Catalog. However, in this case the Postgres backup must be maintained separately from the Alation backup files. Maintaining separate Postgres backups also affects the restore process as the Postgres backup needs to be provided in addition to the Alation backup.</p>
</section>
<section id="exclude-postgres-backup-from-alation-backup">
<h2>Exclude Postgres Backup from Alation Backup<a class="headerlink" href="#exclude-postgres-backup-from-alation-backup" title="Permalink to this headline">¶</a></h2>
<p>When using pgBackRest, you can exclude the Postgres backup from the Alation backup and maintain Postgres backups separately.</p>
<p>Whether or not the Postgres backup is excluded from the Alation backup is controlled by the <strong>alation_conf</strong> parameter <code class="docutils literal notranslate"><span class="pre">alation.backup_v2.pgbackup_compression</span></code>.</p>
<p>By default, the Postgres backup <strong>is included</strong> in the Alation backup and compressed together with the backup of the Alation application into the Alation <strong>.tar.gz</strong> file. The default state is reflected by the following setting of the parameter <code class="docutils literal notranslate"><span class="pre">alation.backup_v2.pgbackup_compression</span></code>:</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>alation.backup_v2.pgbackup_compression<span class="w"> </span><span class="o">=</span><span class="w"> </span>True
</pre></div>
</div>
</div></blockquote>
<p>To exclude the Postgres backup from the Alation backup, you need to modify the value of <code class="docutils literal notranslate"><span class="pre">alation.backup_v2.pgbackup_compression</span></code> and set it to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
<p>To exclude the Postgres backup from the Alation backup:</p>
<ol class="arabic">
<li><p>Use SSH to connect to your Alation instance.</p></li>
<li><p>Enter the Alation shell:</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>/etc/init.d/alation<span class="w"> </span>shell
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Disable the Postgres compression:</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>alation_conf<span class="w"> </span>alation.backup_v2.pgbackup_compression<span class="w"> </span>-s<span class="w"> </span>False
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Next, you can designate a directory on the Alation host to store the uncompressed Postgres backups. By default, the Postgres backups will be created in the directory <strong>data2/pgbackrest</strong>. You can create a different directory in the Alation chroot for the Postgres backups. Use the following command to designate a custom pgBackRest directory:</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>alation_conf<span class="w"> </span>pgsql.pgbackrest.repo_dir_name<span class="w"> </span>-s<span class="w"> </span>path/to/directory
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Exit the Alation shell.</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span><span class="nb">exit</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
<p>With this pgBackRest configuration, the next backup process will create three backup files:</p>
<blockquote>
<div><ul>
<li><p>In the backup directory <strong>data2/backup</strong> (default) or in the directory that you designated for backups using the parameter <code class="docutils literal notranslate"><span class="pre">alation.backup.data_dump_dir</span></code>, Alation will create the Alation backup and the Event Bus backup:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>&lt;timestamp_version&gt;_alation_backup.tar.gz</strong> - A compressed Alation backup that does not include the Postgres backup.</p></li>
<li><p><strong>&lt;timestamp_version&gt;_alation_eb_backup.tar.gz</strong> - A compressed Event Bus backup.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Separately, in the directory <strong>data2/pgbackrest</strong> or in the directory that you designated for Postgres backups using the parameter <code class="docutils literal notranslate"><span class="pre">pgsql.pgbackrest.repo_dir_name</span></code>, Alation will create a separate Postgres backup. Note that the Postgres backup is not one file but a set of files and directories.</p></li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For more information on how to create backups, see <a class="reference internal" href="CreateBackupsManually.html"><span class="doc">Create Backups Manually</span></a>.</p>
</div>
</section>
<section id="configure-external-storage-on-amazon-s3">
<h2>Configure External Storage on Amazon S3<a class="headerlink" href="#configure-external-storage-on-amazon-s3" title="Permalink to this headline">¶</a></h2>
<p>You can use Amazon S3 as external storage for Postgres backups. If S3 is configured as external storage, every time you run the backup action or when a backup is created on schedule, Alation will copy the Postgres backup to the designated S3 bucket. Note that the backups are <em>copied</em> to S3, not moved. They will remain available in the backup folder of the Alation host, too. S3 serves as additional remote storage.</p>
<p>When restoring Alation, you can specify the S3 bucket as the source of the Postgres backup in order to restore Alation.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The existing configuration option for moving Alation backups to external storage <code class="docutils literal notranslate"><span class="pre">alation.backup.post_script.path</span></code> does not cover separate Postgres backups and only relocates the Alation backup and the Event Bus backup.</p>
</div>
<p>Perform this configuration after enabling pgBackRest with Postgres compression disabled.</p>
<section id="prerequisites">
<h3>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p>You will need to specify information about your Amazon S3 bucket in this configuration. Make sure you have these values at hand:</p>
<blockquote>
<div><ul class="simple">
<li><p>S3 bucket name</p></li>
<li><p>Your Amazon S3 region</p></li>
<li><p>AWS API key</p></li>
<li><p>AWS API secret</p></li>
</ul>
</div></blockquote>
</li>
</ol>
<p>Your Alation instance must be able to establish a connection to S3. Make sure your Amazon S3 environment allows connections from the Alation IP address.</p>
</section>
<section id="configuration">
<h3>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h3>
<p>To configure the external Postgres backup storage on Amazon S3:</p>
<ol class="arabic">
<li><p>From the Alation shell, set the following parameters:</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>alation_conf<span class="w"> </span>pgsql.pgbackrest.redundancy.enabled<span class="w"> </span>-s<span class="w"> </span>True
alation_conf<span class="w"> </span>pgsql.pgbackrest.redundancy.type<span class="w"> </span>-s<span class="w"> </span>s3
alation_conf<span class="w"> </span>pgsql.pgbackrest.redundancy.s3.endpoint<span class="w"> </span>-s<span class="w"> </span>s3.amazonaws.com
alation_conf<span class="w"> </span>pgsql.pgbackrest.redundancy.s3.bucket<span class="w"> </span>-s<span class="w"> </span>&lt;your_<span class="w"> </span>AWS_S3_bucket&gt;
alation_conf<span class="w"> </span>pgsql.pgbackrest.redundancy.s3.region<span class="w"> </span>-s<span class="w"> </span>&lt;AWS_region_for_S3_bucket&gt;
alation_conf<span class="w"> </span>pgsql.pgbackrest.redundancy.s3.key<span class="w"> </span>-s<span class="w"> </span>&lt;AWS_API_key&gt;
alation_conf<span class="w"> </span>pgsql.pgbackrest.redundancy.s3.secret<span class="w"> </span>-s<span class="w"> </span>&lt;AWS_API_secret&gt;
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Alation will store the AWS API key and secret in the encrypted format.</p>
</div>
</div></blockquote>
</li>
<li><p>No restart is required. When you run the backup action next time, Alation will copy the Postgres backup to the S3 bucket as per this configuration.</p>
<blockquote>
<div><div class="admonition important">
<p class="admonition-title">Important</p>
<p>When you restore Alation from the backup on a new instance, before you run the restore command, you will need to repeat the same configuration for S3 as was on the old instance. See <a class="reference internal" href="RestoreFromBackup/RestoreAlationWithSeparatePostgresBackup.html#restore-from-s3"><span class="std std-ref">Restore Alation with Postgres Backup on Amazon S3</span></a>.</p>
</div>
</div></blockquote>
</li>
</ol>
</section>
</section>
<section id="schedule-pgbackrest-backups">
<h2>Schedule pgBackRest Backups<a class="headerlink" href="#schedule-pgbackrest-backups" title="Permalink to this headline">¶</a></h2>
<p>Use the information for your Alation version.</p>
<section id="versions-2022-3-and-newer">
<h3>Versions 2022.3 and Newer<a class="headerlink" href="#versions-2022-3-and-newer" title="Permalink to this headline">¶</a></h3>
<p>From Version 2022.3, pgBackRest backups can be scheduled using <strong>alation_conf</strong>. See <a class="reference internal" href="ConfigureBackups/SetupCustomBackupSchedule.html"><span class="doc">Set Up a Custom Backup Schedule</span></a>.</p>
</section>
<section id="version-2022-2">
<h3>Version 2022.2<a class="headerlink" href="#version-2022-2" title="Permalink to this headline">¶</a></h3>
<p>Scheduled pgBackRest backups are based on UTC. The current backup scheduling capabilities using <strong>alation_conf</strong> are based on Celery task scheduling which uses PST. This results in a failure of scheduled backups when pgBackRest is enabled.</p>
<p>In order to schedule backups when using pgBackRest, turn off Celery-based daily backups and set up the corresponding system Cron job.</p>
<p>To schedule backups when using pgBackRest:</p>
<ol class="arabic">
<li><p>On the Alation host, enter the Alation shell:</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>/etc/init.d/alation<span class="w"> </span>shell
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Make sure that the Celery-based backup schedule is turned off or turn it off.</p>
<blockquote>
<div><ul>
<li><p>To check if Celery-based schedule is turned off:</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>alation_conf<span class="w"> </span>snapshot.enabled
</pre></div>
</div>
<p>If this command returns <code class="docutils literal notranslate"><span class="pre">False</span></code>, it has already been turned off and you can proceed to the next step. If this command returns <code class="docutils literal notranslate"><span class="pre">True</span></code>, change the value to <code class="docutils literal notranslate"><span class="pre">False</span></code>:</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>alation_conf<span class="w"> </span>snapshot.enabled<span class="w"> </span>-s<span class="w"> </span>False
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p>Exit the shell.</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span><span class="nb">exit</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Outside of chroot, add the following crontab entry. It sets the backup job to run daily at 4 AM.</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>crontab<span class="w"> </span>-l<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="o">{</span><span class="w"> </span>cat<span class="p">;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;0 4 * * * source /opt/alation/alation/opt/alation/ops/alation_constants; sudo chroot &quot;</span><span class="si">${</span><span class="nv">ALATION_CHROOT</span><span class="si">}</span><span class="s2">&quot; /bin/su - </span><span class="si">${</span><span class="nv">ALATION_USER</span><span class="si">}</span><span class="s2"> -c &quot;</span>alation_action<span class="w"> </span>backup_all<span class="s2">&quot;&quot;</span><span class="p">;</span><span class="w"> </span><span class="o">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>crontab<span class="w"> </span>-
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Check the new setting.</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>crontab<span class="w"> </span>-l
</pre></div>
</div>
<p>The output should be:</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>*<span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>/opt/alation/alation/opt/alation/ops/actions/unjailed_update_auto_alation<span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>

<span class="m">0</span><span class="w"> </span><span class="m">4</span><span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span><span class="nb">source</span><span class="w"> </span>/opt/alation/alation/opt/alation/ops/alation_constants<span class="p">;</span><span class="w"> </span>sudo<span class="w"> </span>chroot<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">ALATION_CHROOT</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>/bin/su<span class="w"> </span>-<span class="w"> </span><span class="si">${</span><span class="nv">ALATION_USER</span><span class="si">}</span><span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;alation_action backup_all&quot;</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
<p>You can generate your preferred crontab using <a class="reference external" href="https://crontab.guru">https://crontab.guru</a> and configure a custom crontab. Use the following example to change to a new schedule:</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>crontab<span class="w"> </span>-e<span class="w"> </span><span class="c1"># replace &quot;0 4 * * *&quot; with &quot;0 6 * * *&quot;</span>
sudo<span class="w"> </span>crontab<span class="w"> </span>-l
</pre></div>
</div>
</div></blockquote>
<p>The output should be similar to:</p>
<blockquote>
<div><div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>*<span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>/opt/alation/alation/opt/alation/ops/actions/unjailed_update_auto_alation<span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>

<span class="m">0</span><span class="w"> </span><span class="m">6</span><span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span><span class="nb">source</span><span class="w"> </span>/opt/alation/alation/opt/alation/ops/alation_constants<span class="p">;</span><span class="w"> </span>sudo<span class="w"> </span>chroot<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">ALATION_CHROOT</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>/bin/su<span class="w"> </span>-<span class="w"> </span><span class="si">${</span><span class="nv">ALATION_USER</span><span class="si">}</span><span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;alation_action backup_all&quot;</span>
</pre></div>
</div>
</div></blockquote>
</section>
</section>
<section id="location-of-pgbackrest-logs">
<h2>Location of pgBackRest Logs<a class="headerlink" href="#location-of-pgbackrest-logs" title="Permalink to this headline">¶</a></h2>
<p>Enabling and using pgBackRest does not change the location of the backup logs <strong>/var/lib/pgsql/&lt;version&gt;/</strong> inside the Alation chroot.</p>
</section>
</section>


           </div>
          </div>
          <footer>

  
<div class="navigation-bar">

    <div class="navigation navigation--prev">
        
        <a class="navigation__link" href="MonitorBackups.html">
            <button class="navigation__button">
                <i class="icon icon-left"></i>
            </button>
            <div class="navigation__title">
                <span class="heading">Previous</span> <br />Monitor Backups
            </div>
        </a>
        
    </div>

    <div class="navigation navigation--next">
        
        <a class="navigation__link" title="Accesskey Alt(+Shift)+p" accesskey="p" href="RestoreFromBackup/index.html">
            <div class="navigation__title">
                <span class="heading">Next</span> <br />Restore from a Backup
            </div>
            <button class="navigation__button" title="Accesskey Alt(+Shift)+n" accesskey="n">
                <i class="icon icon-right"></i>
            </button>
        </a>
        
    </div>

</div>


</footer>

        </div>
      </div>

    </section>

    <div class="wy-nav-side wy-nav-secondary">
      <div class="wy-side-scroll">
        <div class="wy-side-scroll__content">
          <div class="wy-menu-secondary">
              <div class="comments">
    <a href="mailto:no-reply-docs-feedback@alation.com?subject=Documentation Feedback on installconfig/BackupandRestore/ManagePostgresBackupsSeparately&body=Alation%20welcomes%20your%20comments%20on%20typos,%20content%20accuracy%20and%20completeness,%20and%20whether%20you%20found%20this%20page%20helpful.%20You%20will%20not%20receive%20a%20reply%20to%20this%20email.">
        <i class="icon icon-envelope" aria-hidden="true"></i>Request docs changes
    </a>
    <a href="#open-modal-pdf">
        <i class="icon icon-pdf" aria-hidden="true"></i>Download PDF
    </a>
</div>
              
                <p class="wy-menu-secondary-header">On this page</p>
                <ul>
<li><a class="reference internal" href="#">Manage Postgres Backups Separately</a><ul>
<li><a class="reference internal" href="#check-if-pgbackrest-is-in-use">Check if PgBackRest Is in Use</a></li>
<li><a class="reference internal" href="#enable-pgbackrest">Enable pgBackRest</a></li>
<li><a class="reference internal" href="#exclude-postgres-backup-from-alation-backup">Exclude Postgres Backup from Alation Backup</a></li>
<li><a class="reference internal" href="#configure-external-storage-on-amazon-s3">Configure External Storage on Amazon S3</a><ul>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li><a class="reference internal" href="#configuration">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#schedule-pgbackrest-backups">Schedule pgBackRest Backups</a><ul>
<li><a class="reference internal" href="#versions-2022-3-and-newer">Versions 2022.3 and Newer</a></li>
<li><a class="reference internal" href="#version-2022-2">Version 2022.2</a></li>
</ul>
</li>
<li><a class="reference internal" href="#location-of-pgbackrest-logs">Location of pgBackRest Logs</a></li>
</ul>
</li>
</ul>

              
            </div>
          </div>
      </div>
    </div>

  </div>

  
  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->

  
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/clipboard.min.js"></script>
      <script type="text/javascript" src="../../_static/copybutton.js"></script>
      <script type="text/javascript" src="../../_static/js/rtd_sphinx_search.min.js"></script>
  
  <script type="text/javascript" src="../../_static/searchtools.js"></script> <script type="text/javascript" id="idPiwikScriptPlaceholder"></script><script type="text/javascript" src="../../_static/js/main.bundle.js"></script>
  <script type="text/javascript" src="../../_static/js/runtime.bundle.js"></script>

  
  

  
    <div id="open-modal-pdf" class="modal-window">
<div>
  <a href="#" title="Close" class="modal-close">Close</a>
  <h4>Alation Documentation PDF</h4>
  <p>This PDF contains all our documentation and is more than <b>120 MB</b> in size. We recommend using an ethernet or Wi-Fi connection for downloading.</p>
  <br>
  <div class="modal-buttons">
    <a href="https://pdf-docs.alation.com/AlationUserDocs.pdf" class="btn-cta btn-cta--primary" target="_blank">
      Download PDF
    </a>
    <a href="#" title="Close" class="btn-cta">Cancel</a>
  </div>
</div>
  

</body>
</html>
<!--3.6.17-->